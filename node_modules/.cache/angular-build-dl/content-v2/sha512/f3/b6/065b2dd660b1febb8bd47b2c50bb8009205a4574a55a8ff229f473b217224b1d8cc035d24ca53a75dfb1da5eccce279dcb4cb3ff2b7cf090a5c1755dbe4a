"use strict";(self.webpackChunkcalix=self.webpackChunkcalix||[]).push([[9794],{69794:function(e,t,i){i.d(t,{G:function(){return _}});var s=i(92340),o=i(37716),n=i(79765),a=i(91841);let r=(()=>{class e{constructor(e){this.http=e,this.result$=new n.xQ}getData(e){this.doService=this.http.post(s.N.SP_API_BASE_URL+"/geo/telemetry/all",{precision:6,window:"15min",location:{topLeft:{lat:90,lon:-180},bottomRight:{lat:-90,lon:180}}}).subscribe(e=>{let t=e.result,i=t.length,s=[];for(let o=0;o<i;o++)t[o]&&"object"==typeof t[o].location&&t[o].location&&s.push({lat:parseFloat(t[o].location.lat),lng:parseFloat(t[o].location.lon),macAddr:t[o].macAddr});e.locations=s,this.result$.next(e)},e=>{this.result$.next({error:!0,errorMsg:e.statusText})})}getGeoTelemetryData(e){let t;if(!t)return t=!0,this.http.get(s.N.SP_API_BASE_URL+"/geo/telemetry/data?macAddr="+e)}undoService(){this.doService&&this.doService.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(a.eN))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var l=i(12664),c=i(7450),d=i(39895),u=i(39075),g=i(38583);const p=["fullScreeenModal"];function h(e,t){if(1&e&&(o.TgZ(0,"div",14),o.TgZ(1,"strong"),o._uU(2),o.qZA(),o._uU(3),o.TgZ(4,"button",15),o._UZ(5,"span",16),o.qZA(),o.qZA()),2&e){const e=o.oxw();o.xp6(2),o.hij("",e.language.Error_map,"!"),o.xp6(1),o.hij(" ",e.errorMsg,". ")}}function f(e,t){1&e&&(o.TgZ(0,"div",17),o.TgZ(1,"div",18),o.TgZ(2,"div",19),o.TgZ(3,"span",20),o._uU(4,"Loading..."),o.qZA(),o.qZA(),o.qZA(),o.qZA())}function b(e,t){if(1&e&&(o.TgZ(0,"div"),o.TgZ(1,"button",21),o._uU(2),o.qZA(),o.qZA()),2&e){const e=o.oxw();o.xp6(2),o.AsE(" ",e.language.Number_of_Systems," = ",e.deviceCount," ")}}function m(e,t){if(1&e&&(o.TgZ(0,"div"),o.TgZ(1,"button",22),o._uU(2),o.qZA(),o.qZA()),2&e){const e=o.oxw();o.xp6(2),o.AsE(" ",e.language.Number_of_Devices," = ",e.deviceCount," ")}}function Z(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"div"),o.TgZ(1,"button",23),o.NdJ("click",function(){return o.CHM(e),o.oxw().tableView()}),o._UZ(2,"i",24),o._uU(3),o.qZA(),o.qZA()}if(2&e){const e=o.oxw();o.xp6(3),o.hij("",e.language.Table_View," ")}}function x(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"div",25),o.TgZ(1,"button",26),o.NdJ("click",function(){return o.CHM(e),o.oxw().mapViewFunction()}),o._uU(2),o.qZA(),o.qZA()}if(2&e){const e=o.oxw();o.xp6(2),o.hij("",e.language.Map_View," ")}}function w(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"tr"),o.TgZ(1,"td"),o._uU(2),o.qZA(),o.TgZ(3,"td"),o._uU(4),o.qZA(),o.TgZ(5,"td"),o._uU(6),o.qZA(),o.TgZ(7,"td"),o.TgZ(8,"button",28),o.NdJ("click",function(t){const i=o.CHM(e).$implicit;return o.oxw(2).open(i.macAddr,t)}),o._uU(9),o.qZA(),o.qZA(),o.qZA()}if(2&e){const e=t.$implicit,i=o.oxw(2);o.xp6(2),o.Oqu(e.macAddr),o.xp6(2),o.Oqu(e.lat),o.xp6(2),o.Oqu(e.lng),o.xp6(2),o.MGl("id","view-details-",e.macAddr,""),o.xp6(1),o.Oqu(i.language.View)}}function A(e,t){if(1&e&&(o.TgZ(0,"tbody"),o.YNc(1,w,10,5,"tr",27),o.qZA()),2&e){const e=o.oxw();o.xp6(1),o.Q6J("ngForOf",e.locations)}}function v(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"div",29),o.TgZ(1,"h4",30),o._uU(2),o.qZA(),o.TgZ(3,"button",31),o.NdJ("click",function(){return o.CHM(e),o.oxw().close()}),o._UZ(4,"span",16),o.qZA(),o.qZA(),o.TgZ(5,"div",32),o.TgZ(6,"div",33),o.TgZ(7,"tr"),o.TgZ(8,"td",34),o._uU(9),o.qZA(),o.TgZ(10,"td"),o._uU(11," \xa0 \xa0: "),o.qZA(),o.TgZ(12,"td",35),o._uU(13),o.qZA(),o.qZA(),o._UZ(14,"br"),o.TgZ(15,"tr"),o.TgZ(16,"td",34),o._uU(17),o.qZA(),o.TgZ(18,"td"),o._uU(19," \xa0 \xa0: "),o.qZA(),o.TgZ(20,"td",35),o._uU(21),o.qZA(),o.qZA(),o._UZ(22,"br"),o.TgZ(23,"tr"),o.TgZ(24,"td",34),o._uU(25),o.qZA(),o.TgZ(26,"td"),o._uU(27," \xa0 \xa0: "),o.qZA(),o.TgZ(28,"td",35),o._uU(29),o.qZA(),o.qZA(),o._UZ(30,"br"),o.TgZ(31,"tr"),o.TgZ(32,"td",34),o._uU(33),o.qZA(),o.TgZ(34,"td"),o._uU(35," \xa0 \xa0: "),o.qZA(),o.TgZ(36,"td",35),o._uU(37),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&e){const e=o.oxw();o.xp6(2),o.AsE("",e.language.MAC_Address,"\xa0 \xa0:\xa0 \xa0",e.tablePopupData.macAddr," "),o.xp6(7),o.Oqu(e.language.Model_Number),o.xp6(4),o.hij(" \xa0 \xa0",e.tablePopupData.modelNumber,""),o.xp6(4),o.Oqu(e.language.Serial_Number),o.xp6(4),o.hij(" \xa0 \xa0",e.tablePopupData.serialNumber,""),o.xp6(4),o.Oqu(e.language.Firmware_Version),o.xp6(4),o.hij(" \xa0 \xa0",e.tablePopupData.firmwareVersion,""),o.xp6(4),o.Oqu(e.language.Application_s),o.xp6(4),o.hij(" \xa0 \xa0",e.tablePopupData.appNames?e.tablePopupData.appNames:"-","")}}let _=(()=>{class e{constructor(e,t,i,s,o,n){this.renderer=e,this.service=t,this.dialogService=i,this.translateService=s,this.router=o,this.titleService=n,this.mapView=!0,this.mapLoaded=!1,this.deviceCount=0,this.locations=[],this.markers=[],this.markerData=[],this.pins=[],this.containers={CIEP:"ExperienceIQ",CIES:"ProtectIQ",iothub:"Smart Home Agent",wifiapi:"WiFi Demo",vz_iothub:"Usb IoT",sthub:"Samsung Smartthings",alexa:"Alexa"},this.loader=!0,this.index=0,this.classes="example-items-rows",this.error=!1,this.errorMsg=""}ngOnInit(){this.foundationEnable=-1!=this.router.url.indexOf("foundation-geographic-view"),this.language=this.translateService.defualtLanguage,this.languageSubject=this.translateService.selectedLanguage.subscribe(e=>{this.language=e})}ngAfterViewInit(){this.loadRecords()}showError(e){this.error=!0,this.errorMsg=e}hideError(){this.error=!1,this.errorMsg=""}loadRecords(){this.service.getData(),this.serviceSubscription=this.service.result$.subscribe(e=>{this.locations=e.locations?e.locations:[],this.deviceCount=e.size?e.size:0,this.loadMap(),this.loader=!1},e=>{this.loader=!1})}loadMap(){this.map=new Microsoft.Maps.Map("#myMap",{credentials:s.N.BING_API_KEY,zoom:1}),this.map.setView({mapTypeId:Microsoft.Maps.MapTypeId.road}),this.map.setOptions({showLogo:!1,showDashboard:!1,showMapTypeSelector:!1,showCopyright:!1,disableBirdseye:!0,disableStreetside:!1}),this.infobox=new Microsoft.Maps.Infobox(this.map.getCenter(),{visible:!1}),this.infobox.setMap(this.map),Microsoft.Maps.registerModule("SpiderClusterManager","assets/js/SpiderClusterManager.js"),Microsoft.Maps.loadModule(["SpiderClusterManager"],()=>{let e={},t=this.locations.length;for(let i=0;i<t;i++){e=this.createSpiderIcon("2");let t=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(this.locations[i].lat,this.locations[i].lng),e);t.metadata=this.locations[i],this.pins.push(t)}this.spiderManager=new SpiderClusterManager(this.map,this.pins,{pinSelected:(e,t)=>{this.showInfobox(t?t.getLocation():e.getLocation(),e.metadata.macAddr)},pinUnselected:()=>{this.hideInfobox()},clusteredPinCallback:this.createCustomClusteredPin,gridSize:80})})}addJsToElement(e){const t=document.createElement("script");return t.type="text/javascript",t.src=e,this.renderer.appendChild(document.head,t),t}tableView(){this.mapView=!1}mapViewFunction(){this.mapView=!0}createSpiderIcon(e){let t=12,i="rgba(255, 40, 40, 0.9)";"1"==e?i="rgba(20, 180, 20, 0.9)":"2"==e?i="rgba(255, 210, 40, 0.9)":"3"==e&&(i="rgba(128, 0, 128, 0.9)");let s=3;return{icon:['<svg xmlns="http://www.w3.org/2000/svg" width="',2*t,'" height="',2*t,'" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"><g id="UrTavla"><circle cx="',t,'" cy="',t,'" r="',t-s,'" stroke="',"rgba(255, 255, 255, 0.7)",'" stroke-width="',s,'" fill="',i,'"/>    <text x="50%" y="50%" text-anchor="middle" fill="white" dy=".3em"></text></g></svg>'].join(""),anchor:new Microsoft.Maps.Point(t,t)}}createCustomClusteredPin(e){let t=e.containedPushpins.length,i=Math.log(t)/Math.log(10)*5+15,s=i,o="assets/images/m1.png";t<10?(o="assets/images/m1.png",s=i):t<100?(o="assets/images/m2.png",s=i):t<1e3?(o="assets/images/m3.png",s=i+1):(o="assets/images/m5.png",s=i+9),e.setOptions({icon:o,anchor:new Microsoft.Maps.Point(i,i),textOffset:new Microsoft.Maps.Point(0,s)})}showInfobox(e,t){this.loader=!0,this.service.getGeoTelemetryData(t).subscribe(t=>{let i=t.result,s=[];if(i&&i.apps)for(let e=0;e<i.apps.length;e++)s.push(this.containers[i.apps[e].name]?this.containers[i.apps[e].name]:i.apps[e].name);i.appNames=s.join(", "),this.loader=!1,this.infobox.setOptions({location:e,title:this.language["System Information"],description:`\n        FSAN: ${i.fsanSerialNumber?i.fsanSerialNumber:""}<br/>\n        ${this.language["MAC Address"]} : ${i.macAddr}<br/>\n        ${this.language.Model_Number} : ${i.modelNumber}<br/>\n        ${this.language["Serial Number"]} : ${i.serialNumber}\n        <br/>\n        ${this.language.Firmware_Version} : ${void 0!==i.firmwareVersion?i.firmwareVersion:""}\n        <br/>\n        \n                          `,visible:!0,width:300})},e=>{this.loader=!1})}hideInfobox(){void 0!==this.infobox&&this.infobox.setOptions({visible:!1})}open(e,t){console.log(t);let i=document.getElementById(`${t.target.id}`);i.disabled=!0,this.service.getGeoTelemetryData(e).subscribe(e=>{i.disabled=!1;let t=[];if(e&&e.result&&e.result.apps)for(let i=0;i<e.result.apps.length;i++)t.push(this.containers[e.result.apps[i].name]?this.containers[e.result.apps[i].name]:e.apps[i].name);this.tablePopupData=Object.assign({appNames:t.join(", ")},e.result),this.close(),this.loader=!1,this.modalRef=this.dialogService.open(this.fullScreeenModal)},e=>{i.disabled=!1})}close(){this.modalRef&&this.modalRef.close()}ngOnDestroy(){this.serviceSubscription&&this.serviceSubscription.unsubscribe(),this.service.undoService(),this.languageSubject.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(o.Qsj),o.Y36(r),o.Y36(l.FF),o.Y36(c.s),o.Y36(d.F0),o.Y36(u.Dx))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-map"]],viewQuery:function(e,t){if(1&e&&o.Gf(p,7),2&e){let e;o.iGM(e=o.CRH())&&(t.fullScreeenModal=e.first)}},hostVars:2,hostBindings:function(e,t){2&e&&o.Tol(t.classes)},decls:28,vars:16,consts:[["class","alert alert-warning alert-dismissible fade show","role","alert",4,"ngIf"],["class","loader",4,"ngIf"],[1,"main-card-exception",3,"hidden","ngClass"],[1,"w-100","position-relative"],["id","myMap",1,"map-v",3,"dblclick","mousedown","scroll"],[1,"flex-around","pos-abs-w",3,"hidden"],[4,"ngIf"],[3,"ngClass","hidden"],["class","modal-footer  border-reset mr-2",4,"ngIf"],[1,"p-2"],[1,"table-responsive"],[1,"table","table-bordered"],["class","col-md-8"],["fullScreeenModal",""],["role","alert",1,"alert","alert-warning","alert-dismissible","fade","show"],["type","button","data-dismiss","alert","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"loader"],[1,"d-flex","justify-content-center"],["role","",1,"spinner-border","text-primary"],[1,"sr-only"],[1,"btn","btn-white","ml-2","font-14","cursor-default"],[1,"btn","btn-white","ml-2","font-14"],[1,"btn","btn-white","font-14","mr-2",3,"click"],[1,"fa","fa-list","mr-1"],[1,"modal-footer","border-reset","mr-2"],[1,"btn","btn-sm","btn-success",3,"click"],[4,"ngFor","ngForOf"],[1,"btn","btn-success","btn-sm",3,"id","click"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],[1,"modal-body"],[1,"p-2","border-bot-grey"],[1,"f-15","w-150p"],[1,"f-15"]],template:function(e,t){1&e&&(o.TgZ(0,"div"),o.YNc(1,h,6,2,"div",0),o.YNc(2,f,5,0,"div",1),o.TgZ(3,"div",2),o.TgZ(4,"div",3),o.TgZ(5,"div",4),o.NdJ("dblclick",function(){return t.hideInfobox()})("mousedown",function(){return t.hideInfobox()})("scroll",function(){return t.hideInfobox()}),o.qZA(),o.TgZ(6,"div",5),o.YNc(7,b,3,2,"div",6),o.YNc(8,m,3,2,"div",6),o.YNc(9,Z,4,1,"div",6),o.qZA(),o.qZA(),o.qZA(),o.TgZ(10,"div",7),o.YNc(11,x,3,1,"div",8),o.TgZ(12,"div",9),o.TgZ(13,"div",10),o.TgZ(14,"table",11),o.TgZ(15,"thead"),o.TgZ(16,"tr"),o.TgZ(17,"th"),o._uU(18),o.qZA(),o.TgZ(19,"th"),o._uU(20),o.qZA(),o.TgZ(21,"th"),o._uU(22),o.qZA(),o.TgZ(23,"th"),o._uU(24),o.qZA(),o.qZA(),o.qZA(),o.YNc(25,A,2,1,"tbody",6),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.YNc(26,v,38,10,"ng-template",12,13,o.W1O)),2&e&&(o.xp6(1),o.Q6J("ngIf",t.error),o.xp6(1),o.Q6J("ngIf",t.loader),o.xp6(1),o.Q6J("hidden",t.error)("ngClass",t.mapView?"d-block":"d-none"),o.xp6(3),o.Q6J("hidden",t.error),o.xp6(1),o.Q6J("ngIf",t.foundationEnable),o.xp6(1),o.Q6J("ngIf",!t.foundationEnable),o.xp6(1),o.Q6J("ngIf",!t.router.url.includes("cco-foundation/foundation-systems/foundation-geographic-view")),o.xp6(1),o.Q6J("ngClass",t.mapView?"d-none":"d-block")("hidden",t.error),o.xp6(1),o.Q6J("ngIf",!t.router.url.includes("cco-foundation/foundation-systems/foundation-geographic-view")),o.xp6(7),o.Oqu(t.foundationEnable?t.language.System_MAC_address:t.language.Device_MAC_Address),o.xp6(2),o.Oqu(t.language.Location_Latitude),o.xp6(2),o.Oqu(t.language.Location_Longitude),o.xp6(2),o.Oqu(t.language.Action),o.xp6(1),o.Q6J("ngIf",t.locations))},directives:[g.O5,g.mk,g.sg],styles:[".btn-white[_ngcontent-%COMP%]{background-color:#fff!important;border:1px solid #ccc}.btn-white[_ngcontent-%COMP%]:hover{background-color:#fff!important;border:1px solid #fff}.flex-around[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.f-15[_ngcontent-%COMP%]{font-size:15px!important}.cursor-default[_ngcontent-%COMP%]{cursor:default!important}.map-v[_ngcontent-%COMP%]{width:100%;height:80vh}.border-bot-grey[_ngcontent-%COMP%]{border:.5px solid #e3ebf3}.w-150p[_ngcontent-%COMP%]{width:150px}.pos-abs-w[_ngcontent-%COMP%]{position:absolute;width:100%;top:20px}"]}),e})()}}]);