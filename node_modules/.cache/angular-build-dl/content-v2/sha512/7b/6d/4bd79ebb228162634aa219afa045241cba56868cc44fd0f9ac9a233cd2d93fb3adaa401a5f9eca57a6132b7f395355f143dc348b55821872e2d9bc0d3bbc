"use strict";(self.webpackChunkcalix=self.webpackChunkcalix||[]).push([[1060],{11060:function(a,e,s){s.d(e,{M:function(){return w}});var l=s(64762),t=s(3679),r=s(35758),i=s(92340),n=s(37716),o=s(55533),u=s(7450),c=s(91841),m=s(49342),d=s(89097),h=s(39075),g=s(38583);function p(a,e){if(1&a){const a=n.EpF();n.TgZ(0,"div",10),n.TgZ(1,"span",11),n._UZ(2,"img",12),n.qZA(),n.TgZ(3,"button",13),n.NdJ("click",function(){return n.CHM(a),n.oxw().closeAlert()}),n._UZ(4,"span"),n.qZA(),n._UZ(5,"div",14),n.qZA()}if(2&a){const a=n.oxw();n.xp6(5),n.Q6J("innerHtml",a.language[a.errorInfo]||a.errorInfo,n.oJD)}}function f(a,e){if(1&a){const a=n.EpF();n.TgZ(0,"div",15),n.TgZ(1,"span",16),n._UZ(2,"img",17),n.qZA(),n.TgZ(3,"button",13),n.NdJ("click",function(){return n.CHM(a),n.oxw().success=!1}),n._UZ(4,"span"),n.qZA(),n._UZ(5,"div",14),n.qZA()}if(2&a){const a=n.oxw();n.xp6(5),n.Q6J("innerHtml",a.language[a.successInfo]||a.successInfo,n.oJD)}}function v(a,e){if(1&a&&(n.TgZ(0,"div",18),n.TgZ(1,"div",19),n.TgZ(2,"div",20),n.TgZ(3,"div",21),n.TgZ(4,"div",22),n.TgZ(5,"span",23),n._uU(6),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&a){const a=n.oxw();n.xp6(6),n.Oqu(a.language.Loading)}}const L=function(a){return{greyout:a}};function x(a,e){if(1&a){const a=n.EpF();n.ynx(0,26),n.TgZ(1,"div",5),n.TgZ(2,"div",27),n.TgZ(3,"div",28),n.TgZ(4,"input",29),n.NdJ("click",function(e){const s=n.CHM(a).index;return n.oxw(2).onChangeCheckbox("check",e,"checked",s)}),n.qZA(),n.TgZ(5,"label",30),n._uU(6),n.qZA(),n.qZA(),n.qZA(),n.TgZ(7,"div",31),n.TgZ(8,"div",5),n.TgZ(9,"div",32),n.TgZ(10,"div",33),n.TgZ(11,"label",34),n._uU(12),n.TgZ(13,"span",35),n._uU(14,"*"),n.qZA(),n.qZA(),n.TgZ(15,"input",36),n.NdJ("keyup",function(e){const s=n.CHM(a).index;return n.oxw(2).enforceMinMax(e,"raiseThreshold",s)})("change",function(e){const s=n.CHM(a).index;return n.oxw(2).enforceMinMax(e,"raiseThreshold",s)})("keydown",function(e){return n.CHM(a),n.oxw(2).avoidInvalidValues(e)}),n.qZA(),n.qZA(),n.qZA(),n.TgZ(16,"div",32),n.TgZ(17,"div",33),n.TgZ(18,"label",34),n._uU(19),n.TgZ(20,"span",35),n._uU(21,"*"),n.qZA(),n.qZA(),n.TgZ(22,"input",37),n.NdJ("keyup",function(e){const s=n.CHM(a).index;return n.oxw(2).enforceMinMax(e,"clearThreshold",s)})("keydown",function(e){return n.CHM(a),n.oxw(2).avoidInvalidValues(e)}),n.qZA(),n.qZA(),n.qZA(),n.TgZ(23,"div",32),n.TgZ(24,"div",33),n.TgZ(25,"label",34),n._uU(26),n.TgZ(27,"span",35),n._uU(28,"*"),n.qZA(),n.qZA(),n.TgZ(29,"input",38),n.NdJ("keyup",function(e){const s=n.CHM(a).index;return n.oxw(2).enforceMinMax(e,"duration",s)})("keydown",function(e){return n.CHM(a),n.oxw(2).avoidInvalidValues(e)}),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.BQk()}if(2&a){const a=e.index,s=n.oxw(2);n.Q6J("formGroupName",a),n.xp6(4),n.s9C("id",null==s.alarmsList?null:s.alarmsList.alarmRulesData[a].value),n.Q6J("ngClass",n.VKq(14,L,!s.hasWriteAccess)),n.xp6(1),n.s9C("for",null==s.alarmsList?null:s.alarmsList.alarmRulesData[a].value),n.xp6(1),n.hij("",s.language[null==s.alarmsList?null:s.alarmsList.alarmRulesData[a].display_name]||(null==s.alarmsList?null:s.alarmsList.alarmRulesData[a].display_name)," "),n.xp6(6),n.hij("",s.language["Raised Count"]," "),n.xp6(3),n.Q6J("min",null==s.alarmsList||null==s.alarmsList.alarmRulesData[a]?null:s.alarmsList.alarmRulesData[a].raiseCountMin)("max",null==s.alarmsList||null==s.alarmsList.alarmRulesData[a]?null:s.alarmsList.alarmRulesData[a].raiseCountMax),n.xp6(4),n.hij("",s.language["Clear Count"]," "),n.xp6(3),n.Q6J("max",(null==s.alarmsList||null==s.alarmsList.alarmRulesData[a]?null:s.alarmsList.alarmRulesData[a].raiseThreshold)-1),n.xp6(4),n.hij("",s.language.Duration," (minutes) "),n.xp6(3),n.s9C("placeholder",s.language["1-120 mins"]),n.Q6J("min",null==s.alarmsList||null==s.alarmsList.alarmRulesData[a]?null:s.alarmsList.alarmRulesData[a].durationMin)("max",null==s.alarmsList||null==s.alarmsList.alarmRulesData[a]?null:s.alarmsList.alarmRulesData[a].durationMax)}}function A(a,e){if(1&a&&(n.ynx(0),n.ynx(1,24),n.YNc(2,x,30,16,"ng-container",25),n.BQk(),n.BQk()),2&a){const a=n.oxw();n.xp6(2),n.Q6J("ngForOf",null==a.alarmsList||null==a.alarmsList.alarmListForm||null==a.alarmsList.alarmListForm.controls||null==a.alarmsList.alarmListForm.controls.alarmsFormArray?null:a.alarmsList.alarmListForm.controls.alarmsFormArray.controls)}}function R(a,e){if(1&a){const a=n.EpF();n.TgZ(0,"div",40),n.TgZ(1,"button",41),n.NdJ("click",function(){return n.CHM(a),n.oxw(2).crudAlarmRules()}),n._uU(2),n.qZA(),n.TgZ(3,"button",42),n.NdJ("click",function(){return n.CHM(a),n.oxw(2).setAlarmListForm("clear")}),n._uU(4),n.qZA(),n.qZA()}if(2&a){const a=n.oxw(2);n.xp6(1),n.Q6J("disabled",a.alarmsList.disableSaved),n.xp6(1),n.hij(" ",a.language.Save," "),n.xp6(1),n.Q6J("disabled",a.alarmsList.disableCleared),n.xp6(1),n.hij(" ",a.language.Clear," ")}}function T(a,e){if(1&a&&(n.TgZ(0,"div",5),n.TgZ(1,"div",19),n.YNc(2,R,5,4,"div",39),n.qZA(),n.qZA()),2&a){const a=n.oxw();n.xp6(2),n.Q6J("ngIf",!a.cco_entitlement)}}const Z=function(a){return{disable:a}};let w=(()=>{class a{constructor(a,e,s,l,t,r,n){this.workflowService=a,this.translateService=e,this.http=s,this.commonOrgService=l,this.formBuilder=t,this.service=r,this.titleService=n,this.baseUrl=`${i.N.API_BASE_URL}analytics-engine/`,this.errorInfo="",this.successInfo="",this.loading=!1,this.btnDisabled=!1,this.errorMsg=void 0,this.alarmsList={disableSaved:!1,disableCleared:!1,alarmListForm:void 0,alarmRulesData:[]},this.cco_entitlement=!1,this.checkDev=!1,this.hasWriteAccess=!1,this.hasScopeAccess=!1}ngOnInit(){var a;this.checkDev=`${i.N.API_BASE}`.indexOf("/dev.api.calix.ai")>-1;let e=this.service.getEntitlements();e[210]&&!e[102]&&(this.cco_entitlement=!0);let s=this.service.getScopes();i.N.VALIDATE_SCOPE&&(s&&-1!==(null===(a=s["cloud.rbac.coc.operations.alarms.transformalarmrules"])||void 0===a?void 0:a.indexOf("write"))&&(this.hasWriteAccess=!0),s&&s["cloud.rbac.coc.operations.alarms.transformalarmrules"]&&(this.hasScopeAccess=!0)),this.setAlarmRulesData(),this.language=this.translateService.defualtLanguage,this.languageSubject=this.translateService.selectedLanguage.subscribe(a=>{this.language=a,this.titleService.setTitle(`${this.language["Transform Alarm Rules"]} - ${this.language.Alarms} - ${this.language.Operations} - ${this.language.Operations} - ${this.language["Calix Cloud"]}`)}),this.titleService.setTitle(`${this.language["Transform Alarm Rules"]} - ${this.language.Alarms} - ${this.language.Operations} - ${this.language.Operations} - ${this.language["Calix Cloud"]}`),this.hasScopeAccess?(this.setAlarmListForm(),this.callMultipleAPI()):this.service.setPageAccess(!1)}setAlarmRulesData(a){this.alarmsList.alarmRulesData=[{display_name:"Entire Network (Multiple-ONTs-Down-Network)",name:"Multiple-ONTs-Down-Network",value:"multiple-onts-down-network",request_param:"network",raiseThreshold:2,clearThreshold:0,duration:1,raiseCountMin:2,raiseCountMax:36e5,durationMin:1,durationMax:120,alarmRuleId:"clear"==a&&this.alarmsList.alarmRulesData&&this.alarmsList.alarmRulesData.length>0?this.alarmsList.alarmRulesData[0].alarmRuleId:"",checked:!1},{display_name:"Same Node (Multiple-ONTs-Down-OLT)",name:"Multiple-ONTs-Down-OLT",value:"multiple-onts-down-olt",request_param:"olt",raiseThreshold:2,clearThreshold:0,duration:1,raiseCountMin:2,raiseCountMax:16e3,durationMin:1,durationMax:120,alarmRuleId:"clear"==a&&this.alarmsList.alarmRulesData&&this.alarmsList.alarmRulesData.length>0?this.alarmsList.alarmRulesData[1].alarmRuleId:"",checked:!1},{display_name:"Same PON (Multiple-ONTs-Down-PON)",name:"Multiple-ONTs-Down-PON",value:"multiple-onts-down-pon",request_param:"pon",raiseThreshold:2,clearThreshold:0,duration:1,raiseCountMin:2,raiseCountMax:128,durationMin:1,durationMax:120,alarmRuleId:"clear"==a&&this.alarmsList.alarmRulesData&&this.alarmsList.alarmRulesData.length>0?this.alarmsList.alarmRulesData[2].alarmRuleId:"",checked:!1}]}setAlarmListForm(a){this.alarmsList.alarmListForm=this.formBuilder.group({alarmsFormArray:new t.Oe([])}),this.setAlarmRulesData(a),this.patchRulesFormValue(a)}callMultipleAPI(){return(0,l.mG)(this,void 0,void 0,function*(){yield Promise.all([this.getAlarmRulesController()])})}patchRulesFormValue(a){const e=this.alarmsList.alarmListForm.get("alarmsFormArray");this.alarmsList.alarmRulesData.forEach(a=>{e.push(new t.cw({display_name:new t.NI(a.display_name),name:new t.NI(a.name),value:new t.NI(a.value),request_param:new t.NI(a.request_param),raiseThreshold:new t.NI(a.raiseThreshold),clearThreshold:new t.NI(a.clearThreshold),description:new t.NI(a.description),duration:new t.NI(a.duration),checked:new t.NI(a.checked||!1),alarmRuleId:new t.NI(a.alarmRuleId||"")}))}),this.onChangeCheckbox("clear")}onChangeCheckbox(a,e,s,l){var t;const r=this.alarmsList.alarmListForm.get("alarmsFormArray");let i=r.value;"check"==a&&r.controls[l].controls&&(null===(t=r.controls[l].controls.checked)||void 0===t||t.setValue(e.target.checked)),this.alarmsList.disableSaved=!(!i.every(a=>""==a.alarmRuleId)||"checked"==s&&r.value.some(a=>a.checked)),this.alarmsList.disableCleared=!r.value.some(a=>a.checked)}getAlarmRulesController(){this.loading=!0,this.http.get(`${this.baseUrl}alarmRules`).subscribe(a=>{var e;if(this.loading=!1,a&&a.length>0){const s=null===(e=this.alarmsList)||void 0===e?void 0:e.alarmListForm.get("alarmsFormArray");(null==s?void 0:s.value)&&Object.entries(null==s?void 0:s.value).length>0&&(this.alarmsList.disableSaved=!1,this.alarmsList.disableCleared=!1,s.value.forEach((e,l)=>{let t=a.find(a=>a.name==e.value);s.controls[l].patchValue({duration:t?t.duration:1,clearThreshold:t?t.clearThreshold:0,raiseThreshold:t?t.raiseThreshold:2,alarmRuleId:t?t.alarmRuleId:"",checked:!!t&&!(!t.alarmRuleId||""==t.alarmRuleId)}),a.forEach(a=>{let e=this.alarmsList.alarmRulesData.find(e=>e.value==a.name);e&&Object.entries(e).length>0&&(e.duration=a.duration,e.clearThreshold=a.clearThreshold,e.raiseThreshold=a.raiseThreshold,e.alarmRuleId=a.alarmRuleId,e.checked=!0)})}))}else(!a||a.length<=0)&&(this.alarmsList.disableSaved=!0,this.alarmsList.disableCleared=!0,this.setAlarmRulesData(),this.setAlarmListForm())},a=>{this.error=!0,this.pageErrorHandle(a),this.loading=!1,this.alarmsList.disableSaved=!0,this.alarmsList.disableCleared=!0,this.setAlarmRulesData(),this.setAlarmListForm()})}crudAlarmRules(){var a;const e=Object.assign({},null===(a=this.alarmsList.alarmListForm)||void 0===a?void 0:a.value);if(e.alarmsFormArray&&e.alarmsFormArray.length>0){this.successInfo="",this.alarmsList.disableSaved=!0;let a={};e.alarmsFormArray.forEach((e,s)=>{let l;if(e.checked){let a={};a={clearThreshold:e.clearThreshold,duration:e.duration,raiseThreshold:e.raiseThreshold,name:e.value},l=e.alarmRuleId&&""!=e.alarmRuleId?this.http.put(`${this.baseUrl}alarmRule/${e.alarmRuleId}`,a,{responseType:"text"}):this.http.post(`${this.baseUrl}alarmRule`,a,{responseType:"text"})}else e.alarmRuleId&&""!=e.alarmRuleId&&(l=this.http.delete(`${this.baseUrl}alarmRule/${e.alarmRuleId}`,{responseType:"text"}));l&&(a[e.request_param]=l)}),a&&Object.entries(a).length>0&&(this.loading=!0,(0,r.D)(a).subscribe(({network:a,olt:e,pon:s})=>{a&&"Updated"==a?this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[0].name,"updated"):a&&"AlarmRule deleted successfully"==a?(this.alarmsList.alarmRulesData[0].alarmRuleId="",this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[0].name,"deleted")):a&&""!=a&&(this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[0].name,"saved")),e&&"Updated"==e?this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[1].name,"updated"):e&&"AlarmRule deleted successfully"==e?(this.alarmsList.alarmRulesData[1].alarmRuleId="",this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[1].name,"deleted")):e&&""!=e&&(this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[1].name,"saved")),s&&"Updated"==s?this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[2].name,"updated"):s&&"AlarmRule deleted successfully"==s?(this.alarmsList.alarmRulesData[2].alarmRuleId="",this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[2].name,"deleted")):s&&""!=s&&(this.successInfo+=this.language.alarmRulesMsg(this.alarmsList.alarmRulesData[2].name,"saved")),this.loading=!1,this.successInfo=this.successInfo.slice(0,-5),this.success=!0,setTimeout(()=>{this.alarmsList.disableSaved=!1,this.enableDisableSave(),this.successInfo="",this.success=!1},4e3),this.getAlarmRulesController()},a=>{this.error=!0,this.loading=!1,this.alarmsList.disableSaved=!1,this.pageErrorHandle(a),this.getAlarmRulesController()}))}}pageErrorHandle(a){this.errorInfo=401==a.status?"Access Denied":this.commonOrgService.pageErrorHandle(a),this.closeAlert(),this.error=!0}enforceMinMax(a,e,s){let l=0;"raiseThreshold"==e&&(l=500),this.alarmsList.disableSaved=!0,setTimeout(()=>{var l,t;let r=this.workflowService.enforceMinMax(a);if(-1!=r){const a=this.alarmsList.alarmListForm.get("alarmsFormArray");a.controls&&a.controls[s].controls&&(null===(l=a.controls[s].controls[e])||void 0===l||l.setValue(r),"raiseThreshold"==e&&(this.alarmsList.alarmRulesData[s].raiseThreshold=r,r<a.controls[s].controls.clearThreshold.value&&(null===(t=a.controls[s].controls.clearThreshold)||void 0===t||t.setValue(0),this.alarmsList.alarmRulesData[s].clearThreshold=0)))}this.enableDisableSave()},l)}enableDisableSave(){const a=this.alarmsList.alarmListForm.get("alarmsFormArray");this.alarmsList.disableSaved=!!a.value.every(a=>""==a.alarmRuleId)&&!a.value.some(a=>a.checked)}avoidInvalidValues(a){("."===a.key||8!=(null==a?void 0:a.which)&&0!=(null==a?void 0:a.which)&&((null==a?void 0:a.which)<48||(null==a?void 0:a.which)>57)&&((null==a?void 0:a.which)<96||(null==a?void 0:a.which)>105))&&a.preventDefault()}closeAlert(){this.error=!1,this.success=!1}}return a.\u0275fac=function(e){return new(e||a)(n.Y36(o.z),n.Y36(u.s),n.Y36(c.eN),n.Y36(m.v),n.Y36(t.qu),n.Y36(d.t6),n.Y36(h.Dx))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-cco-alarm-rules"]],decls:11,vars:10,consts:[[1,"ccl-form",3,"ngClass"],["class","w-100 alert alert-danger fade show my-3",4,"ngIf"],["class","w-100 alert alert-success fade show my-3",4,"ngIf"],["class","row mb-3",4,"ngIf"],[3,"formGroup"],[1,"row"],[1,"col-md-12","mb-2","mt-1"],[1,"cco-secondary-title"],[4,"ngIf"],["class","row",4,"ngIf"],[1,"w-100","alert","alert-danger","fade","show","my-3"],[1,"error-img"],["src","./assets/img/ic_error-36px.svg"],["type","button",1,"close",3,"click"],[1,"d-inline-flex",3,"innerHtml"],[1,"w-100","alert","alert-success","fade","show","my-3"],[1,"success-img"],["src","./assets/img/success-icon.svg"],[1,"row","mb-3"],[1,"col-md-12"],[1,"loader","mt-5"],[1,"d-flex","justify-content-center"],[1,"spinner-border","text-primary"],[1,"sr-only"],["formArrayName","alarmsFormArray"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],[1,"col-md-12","mt-2"],[1,"form-group","form-check"],["formControlName","checked","type","checkbox",1,"form-check-input",3,"ngClass","id","click"],[1,"form-check-label","cursor-pointer",3,"for"],[1,"col-md-12","row-group"],[1,"col-md-3"],[1,"form-group"],[1,"col-form-label"],[1,"error"],["formControlName","raiseThreshold","type","number","placeholder","2",3,"min","max","keyup","change","keydown"],["formControlName","clearThreshold","type","number","placeholder","0","min","0",3,"max","keyup","keydown"],["formControlName","duration","type","number",3,"min","max","placeholder","keyup","keydown"],["class","form-group mt-3",4,"ngIf"],[1,"form-group","mt-3"],[1,"btn-default","primary",3,"disabled","click"],[1,"btn-default","btn-dft","ml-2",3,"disabled","click"]],template:function(a,e){1&a&&(n.TgZ(0,"section",0),n.YNc(1,p,6,1,"div",1),n.YNc(2,f,6,1,"div",2),n.YNc(3,v,7,1,"div",3),n.TgZ(4,"form",4),n.TgZ(5,"div",5),n.TgZ(6,"div",6),n.TgZ(7,"label",7),n._uU(8),n.qZA(),n.qZA(),n.qZA(),n.YNc(9,A,3,1,"ng-container",8),n.qZA(),n.YNc(10,T,3,1,"div",9),n.qZA()),2&a&&(n.Q6J("ngClass",n.VKq(8,Z,!e.hasWriteAccess)),n.xp6(1),n.Q6J("ngIf",e.error),n.xp6(1),n.Q6J("ngIf",e.success),n.xp6(1),n.Q6J("ngIf",e.loading),n.xp6(1),n.Q6J("formGroup",null==e.alarmsList?null:e.alarmsList.alarmListForm),n.xp6(4),n.Oqu(e.language["Multiple - ONTs - Down"]),n.xp6(1),n.Q6J("ngIf",e.alarmsList.alarmRulesData&&e.alarmsList.alarmRulesData.length>0),n.xp6(1),n.Q6J("ngIf",e.hasWriteAccess))},directives:[g.mk,g.O5,t._Y,t.JL,t.sg,t.CE,g.sg,t.x0,t.Wl,t.JJ,t.u,t.Fj,t.wV,t.qQ,t.Fd],styles:[".row-group[_ngcontent-%COMP%]{padding-left:35px}.row-group[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]{width:100%}.row-group[_ngcontent-%COMP%]   .col-md-3[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:75%}.row-group[_ngcontent-%COMP%]   .name-col[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.diable-div[_ngcontent-%COMP%]{pointer-events:none;opacity:.5}.form-check[_ngcontent-%COMP%]{padding-left:20px;margin-bottom:5px}.form-check[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600}.form-check[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{max-width:13px;max-height:15px;min-height:15px;cursor:pointer}.disable[_ngcontent-%COMP%]{pointer-events:none}.greyout[_ngcontent-%COMP%]{opacity:.5}"]}),a})()},55533:function(a,e,s){s.d(e,{z:function(){return t}});var l=s(37716);let t=(()=>{class a{constructor(){}enforceMinMax(a){let e=null==a?void 0:a.target.min,s=null==a?void 0:a.target.max,l=null==a?void 0:a.target.value;return""!=l?(parseFloat(l)<parseFloat(e)&&(a.target.value=e),parseFloat(l)>parseFloat(s)&&(a.target.value=s),a.target.value):-1}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()}}]);