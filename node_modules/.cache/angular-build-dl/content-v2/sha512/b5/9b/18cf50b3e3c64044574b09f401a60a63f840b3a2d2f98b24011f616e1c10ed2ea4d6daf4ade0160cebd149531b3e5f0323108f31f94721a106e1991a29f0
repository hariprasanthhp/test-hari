!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,a=void 0,"symbol"==typeof(a=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"))?a:String(a)),i)}var o,a}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkcalix=self.webpackChunkcalix||[]).push([[9794],{69794:function(t,i,o){o.d(i,{G:function(){return q}});var a,r=o(92340),s=o(37716),l=o(79765),c=o(91841),u=((a=function(){function t(n){e(this,t),this.http=n,this.result$=new l.xQ}return n(t,[{key:"getData",value:function(e){var t=this;this.doService=this.http.post(r.N.SP_API_BASE_URL+"/geo/telemetry/all",{precision:6,window:"15min",location:{topLeft:{lat:90,lon:-180},bottomRight:{lat:-90,lon:180}}}).subscribe(function(e){for(var n=e.result,i=n.length,o=[],a=0;a<i;a++)n[a]&&"object"==typeof n[a].location&&n[a].location&&o.push({lat:parseFloat(n[a].location.lat),lng:parseFloat(n[a].location.lon),macAddr:n[a].macAddr});e.locations=o,t.result$.next(e)},function(e){t.result$.next({error:!0,errorMsg:e.statusText})})}},{key:"getGeoTelemetryData",value:function(e){var t;if(!t)return t=!0,this.http.get(r.N.SP_API_BASE_URL+"/geo/telemetry/data?macAddr="+e)}},{key:"undoService",value:function(){this.doService&&this.doService.unsubscribe()}}]),t}()).\u0275fac=function(e){return new(e||a)(s.LFG(c.eN))},a.\u0275prov=s.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a),d=o(12664),p=o(7450),g=o(39895),f=o(39075),h=o(38583),b=["fullScreeenModal"];function m(e,t){if(1&e&&(s.TgZ(0,"div",14),s.TgZ(1,"strong"),s._uU(2),s.qZA(),s._uU(3),s.TgZ(4,"button",15),s._UZ(5,"span",16),s.qZA(),s.qZA()),2&e){var n=s.oxw();s.xp6(2),s.hij("",n.language.Error_map,"!"),s.xp6(1),s.hij(" ",n.errorMsg,". ")}}function v(e,t){1&e&&(s.TgZ(0,"div",17),s.TgZ(1,"div",18),s.TgZ(2,"div",19),s.TgZ(3,"span",20),s._uU(4,"Loading..."),s.qZA(),s.qZA(),s.qZA(),s.qZA())}function Z(e,t){if(1&e&&(s.TgZ(0,"div"),s.TgZ(1,"button",21),s._uU(2),s.qZA(),s.qZA()),2&e){var n=s.oxw();s.xp6(2),s.AsE(" ",n.language.Number_of_Systems," = ",n.deviceCount," ")}}function w(e,t){if(1&e&&(s.TgZ(0,"div"),s.TgZ(1,"button",22),s._uU(2),s.qZA(),s.qZA()),2&e){var n=s.oxw();s.xp6(2),s.AsE(" ",n.language.Number_of_Devices," = ",n.deviceCount," ")}}function x(e,t){if(1&e){var n=s.EpF();s.TgZ(0,"div"),s.TgZ(1,"button",23),s.NdJ("click",function(){return s.CHM(n),s.oxw().tableView()}),s._UZ(2,"i",24),s._uU(3),s.qZA(),s.qZA()}if(2&e){var i=s.oxw();s.xp6(3),s.hij("",i.language.Table_View," ")}}function A(e,t){if(1&e){var n=s.EpF();s.TgZ(0,"div",25),s.TgZ(1,"button",26),s.NdJ("click",function(){return s.CHM(n),s.oxw().mapViewFunction()}),s._uU(2),s.qZA(),s.qZA()}if(2&e){var i=s.oxw();s.xp6(2),s.hij("",i.language.Map_View," ")}}function y(e,t){if(1&e){var n=s.EpF();s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.TgZ(5,"td"),s._uU(6),s.qZA(),s.TgZ(7,"td"),s.TgZ(8,"button",28),s.NdJ("click",function(e){var t=s.CHM(n).$implicit;return s.oxw(2).open(t.macAddr,e)}),s._uU(9),s.qZA(),s.qZA(),s.qZA()}if(2&e){var i=t.$implicit,o=s.oxw(2);s.xp6(2),s.Oqu(i.macAddr),s.xp6(2),s.Oqu(i.lat),s.xp6(2),s.Oqu(i.lng),s.xp6(2),s.MGl("id","view-details-",i.macAddr,""),s.xp6(1),s.Oqu(o.language.View)}}function T(e,t){if(1&e&&(s.TgZ(0,"tbody"),s.YNc(1,y,10,5,"tr",27),s.qZA()),2&e){var n=s.oxw();s.xp6(1),s.Q6J("ngForOf",n.locations)}}function _(e,t){if(1&e){var n=s.EpF();s.TgZ(0,"div",29),s.TgZ(1,"h4",30),s._uU(2),s.qZA(),s.TgZ(3,"button",31),s.NdJ("click",function(){return s.CHM(n),s.oxw().close()}),s._UZ(4,"span",16),s.qZA(),s.qZA(),s.TgZ(5,"div",32),s.TgZ(6,"div",33),s.TgZ(7,"tr"),s.TgZ(8,"td",34),s._uU(9),s.qZA(),s.TgZ(10,"td"),s._uU(11," \xa0 \xa0: "),s.qZA(),s.TgZ(12,"td",35),s._uU(13),s.qZA(),s.qZA(),s._UZ(14,"br"),s.TgZ(15,"tr"),s.TgZ(16,"td",34),s._uU(17),s.qZA(),s.TgZ(18,"td"),s._uU(19," \xa0 \xa0: "),s.qZA(),s.TgZ(20,"td",35),s._uU(21),s.qZA(),s.qZA(),s._UZ(22,"br"),s.TgZ(23,"tr"),s.TgZ(24,"td",34),s._uU(25),s.qZA(),s.TgZ(26,"td"),s._uU(27," \xa0 \xa0: "),s.qZA(),s.TgZ(28,"td",35),s._uU(29),s.qZA(),s.qZA(),s._UZ(30,"br"),s.TgZ(31,"tr"),s.TgZ(32,"td",34),s._uU(33),s.qZA(),s.TgZ(34,"td"),s._uU(35," \xa0 \xa0: "),s.qZA(),s.TgZ(36,"td",35),s._uU(37),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&e){var i=s.oxw();s.xp6(2),s.AsE("",i.language.MAC_Address,"\xa0 \xa0:\xa0 \xa0",i.tablePopupData.macAddr," "),s.xp6(7),s.Oqu(i.language.Model_Number),s.xp6(4),s.hij(" \xa0 \xa0",i.tablePopupData.modelNumber,""),s.xp6(4),s.Oqu(i.language.Serial_Number),s.xp6(4),s.hij(" \xa0 \xa0",i.tablePopupData.serialNumber,""),s.xp6(4),s.Oqu(i.language.Firmware_Version),s.xp6(4),s.hij(" \xa0 \xa0",i.tablePopupData.firmwareVersion,""),s.xp6(4),s.Oqu(i.language.Application_s),s.xp6(4),s.hij(" \xa0 \xa0",i.tablePopupData.appNames?i.tablePopupData.appNames:"-","")}}var q=function(){var t=function(){function t(n,i,o,a,r,s){e(this,t),this.renderer=n,this.service=i,this.dialogService=o,this.translateService=a,this.router=r,this.titleService=s,this.mapView=!0,this.mapLoaded=!1,this.deviceCount=0,this.locations=[],this.markers=[],this.markerData=[],this.pins=[],this.containers={CIEP:"ExperienceIQ",CIES:"ProtectIQ",iothub:"Smart Home Agent",wifiapi:"WiFi Demo",vz_iothub:"Usb IoT",sthub:"Samsung Smartthings",alexa:"Alexa"},this.loader=!0,this.index=0,this.classes="example-items-rows",this.error=!1,this.errorMsg=""}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.foundationEnable=-1!=this.router.url.indexOf("foundation-geographic-view"),this.language=this.translateService.defualtLanguage,this.languageSubject=this.translateService.selectedLanguage.subscribe(function(t){e.language=t})}},{key:"ngAfterViewInit",value:function(){this.loadRecords()}},{key:"showError",value:function(e){this.error=!0,this.errorMsg=e}},{key:"hideError",value:function(){this.error=!1,this.errorMsg=""}},{key:"loadRecords",value:function(){var e=this;this.service.getData(),this.serviceSubscription=this.service.result$.subscribe(function(t){e.locations=t.locations?t.locations:[],e.deviceCount=t.size?t.size:0,e.loadMap(),e.loader=!1},function(t){e.loader=!1})}},{key:"loadMap",value:function(){var e=this;this.map=new Microsoft.Maps.Map("#myMap",{credentials:r.N.BING_API_KEY,zoom:1}),this.map.setView({mapTypeId:Microsoft.Maps.MapTypeId.road}),this.map.setOptions({showLogo:!1,showDashboard:!1,showMapTypeSelector:!1,showCopyright:!1,disableBirdseye:!0,disableStreetside:!1}),this.infobox=new Microsoft.Maps.Infobox(this.map.getCenter(),{visible:!1}),this.infobox.setMap(this.map),Microsoft.Maps.registerModule("SpiderClusterManager","assets/js/SpiderClusterManager.js"),Microsoft.Maps.loadModule(["SpiderClusterManager"],function(){for(var t={},n=e.locations.length,i=0;i<n;i++){t=e.createSpiderIcon("2");var o=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(e.locations[i].lat,e.locations[i].lng),t);o.metadata=e.locations[i],e.pins.push(o)}e.spiderManager=new SpiderClusterManager(e.map,e.pins,{pinSelected:function(t,n){e.showInfobox(n?n.getLocation():t.getLocation(),t.metadata.macAddr)},pinUnselected:function(){e.hideInfobox()},clusteredPinCallback:e.createCustomClusteredPin,gridSize:80})})}},{key:"addJsToElement",value:function(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,this.renderer.appendChild(document.head,t),t}},{key:"tableView",value:function(){this.mapView=!1}},{key:"mapViewFunction",value:function(){this.mapView=!0}},{key:"createSpiderIcon",value:function(e){var t=12,n="rgba(255, 40, 40, 0.9)";"1"==e?n="rgba(20, 180, 20, 0.9)":"2"==e?n="rgba(255, 210, 40, 0.9)":"3"==e&&(n="rgba(128, 0, 128, 0.9)");var i=3;return{icon:['<svg xmlns="http://www.w3.org/2000/svg" width="',2*t,'" height="',2*t,'" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd"><g id="UrTavla"><circle cx="',t,'" cy="',t,'" r="',t-i,'" stroke="',"rgba(255, 255, 255, 0.7)",'" stroke-width="',i,'" fill="',n,'"/>    <text x="50%" y="50%" text-anchor="middle" fill="white" dy=".3em"></text></g></svg>'].join(""),anchor:new Microsoft.Maps.Point(t,t)}}},{key:"createCustomClusteredPin",value:function(e){var t=e.containedPushpins.length,n=Math.log(t)/Math.log(10)*5+15,i=n,o="assets/images/m1.png";t<10?(o="assets/images/m1.png",i=n):t<100?(o="assets/images/m2.png",i=n):t<1e3?(o="assets/images/m3.png",i=n+1):(o="assets/images/m5.png",i=n+9),e.setOptions({icon:o,anchor:new Microsoft.Maps.Point(n,n),textOffset:new Microsoft.Maps.Point(0,i)})}},{key:"showInfobox",value:function(e,t){var n=this;this.loader=!0,this.service.getGeoTelemetryData(t).subscribe(function(t){var i=t.result,o=[];if(i&&i.apps)for(var a=0;a<i.apps.length;a++)o.push(n.containers[i.apps[a].name]?n.containers[i.apps[a].name]:i.apps[a].name);i.appNames=o.join(", "),n.loader=!1,n.infobox.setOptions({location:e,title:n.language["System Information"],description:"\n        FSAN: ".concat(i.fsanSerialNumber?i.fsanSerialNumber:"","<br/>\n        ").concat(n.language["MAC Address"]," : ").concat(i.macAddr,"<br/>\n        ").concat(n.language.Model_Number," : ").concat(i.modelNumber,"<br/>\n        ").concat(n.language["Serial Number"]," : ").concat(i.serialNumber,"\n        <br/>\n        ").concat(n.language.Firmware_Version," : ").concat(void 0!==i.firmwareVersion?i.firmwareVersion:"","\n        <br/>\n        \n                          "),visible:!0,width:300})},function(e){n.loader=!1})}},{key:"hideInfobox",value:function(){void 0!==this.infobox&&this.infobox.setOptions({visible:!1})}},{key:"open",value:function(e,t){var n=this;console.log(t);var i=document.getElementById("".concat(t.target.id));i.disabled=!0,this.service.getGeoTelemetryData(e).subscribe(function(e){i.disabled=!1;var t=[];if(e&&e.result&&e.result.apps)for(var o=0;o<e.result.apps.length;o++)t.push(n.containers[e.result.apps[o].name]?n.containers[e.result.apps[o].name]:e.apps[o].name);n.tablePopupData=Object.assign({appNames:t.join(", ")},e.result),n.close(),n.loader=!1,n.modalRef=n.dialogService.open(n.fullScreeenModal)},function(e){i.disabled=!1})}},{key:"close",value:function(){this.modalRef&&this.modalRef.close()}},{key:"ngOnDestroy",value:function(){this.serviceSubscription&&this.serviceSubscription.unsubscribe(),this.service.undoService(),this.languageSubject.unsubscribe()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(s.Y36(s.Qsj),s.Y36(u),s.Y36(d.FF),s.Y36(p.s),s.Y36(g.F0),s.Y36(f.Dx))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-map"]],viewQuery:function(e,t){var n;(1&e&&s.Gf(b,7),2&e)&&(s.iGM(n=s.CRH())&&(t.fullScreeenModal=n.first))},hostVars:2,hostBindings:function(e,t){2&e&&s.Tol(t.classes)},decls:28,vars:16,consts:[["class","alert alert-warning alert-dismissible fade show","role","alert",4,"ngIf"],["class","loader",4,"ngIf"],[1,"main-card-exception",3,"hidden","ngClass"],[1,"w-100","position-relative"],["id","myMap",1,"map-v",3,"dblclick","mousedown","scroll"],[1,"flex-around","pos-abs-w",3,"hidden"],[4,"ngIf"],[3,"ngClass","hidden"],["class","modal-footer  border-reset mr-2",4,"ngIf"],[1,"p-2"],[1,"table-responsive"],[1,"table","table-bordered"],["class","col-md-8"],["fullScreeenModal",""],["role","alert",1,"alert","alert-warning","alert-dismissible","fade","show"],["type","button","data-dismiss","alert","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"loader"],[1,"d-flex","justify-content-center"],["role","",1,"spinner-border","text-primary"],[1,"sr-only"],[1,"btn","btn-white","ml-2","font-14","cursor-default"],[1,"btn","btn-white","ml-2","font-14"],[1,"btn","btn-white","font-14","mr-2",3,"click"],[1,"fa","fa-list","mr-1"],[1,"modal-footer","border-reset","mr-2"],[1,"btn","btn-sm","btn-success",3,"click"],[4,"ngFor","ngForOf"],[1,"btn","btn-success","btn-sm",3,"id","click"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],[1,"modal-body"],[1,"p-2","border-bot-grey"],[1,"f-15","w-150p"],[1,"f-15"]],template:function(e,t){1&e&&(s.TgZ(0,"div"),s.YNc(1,m,6,2,"div",0),s.YNc(2,v,5,0,"div",1),s.TgZ(3,"div",2),s.TgZ(4,"div",3),s.TgZ(5,"div",4),s.NdJ("dblclick",function(){return t.hideInfobox()})("mousedown",function(){return t.hideInfobox()})("scroll",function(){return t.hideInfobox()}),s.qZA(),s.TgZ(6,"div",5),s.YNc(7,Z,3,2,"div",6),s.YNc(8,w,3,2,"div",6),s.YNc(9,x,4,1,"div",6),s.qZA(),s.qZA(),s.qZA(),s.TgZ(10,"div",7),s.YNc(11,A,3,1,"div",8),s.TgZ(12,"div",9),s.TgZ(13,"div",10),s.TgZ(14,"table",11),s.TgZ(15,"thead"),s.TgZ(16,"tr"),s.TgZ(17,"th"),s._uU(18),s.qZA(),s.TgZ(19,"th"),s._uU(20),s.qZA(),s.TgZ(21,"th"),s._uU(22),s.qZA(),s.TgZ(23,"th"),s._uU(24),s.qZA(),s.qZA(),s.qZA(),s.YNc(25,T,2,1,"tbody",6),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.YNc(26,_,38,10,"ng-template",12,13,s.W1O)),2&e&&(s.xp6(1),s.Q6J("ngIf",t.error),s.xp6(1),s.Q6J("ngIf",t.loader),s.xp6(1),s.Q6J("hidden",t.error)("ngClass",t.mapView?"d-block":"d-none"),s.xp6(3),s.Q6J("hidden",t.error),s.xp6(1),s.Q6J("ngIf",t.foundationEnable),s.xp6(1),s.Q6J("ngIf",!t.foundationEnable),s.xp6(1),s.Q6J("ngIf",!t.router.url.includes("cco-foundation/foundation-systems/foundation-geographic-view")),s.xp6(1),s.Q6J("ngClass",t.mapView?"d-none":"d-block")("hidden",t.error),s.xp6(1),s.Q6J("ngIf",!t.router.url.includes("cco-foundation/foundation-systems/foundation-geographic-view")),s.xp6(7),s.Oqu(t.foundationEnable?t.language.System_MAC_address:t.language.Device_MAC_Address),s.xp6(2),s.Oqu(t.language.Location_Latitude),s.xp6(2),s.Oqu(t.language.Location_Longitude),s.xp6(2),s.Oqu(t.language.Action),s.xp6(1),s.Q6J("ngIf",t.locations))},directives:[h.O5,h.mk,h.sg],styles:[".btn-white[_ngcontent-%COMP%]{background-color:#fff!important;border:1px solid #ccc}.btn-white[_ngcontent-%COMP%]:hover{background-color:#fff!important;border:1px solid #fff}.flex-around[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.f-15[_ngcontent-%COMP%]{font-size:15px!important}.cursor-default[_ngcontent-%COMP%]{cursor:default!important}.map-v[_ngcontent-%COMP%]{width:100%;height:80vh}.border-bot-grey[_ngcontent-%COMP%]{border:.5px solid #e3ebf3}.w-150p[_ngcontent-%COMP%]{width:150px}.pos-abs-w[_ngcontent-%COMP%]{position:absolute;width:100%;top:20px}"]}),t}()}}])}();