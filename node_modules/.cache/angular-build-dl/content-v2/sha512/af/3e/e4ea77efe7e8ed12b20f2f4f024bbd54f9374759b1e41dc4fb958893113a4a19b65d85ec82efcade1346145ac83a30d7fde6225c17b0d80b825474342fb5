"use strict";(self.webpackChunkcalix=self.webpackChunkcalix||[]).push([[8686],{38686:function(t,e,i){i.r(e),i.d(e,{CcoAlarmNotificationsModule:function(){return it}});var n=i(38583),o=i(3679),a=i(39895),s=i(15835),l=i(19642),r=i(55634),c=i(23771),d=i(79765),u=i(25917),g=i(35758),h=i(5304),p=i(92340),f=i(37716),m=i(91841),_=i(7450),A=i(49342),b=i(89097),O=i(39075),v=i(12664),Z=i(48483),w=i(86640);const C=["notificationModal"];function x(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",32),f.TgZ(1,"span",33),f._UZ(2,"img",34),f.qZA(),f.TgZ(3,"span",35),f._uU(4),f.TgZ(5,"b"),f._uU(6),f.qZA(),f._uU(7,"? "),f.qZA(),f.TgZ(8,"div",36),f.TgZ(9,"button",37),f.NdJ("click",function(){return f.CHM(t),f.oxw().deleteAlarmWorkflowId()}),f._uU(10),f.qZA(),f.TgZ(11,"button",38),f.NdJ("click",function(){return f.CHM(t),f.oxw().closeModal()}),f._uU(12),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=f.oxw();f.xp6(4),f.hij(" ",t.language[t.deleteWarnMsg]?t.language[t.deleteWarnMsg]:t.deleteWarnMsg," "),f.xp6(2),f.Oqu(t.modalInfo),f.xp6(3),f.Q6J("disabled",t.btnDisabled),f.xp6(1),f.hij(" ",t.language.Confirm," "),f.xp6(2),f.hij(" ",t.language.Cancel," ")}}function T(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",39),f.TgZ(1,"span",40),f._UZ(2,"img",41),f.qZA(),f.TgZ(3,"button",42),f.NdJ("click",function(){return f.CHM(t),f.oxw().closeAlert()}),f._UZ(4,"span"),f.qZA(),f._UZ(5,"div",43),f.qZA()}if(2&t){const t=f.oxw();f.xp6(5),f.Q6J("innerHtml",t.language[t.errorInfo]||t.errorInfo,f.oJD)}}function y(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",45),f.TgZ(1,"span",40),f._UZ(2,"img",41),f.qZA(),f.TgZ(3,"button",42),f.NdJ("click",function(){const e=f.CHM(t).index;return f.oxw(2).closeAlert(e)}),f._UZ(4,"span"),f.qZA(),f._UZ(5,"div",46),f.qZA()}if(2&t){const t=e.$implicit,i=f.oxw(2);f.xp6(5),f.Q6J("innerHtml",i.language[t]||t,f.oJD)}}function P(t,e){if(1&t&&(f.TgZ(0,"div"),f.YNc(1,y,6,1,"div",44),f.qZA()),2&t){const t=f.oxw();f.xp6(1),f.Q6J("ngForOf",t.errors)}}function N(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",47),f.TgZ(1,"span",48),f._UZ(2,"img",49),f.qZA(),f.TgZ(3,"button",42),f.NdJ("click",function(){return f.CHM(t),f.oxw().success=!1}),f._UZ(4,"span"),f.qZA(),f._UZ(5,"div",43),f.qZA()}if(2&t){const t=f.oxw();f.xp6(5),f.Q6J("innerHtml",t.language[t.successInfo]||t.successInfo,f.oJD)}}function q(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div"),f.TgZ(1,"button",50),f.NdJ("click",function(){return f.CHM(t),f.oxw().showNotification()}),f._uU(2),f.qZA(),f.qZA()}if(2&t){const t=f.oxw();f.xp6(2),f.hij(" ",t.language["New Notification"]," ")}}function M(t,e){1&t&&f._UZ(0,"div")}function S(t,e){if(1&t&&(f.TgZ(0,"div",51),f.TgZ(1,"div",29),f.TgZ(2,"div",52),f.TgZ(3,"div",53),f.TgZ(4,"div",54),f.TgZ(5,"span",55),f._uU(6),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw();f.xp6(6),f.Oqu(t.language.Loading)}}function R(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",56),f.NdJ("click",function(){return f.CHM(t),f.oxw().clearInput()}),f.TgZ(1,"button",57),f._UZ(2,"span"),f.qZA(),f.qZA()}}function E(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"button",67),f.NdJ("click",function(){f.CHM(t);const e=f.oxw().$implicit;return f.oxw().getAlarmWorkflowId(e)}),f._uU(1),f.qZA()}if(2&t){const t=f.oxw(2);f.xp6(1),f.hij(" ",t.language.Edit," ")}}function L(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"button",67),f.NdJ("click",function(){f.CHM(t);const e=f.oxw().$implicit;return f.oxw().pauseContinueWorkflow(e,"pause",e.ui_modified_notification_type)}),f._uU(1),f.qZA()}if(2&t){const t=f.oxw(2);f.xp6(1),f.hij(" ",t.language.Pause," ")}}function I(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"button",67),f.NdJ("click",function(){f.CHM(t);const e=f.oxw().$implicit;return f.oxw().pauseContinueWorkflow(e,"activate",e.ui_modified_notification_type)}),f._uU(1),f.qZA()}if(2&t){const t=f.oxw(2);f.xp6(1),f.hij(" ",t.language.Activate," ")}}function U(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"button",67),f.NdJ("click",function(){f.CHM(t);const e=f.oxw().$implicit;return f.oxw().getAlarmWorkflowId(e)}),f._uU(1),f.qZA()}if(2&t){const t=f.oxw(2);f.xp6(1),f.hij(" ",t.language.Edit," ")}}function k(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"tr"),f.TgZ(1,"td",58),f.TgZ(2,"a",59),f.NdJ("click",function(){const e=f.CHM(t).$implicit;return f.oxw().getAlarmNotificationSummary(e)}),f._uU(3),f.qZA(),f.qZA(),f.TgZ(4,"td"),f._uU(5),f.qZA(),f.TgZ(6,"td"),f._uU(7),f.qZA(),f.TgZ(8,"td"),f._uU(9),f.qZA(),f.TgZ(10,"td"),f._uU(11),f.qZA(),f.TgZ(12,"td"),f.TgZ(13,"div",60),f._UZ(14,"span",61),f._uU(15),f.qZA(),f.qZA(),f.TgZ(16,"td",62),f.TgZ(17,"div",63),f.TgZ(18,"button",64),f._uU(19," ... "),f.qZA(),f.TgZ(20,"div",65),f.YNc(21,E,2,1,"button",66),f.YNc(22,L,2,1,"button",66),f.YNc(23,I,2,1,"button",66),f.TgZ(24,"button",67),f.NdJ("click",function(){const e=f.CHM(t).$implicit;return f.oxw().delete(e)}),f._uU(25),f.qZA(),f.YNc(26,U,2,1,"button",66),f.qZA(),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit,i=f.oxw();f.xp6(3),f.Oqu(t.name?t.name:""),f.xp6(2),f.Oqu(t.ui_modified_notification_type_display),f.xp6(2),f.hij(" ",t.trigger?t.trigger:""," "),f.xp6(2),f.Oqu(null!=t&&t.methods?t.methods:""),f.xp6(2),f.Oqu(t.description?t.description:""),f.xp6(2),f.Q6J("ngClass","Draft"==t.mod_status?"draft-but":"Running"==t.mod_status?"running-but":"paused-but"),f.xp6(2),f.hij(" ",t.mod_status?i.language[t.mod_status]||t.mod_status:""," "),f.xp6(6),f.Q6J("ngIf","DRAFT"==t.status||"PAUSE"==t.status),f.xp6(1),f.Q6J("ngIf","RUN"==t.status),f.xp6(1),f.Q6J("ngIf","PAUSE"==t.status),f.xp6(2),f.hij(" ",i.language.Delete," "),f.xp6(1),f.Q6J("ngIf",0==t.active)}}function W(t,e){if(1&t&&(f.TgZ(0,"div",79),f._uU(1),f.qZA(),f.TgZ(2,"div",80),f._uU(3),f.qZA()),2&t){const t=e.item,i=f.oxw(2);f.s9C("title",i.language[t.name]||t.name),f.xp6(1),f.hij(" ",i.language[t.name]||t.name," "),f.xp6(1),f.s9C("title",i.language[t.content]||t.content),f.xp6(1),f.hij(" ",i.language[t.content]||t.content," ")}}function $(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",68),f.TgZ(1,"button",69),f.NdJ("click",function(){return f.CHM(t),f.oxw().close()}),f._UZ(2,"span"),f.qZA(),f.qZA(),f.TgZ(3,"div",70),f.TgZ(4,"div",71),f._uU(5),f.qZA(),f.TgZ(6,"p",72),f._uU(7),f.qZA(),f.TgZ(8,"div",73),f.TgZ(9,"ng-select",74),f.YNc(10,W,4,4,"ng-template",75),f.qZA(),f.qZA(),f.TgZ(11,"div",76),f.TgZ(12,"button",77),f.NdJ("click",function(){return f.CHM(t),f.oxw().goto()}),f._uU(13),f.qZA(),f.TgZ(14,"button",78),f.NdJ("click",function(){return f.CHM(t),f.oxw().close()}),f._uU(15),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=f.oxw();f.xp6(5),f.Oqu(t.language["New Notification"]),f.xp6(2),f.Oqu(t.language["Notification Type"]),f.xp6(1),f.Q6J("formGroup",t.notificatonForm),f.xp6(1),f.Q6J("clearable",!1)("items",t.notificationTypes),f.xp6(3),f.Q6J("disabled",!t.notificatonForm.valid),f.xp6(1),f.hij(" ",t.language["Start Notification"]," "),f.xp6(2),f.hij(" ",t.language.Cancel," ")}}const Y=function(t){return{showHideTable:t}};let J=(()=>{class t{constructor(t,e,i,n,a,s,l,r,c,u){this.http=t,this.translateService=e,this.router=i,this.commonOrgService=n,this.service=a,this.titleService=s,this.document=l,this.modalService=r,this.fb=c,this.dateUtils=u,this.types=["OPTICAL_OUTLIERS","EARLY_WARN_PON_CAP","EARLY_WARN_ETH_CAP","EARLY_WARN_PON_LOSS","outage","optical"],this.healthTypes=["OPTICAL_OUTLIERS","EARLY_WARN_PON_CAP","EARLY_WARN_ETH_CAP","EARLY_WARN_PON_LOSS","outliers","optical"],this.urls={add:{outage:"/cco/outage-workflow",optical:"/cco/notifications/health/OPTICAL_OUTLIERS/add",outliers:"/cco/notifications/health/OPTICAL_OUTLIERS/add",OPTICAL_OUTLIERS:"/cco/notifications/health/OPTICAL_OUTLIERS/add",EARLY_WARN_PON_CAP:"/cco/notifications/health/EARLY_WARN_PON_CAP/add",EARLY_WARN_ETH_CAP:"/cco/notifications/health/EARLY_WARN_ETH_CAP/add",EARLY_WARN_PON_LOSS:"/cco/notifications/health/EARLY_WARN_PON_LOSS/add"},edit:{outage:"/cco/outage-workflow",optical:"/cco/notifications/health/OPTICAL_OUTLIERS/edit/",outliers:"/cco/notifications/health/OPTICAL_OUTLIERS/add",OPTICAL_OUTLIERS:"/cco/notifications/health/OPTICAL_OUTLIERS/edit/",EARLY_WARN_PON_CAP:"/cco/notifications/health/EARLY_WARN_PON_CAP/edit/",EARLY_WARN_ETH_CAP:"/cco/notifications/health/EARLY_WARN_ETH_CAP/edit/",EARLY_WARN_PON_LOSS:"/cco/notifications/health/EARLY_WARN_PON_LOSS/edit/"}},this.notificationTypes=[],this.map={outage:"Internet Outage",alarm:"Alarm",outliers:"Optical Outliers",OPTICAL_OUTLIERS:"Optical Outliers",EARLY_WARN_PON_CAP:"Early Warning PON Capacity",EARLY_WARN_ETH_CAP:"Early Warning Ethernet Capacity",EARLY_WARN_PON_LOSS:"Early Warning PON Loss"},this.showcloseicon=!1,this.renderedOnce=!0,this.errorMsg=void 0,this.errorInfo="",this.successInfo="",this.filterSelected="all",this.filterArray=[{id:"all",name:"All Types"},{id:"alarm",name:"Alarm"},{id:"outage",name:"Internet Outage"},{id:"OPTICAL_OUTLIERS",name:"Optical Outliers"},{id:"EARLY_WARN_PON_CAP",name:"Early Warning PON Capacity"},{id:"EARLY_WARN_ETH_CAP",name:"Early Warning Ethernet Capacity"},{id:"EARLY_WARN_PON_LOSS",name:"Early Warning PON Loss"}],this.dtOptions={},this.dtTrigger=new d.xQ,this.alarmWorkFlowList=[],this.baseUrl=`${p.N.API_BASE_URL}analytics-engine/`,this.cco_entitlement=!1,this.hasWriteAccess=!1,this.notificatonForm=this.fb.group({notificaton:["alarm",o.kI.required]}),this.disableBtnForstrtNtfcn=!0,this.searchInput="",this.errors=[],this.showRecipients=!1,this.deleteWarnMsg="",this.frTable=this.translateService.fr,this.esTable=this.translateService.es,this.germanTable=this.translateService.de_DE}ngOnInit(){var t,e;this.notificatonForm.valueChanges.subscribe(t=>{console.log(t),this.disableBtnForstrtNtfcn=!1}),this.language=this.translateService.defualtLanguage,this.languageSubject=this.translateService.selectedLanguage.subscribe(t=>{this.loading=!0,this.language=t,this.tableLanguageOptions(),this.reloadTable(!0),this.titleService.setTitle(`${this.language.Notifications} - ${this.language["Alarm & Health Notifications"]} - ${this.language.Alarms} - ${this.language.Operations} - ${this.language.Operations} - ${this.language["Calix Cloud"]}`)}),this.notificationTypes=[{id:"alarm",name:"Alarm",content:"Get notified when alarms are triggered"},{id:"outage",name:"Internet Outage",content:"Receive an immediate outage notification for monitored areas"},{id:"optical",name:"Optical Outliers",content:"Receive a weekly report on selected OLT systems"},{id:"EARLY_WARN_PON_CAP",name:"Early Warning PON Capacity",content:"Receive a weekly report on siginificant PON capacity changes"},{id:"EARLY_WARN_ETH_CAP",name:"Early Warning Ethernet Capacity",content:"Receive a weekly report on  siginificant Ethernet capacity changes"},{id:"EARLY_WARN_PON_LOSS",name:"Early Warning PON Loss",content:"Receive a weekly report on  siginificant PON Loss"}],this.titleService.setTitle(`${this.language.Notifications} - ${this.language["Alarm & Health Notifications"]} - ${this.language.Alarms} - ${this.language.Operations} - ${this.language.Operations} - ${this.language["Calix Cloud"]}`);let i=this.service.getEntitlements();i[210]&&!i[102]&&(this.cco_entitlement=!0),this.renderedOnce=!0,this.dtOptions={pagingType:"full_numbers",pageLength:10,lengthChange:!1,paging:!0,processing:!1,dom:"tipr",autoWidth:!1,columnDefs:[{targets:[0],orderable:!0,width:"23%"},{targets:[1],width:"23%"},{targets:[2],width:"23%"},{targets:[3],width:"16%"},{targets:[6],width:"15%",orderable:!1,className:"dt-right"}],order:[0,"asc"]},this.cco_entitlement&&(this.dtOptions.columnDefs[4].visible=!1),this.searchtext=(null===(t=null==history?void 0:history.state)||void 0===t?void 0:t.ccoAlarmNotificationsText)||"";let n=this.service.getScopes();p.N.VALIDATE_SCOPE&&(n&&-1!==(null===(e=n["cloud.rbac.coc.operations.alarms.alarmsandhealthnotifications"])||void 0===e?void 0:e.indexOf("write"))?this.hasWriteAccess=!0:this.dtOptions.columnDefs[4].visible=!1),this.tableLanguageOptions(),this.getAlarmWorkflowList()}ngAfterViewInit(){this.dtTrigger.next()}tableLanguageOptions(){"fr"==this.language.fileLanguage?this.dtOptions.language=this.frTable:"es"==this.language.fileLanguage?this.dtOptions.language=this.esTable:this.language&&this.language.fileLanguage&&"de_DE"==this.language.fileLanguage?this.dtOptions.language=this.germanTable:"en"==this.language.fileLanguage&&this.dtOptions.language&&delete this.dtOptions.language}closeicon(t){this.searchtext="",this.showcloseicon=!1,this.search(this.searchtext)}search(t){this.showcloseicon=!!t.length,this.dtElement.dtInstance.then(e=>{e.columns(0).search(t).draw()}),this.loading=!1}renderTable(t){this.tableLanguageOptions(),this.renderedOnce?(this.rerender(),setTimeout(()=>{this.dataAvailable=!0,this.renderedOnce=!1,this.loading=!1},200)):(this.rerender(),this.dataAvailable=!1,this.loading=!0,setTimeout(()=>{this.dataAvailable=!0,this.loading=!1},200)),setTimeout(()=>{this.searchtext&&this.search(this.searchtext)},200)}rerender(t){this.dtElement.dtInstance.then(t=>{t.clear(),t.destroy(),this.dtTrigger.next()}),setTimeout(()=>{t&&this.search(this.searchtext)},1e3)}reloadTable(t){this.dtElement.dtInstance.then(t=>{t.destroy(),this.dtTrigger.next()}),setTimeout(()=>{t&&this.search(this.searchtext)},1e3)}closeAlert(t){this.error=!1,void 0!==t&&(this.errors.splice(t,1),this.errors=[...this.errors])}getAlarmWorkflowList(){if(this.alarmWorkFlowList=[],"all"==this.filterSelected)return void this.getData();let t={alarm:`${this.baseUrl}workflows`,outage:`${this.baseUrl}outageworkflows`};this.loading=!0,this.error=!1,this.errorInfo=void 0;let e=t[this.filterSelected];e=e||`${p.N.API_BASE_URL}health/config/notifications?type=${this.filterSelected}`,this.http.get(e).subscribe(t=>{t&&t.length>0?((t=t.filter(t=>t)).forEach(t=>{var e,i,n;t&&(t.mod_status=t.status,t.ui_modified_notification_type_display=this.map[this.filterSelected],t.ui_modified_notification_type=(null==t?void 0:t.type)?null==t?void 0:t.type:this.filterSelected,"RUN"==t.status?t.mod_status="Running":"PAUSE"==t.status?t.mod_status="Paused":"DRAFT"==t.status&&(t.mod_status="Draft"),t.trigger="",(null===(e=null==t?void 0:t.schedule)||void 0===e?void 0:e.immediate)?t.schedule.immediate&&(t.trigger="Immediate"):(null==t?void 0:t.schedule)&&0==(null===(i=t.schedule)||void 0===i?void 0:i.immediate)&&(t.trigger="Scheduled"),"outage"===this.filterSelected&&(t.trigger="Immediate"),-1!==(null===(n=this.healthTypes)||void 0===n?void 0:n.indexOf(this.filterSelected))&&(t.trigger="Weekly"),t.methods=this.prepareMethods(t,this.filterSelected))}),this.alarmWorkFlowList=[...t.filter(t=>t).reverse()],this.loading=!1,this.renderTable(!1)):(this.alarmWorkFlowList=[],this.loading=!1,this.renderTable(!1))},t=>{this.error=!0,this.pageErrorHandle(t),this.loading=!1,this.renderTable(!1)})}pageErrorHandle(t){return this.errorInfo=401==t.status?"Access Denied":this.commonOrgService.pageErrorHandle(t),this.closeAlert(),this.error=!0,this.errorInfo}getAlarmWorkflowId(t){var e;let i=(null==t?void 0:t.uuid)?t.uuid:null==t?void 0:t.name;-1!==(null===(e=this.healthTypes)||void 0===e?void 0:e.indexOf(null==t?void 0:t.ui_modified_notification_type))?this.router.navigateByUrl(`${this.urls.edit[null==t?void 0:t.ui_modified_notification_type]}${i}`,{state:{ccoAlarmNotificationsText:this.searchtext||""}}):this.router.navigateByUrl("outage"===(null==t?void 0:t.ui_modified_notification_type)?`/cco/outage-workflow/edit/${i}`:`/cco/alarm-notifications/edit/${i}`,{state:{ccoAlarmNotificationsText:this.searchtext||""}})}deleteAlarmWorkflowId(){var t,e;this.error=!1,this.success=!1,this.errorInfo=void 0,this.successInfo=void 0,this.btnDisabled=!0;let i=this.deletedata.uuid;this.loading=!0;let n=`${this.baseUrl}workflow/${i}`;n="alarm"===(null===(t=this.deletedata)||void 0===t?void 0:t.ui_modified_notification_type)?`${this.baseUrl}workflow/${i}`:"outage"===(null===(e=this.deletedata)||void 0===e?void 0:e.ui_modified_notification_type)?`${this.baseUrl}outageworkflow/${i}`:`${p.N.API_BASE_URL}health/config/notifications/${encodeURIComponent(this.deletedata.name)}`;let o={alarm:"Alarm Notification Schedule successfully deleted",outage:"Internet Outage Notification Schedule successfully deleted",outliers:"Optical Outliers Notification Schedule successfully deleted",OPTICAL_OUTLIERS:"Optical Outliers Notification Schedule successfully deleted",EARLY_WARN_PON_CAP:"Early Warning PON Capacity Notification Schedule successfully deleted",EARLY_WARN_ETH_CAP:"Early Warning Ethernet Capacity Notification Schedule successfully deleted",EARLY_WARN_PON_LOSS:"Early Warning PON Loss Notification Schedule successfully deleted"};this.http.delete(`${n}`,{responseType:"text"}).subscribe(t=>{this.btnDisabled=!1,this.success=!0,this.successInfo=o[this.deletedata.ui_modified_notification_type],this.closeModal(),setTimeout(()=>{this.success=!1,this.successInfo=void 0,this.getAlarmWorkflowList()},3e3)},t=>{this.btnDisabled=!1,this.error=!0,this.loading=!1,this.pageErrorHandle(t)})}goto(){var t;this.close(),-1!==(null===(t=this.types)||void 0===t?void 0:t.indexOf(this.notificatonForm.get("notificaton").value))?this.router.navigate([this.urls.add[this.notificatonForm.get("notificaton").value]]):this.router.navigateByUrl("/cco/alarm-notifications/new",{state:{ccoAlarmNotificationsText:this.searchtext||""}})}delete(t){this.deleteWarnMsg={alarm:"Are you sure you want to delete Alarm Notification",outage:"Are you sure you want to delete Internet Outage Notification",outliers:"Are you sure you want to delete Optical Outliers Notification",OPTICAL_OUTLIERS:"Are you sure you want to delete Optical Outliers Notification",EARLY_WARN_PON_CAP:"Are you sure you want to delete Early Warning PON Capacity Notification",EARLY_WARN_ETH_CAP:"Are you sure you want to delete Early Warning Ethernet Capacity Notification",EARLY_WARN_PON_LOSS:"Are you sure you want to delete Early Warning PON Loss Notification"}[null==t?void 0:t.ui_modified_notification_type],this.deletedata=t,this.modalInfo=this.deletedata.name,this.document.body.scrollIntoView({block:"start",behavior:"smooth"})}closeModal(){this.deletedata=""}pauseContinueWorkflow(t,e,i){var n;let o={alarm:`${this.baseUrl}deployWorkflow`,outage:`${this.baseUrl}outagedeployWorkflow`},a={alarm:{pause:"Alarm Notification Schedule successfully paused",activate:"Alarm Notification Schedule successfully deployed"},outage:{pause:"Internet Outage Notification Schedule successfully paused",activate:"Internet Outage Notification Schedule successfully deployed"},outliers:{pause:"Optical Outliers Notification Schedule successfully paused",activate:"Optical Outliers Notification Schedule successfully deployed"},OPTICAL_OUTLIERS:{pause:"Optical Outliers Notification Schedule successfully paused",activate:"Optical Outliers Notification Schedule successfully deployed"},EARLY_WARN_PON_CAP:{pause:`${this.map.EARLY_WARN_PON_CAP} Notification Schedule successfully paused`,activate:`${this.map.EARLY_WARN_PON_CAP} Notification Schedule successfully deployed`},EARLY_WARN_ETH_CAP:{pause:`${this.map.EARLY_WARN_ETH_CAP} Notification Schedule successfully paused`,activate:`${this.map.EARLY_WARN_ETH_CAP} Notification Schedule successfully deployed`},EARLY_WARN_PON_LOSS:{pause:`${this.map.EARLY_WARN_PON_LOSS} Notification Schedule successfully paused`,activate:`${this.map.EARLY_WARN_PON_LOSS} Notification Schedule successfully deployed`}},s=`workflowId=${null==t?void 0:t.uuid}`;"pause"==e?s=s.concat("&status=PAUSE"):"activate"==e&&(s=s.concat("&status=RUN")),this.loading=!0,this.errorMsg=void 0,this.successInfo=void 0;let l=this.http.put(`${o[i]}?${s}`,null,{responseType:"text"});if(-1!==(null===(n=this.healthTypes)||void 0===n?void 0:n.indexOf(i))){let i={name:null==t?void 0:t.name,description:null==t?void 0:t.description,status:"activate"==e?"RUN":"PAUSE",regions:null==t?void 0:t.regions,locations:null==t?void 0:t.locations,systems:null==t?void 0:t.systems,emailRecipients:null==t?void 0:t.emailRecipients,emailNotes:null==t?void 0:t.emailNotes,type:null==t?void 0:t.type,sms:null==t?void 0:t.sms,webhooks:null==t?void 0:t.webhooks,timeZone:this.dateUtils.getTImeZoneWithOffset()},n=`${p.N.API_BASE_URL}health/config/notifications/${encodeURIComponent(t.name)}`;l=this.http.put(n,i,{responseType:"text"})}l.subscribe(t=>{this.success=!0,this.successInfo=a[i][e],setTimeout(()=>{this.success=!1,this.getAlarmWorkflowList()},3e3),this.loading=!1},t=>{this.error=!0,this.loading=!1,this.btnDisabled=!1,this.pageErrorHandle(t)})}getAlarmNotificationSummary(t){var e;-1!==(null===(e=this.healthTypes)||void 0===e?void 0:e.indexOf(null==t?void 0:t.ui_modified_notification_type))?this.router.navigateByUrl(`/cco/operations/alarms/health-alarm-notifications/workflow/view/${encodeURIComponent(t.name)}`,{state:{ccoAlarmNotificationsText:this.searchtext||""}}):this.router.navigateByUrl("outage"===(null==t?void 0:t.ui_modified_notification_type)?`/cco/operations/alarms/health-alarm-notifications/outage-workflow/view/${t.uuid}`:`/cco/operations/alarms/health-alarm-notifications/alarm-notifications/view/${t.uuid}`,{state:{ccoAlarmNotificationsText:this.searchtext||""}})}avoidInitialSpacing(t){0===t.target.selectionStart&&"Space"===t.code&&t.preventDefault()}ngOnDestroy(){this.languageSubject&&this.languageSubject.unsubscribe(),this.dtTrigger.unsubscribe()}showNotification(){this.notificatonForm.patchValue({notificaton:"alarm"}),this.modalRef=this.modalService.open(this.notificationModal,{backdrop:"static",keyboard:!1,windowClass:"notification-large-modal"})}close(){this.modalRef.close()}clearInput(){this.searchtext="",this.search("")}getData(){if("all"!==this.filterSelected)return;let t={alarm:`${this.baseUrl}workflows`,outage:`${this.baseUrl}outageworkflows`,outliers:`${p.N.API_BASE_URL}health/config/notifications`};const e={};for(let i in t){const n=this.http.get(`${t[i]}`).pipe((0,h.K)(t=>(t["api-error"]=!0,(0,u.of)(t))));e[i]=n}this.loading=!0,this.error=!1,this.errorInfo=void 0,(0,g.D)(e).subscribe(t=>{let e=[...this.modifyResponse(t.alarm,"alarm"),...this.modifyResponse(t.outage,"outage"),...this.modifyResponse(t.outliers,"outliers")];e&&e.length>0?(this.alarmWorkFlowList=[...e.filter(t=>t).reverse()],this.loading=!1,this.renderTable(!1)):(this.alarmWorkFlowList=[],this.loading=!1,this.renderTable(!1))},t=>{this.error=!0,this.pageErrorHandle(t),this.loading=!1,this.renderTable(!1)})}modifyResponse(t,e){if(null==t?void 0:t["api-error"]){let e=[this.commonOrgService.pageErrorHandle(t)];return this.errors=[...this.errors,...e],[]}return null==t||t.forEach(t=>{var i,n,o;t&&(t.ui_modified_notification_type=(null==t?void 0:t.type)?null==t?void 0:t.type:e,t.ui_modified_notification_type_display=this.map[t.ui_modified_notification_type],t.mod_status=t.status,"RUN"==t.status?t.mod_status="Running":"PAUSE"==t.status?t.mod_status="Paused":"DRAFT"==t.status&&(t.mod_status="Draft"),t.trigger="",(null===(i=null==t?void 0:t.schedule)||void 0===i?void 0:i.immediate)?t.schedule.immediate&&(t.trigger="Immediate"):(null==t?void 0:t.schedule)&&0==(null===(n=t.schedule)||void 0===n?void 0:n.immediate)&&(t.trigger="Scheduled"),"outage"===e&&(t.trigger="Immediate"),-1!==(null===(o=this.healthTypes)||void 0===o?void 0:o.indexOf(e))&&(t.trigger="Weekly"),t.methods=this.prepareMethods(t,e))}),t}prepareMethods(t,e){var i,n,o,a;let s=[];return((null===(i=null==t?void 0:t.emails)||void 0===i?void 0:i.length)||(null===(n=null==t?void 0:t.emailRecipients)||void 0===n?void 0:n.length))&&s.push("Email"),(null===(o=null==t?void 0:t.sms)||void 0===o?void 0:o.length)&&s.push("SMS"),(null===(a=null==t?void 0:t.webhooks)||void 0===a?void 0:a.length)&&s.push("Webhook"),s.join(", ")}}return t.\u0275fac=function(e){return new(e||t)(f.Y36(m.eN),f.Y36(_.s),f.Y36(a.F0),f.Y36(A.v),f.Y36(b.t6),f.Y36(O.Dx),f.Y36(n.K0),f.Y36(v.FF),f.Y36(o.qu),f.Y36(Z.s))},t.\u0275cmp=f.Xpm({type:t,selectors:[["app-cco-alarm-notifications"]],viewQuery:function(t,e){if(1&t&&(f.Gf(C,7),f.Gf(c.G,5)),2&t){let t;f.iGM(t=f.CRH())&&(e.notificationModal=t.first),f.iGM(t=f.CRH())&&(e.dtElement=t.first)}},decls:54,vars:29,consts:[[1,"ccl-tabs","my-3"],["id","tabs",1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/cco/operations/alarms/health-alarm-notifications","routerLinkActive","active",1,"nav-link","small"],["routerLink","/cco/operations/alarms/health-alarm-notifications/recipients",1,"nav-link","small"],[1,"container","px-0"],["class","py-3 warning-msg d-flex align-items-start",4,"ngIf"],["class","w-100 alert alert-danger fade show my-3",4,"ngIf"],[4,"ngIf"],["class","w-100 alert alert-success fade show my-3",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"container"],[1,"row","mb-4"],[1,"col-md-12","px-0"],["class","row mb-3",4,"ngIf"],[1,"row","w-100","justify-content-between"],[1,"col-md-4","ccl-form","position-relative"],["type","text",3,"ngModel","placeholder","ngModelChange","keyup","search"],["class","close-clear",3,"click",4,"ngIf"],[1,"col-md-3","ccl-form","mb-2"],["bindValue","id","bindLabel","name",1,"w-100",3,"clearable","ngModel","items","ngModelChange","change"],["id","alarmNotificationsTable",1,"alarm-notifications-table","overflow-auto",3,"hidden"],["datatable","",1,"row-border","hover","table-alter","dataTable",3,"ngClass","dtOptions","dtTrigger"],["scope","col"],["scope","col",1,"min-w-230"],["scope","col",1,"text-left","min-w-50"],["scope","col",1,"min-w-50"],[4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-12"],["class",""],["notificationModal",""],[1,"py-3","warning-msg","d-flex","align-items-start"],[1,"error-img","pr-2","pt-1"],["src","./assets/img/warning-icon.svg"],[1,"warn-msg","pt-2"],[1,"btn-con-sec","float-right"],["id","deletePFBtn",1,"btn-default","primary","py-1","mr-2",3,"disabled","click"],[1,"btn-default","btn-dft","py-1",3,"click"],[1,"w-100","alert","alert-danger","fade","show","my-3"],[1,"error-img"],["src","./assets/img/ic_error-36px.svg"],["type","button",1,"close",3,"click"],[1,"d-inline-flex",3,"innerHtml"],["class","w-100 alert alert-danger fade show mt-4",4,"ngFor","ngForOf"],[1,"w-100","alert","alert-danger","fade","show","mt-4"],[1,"error-info-sec","d-inline-flex",3,"innerHtml"],[1,"w-100","alert","alert-success","fade","show","my-3"],[1,"success-img"],["src","./assets/img/success-icon.svg"],["type","button","id","add-device-group-btn",1,"btn-default","primary","px-3","mb-3",3,"click"],[1,"row","mb-3"],[1,"loader","mt-15"],[1,"d-flex","justify-content-center"],[1,"spinner-border","text-primary"],[1,"sr-only"],[1,"close-clear",3,"click"],[1,"close"],[1,"clickableRow"],[3,"click"],[3,"ngClass"],[1,"dot"],[1,""],[1,"dropdown","dropleft","text-center"],["type","button","id","anDropdownMenuBtn","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"btn","dropdown-toggle","px-0"],["aria-labelledby","anDropdownMenuBtn",1,"dropdown-menu","mt-4","ml-5"],["class","dropdown-item",3,"click",4,"ngIf"],[1,"dropdown-item",3,"click"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],[1,"notification-modal"],[1,"title","mb-3"],[1,"mb-2"],[1,"notification-list",3,"formGroup"],["width","100%","formControlName","notificaton","bindValue","id","bindLabel","name",1,"ng-select-datasource",3,"clearable","items"],["ng-option-tmp",""],[1,"modal-footer-button","mt-4"],["type","button",1,"my-2","mr-3","btn-default","primary","py-1",3,"disabled","click"],["type","button","id","callOutcomeBtnId",1,"btn-default","btn-dft","py-1",3,"click"],[1,"text-truncate",3,"title"],[1,"text-truncate","select-muted-text",3,"title"]],template:function(t,e){1&t&&(f.TgZ(0,"div",0),f.TgZ(1,"ul",1),f.TgZ(2,"li",2),f.TgZ(3,"a",3),f._uU(4),f.qZA(),f.qZA(),f.TgZ(5,"li",2),f.TgZ(6,"a",4),f._uU(7),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.TgZ(8,"section"),f.TgZ(9,"div",5),f.YNc(10,x,13,5,"div",6),f.YNc(11,T,6,1,"div",7),f.YNc(12,P,2,1,"div",8),f.YNc(13,N,6,1,"div",9),f.TgZ(14,"div",10),f.YNc(15,q,3,1,"div",8),f.YNc(16,M,1,0,"div",8),f.qZA(),f.qZA(),f.qZA(),f.TgZ(17,"section"),f.TgZ(18,"div",11),f.TgZ(19,"div",12),f.TgZ(20,"div",13),f.YNc(21,S,7,1,"div",14),f.TgZ(22,"div",15),f.TgZ(23,"div",16),f.TgZ(24,"input",17),f.NdJ("ngModelChange",function(t){return e.searchtext=t})("keyup",function(t){return e.search(t.target.value)})("search",function(t){return e.search(t.target.value)}),f.qZA(),f.YNc(25,R,3,0,"div",18),f.qZA(),f.TgZ(26,"div",19),f.TgZ(27,"ng-select",20),f.NdJ("ngModelChange",function(t){return e.filterSelected=t})("change",function(){return e.getAlarmWorkflowList()}),f.qZA(),f.qZA(),f.qZA(),f.TgZ(28,"div",21),f.TgZ(29,"table",22),f.TgZ(30,"thead"),f.TgZ(31,"tr"),f.TgZ(32,"th",23),f._uU(33),f.qZA(),f.TgZ(34,"th",23),f._uU(35),f.qZA(),f.TgZ(36,"th",23),f._uU(37),f.qZA(),f.TgZ(38,"th",23),f._uU(39),f.qZA(),f.TgZ(40,"th",24),f._uU(41),f.qZA(),f.TgZ(42,"th",25),f._uU(43),f.qZA(),f.TgZ(44,"th",26),f._uU(45),f.qZA(),f.qZA(),f.qZA(),f.TgZ(46,"tbody"),f.YNc(47,k,27,12,"tr",27),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.TgZ(48,"section"),f.TgZ(49,"div",11),f.TgZ(50,"div",28),f._UZ(51,"div",29),f.qZA(),f.qZA(),f.qZA(),f.YNc(52,$,16,8,"ng-template",30,31,f.W1O)),2&t&&(f.xp6(4),f.Oqu(e.language.Notifications),f.xp6(3),f.Oqu(e.language.Recipients),f.xp6(3),f.Q6J("ngIf",e.deletedata),f.xp6(1),f.Q6J("ngIf",e.error),f.xp6(1),f.Q6J("ngIf",e.errors.length),f.xp6(1),f.Q6J("ngIf",e.success),f.xp6(2),f.Q6J("ngIf",!e.cco_entitlement&&e.hasWriteAccess),f.xp6(1),f.Q6J("ngIf",e.cco_entitlement||!e.hasWriteAccess),f.xp6(5),f.Q6J("ngIf",e.loading),f.xp6(3),f.s9C("placeholder",e.language["Search notifications"]),f.Q6J("ngModel",e.searchtext),f.xp6(1),f.Q6J("ngIf",e.searchtext),f.xp6(2),f.Q6J("clearable",!1)("ngModel",e.filterSelected)("items",e.filterArray),f.xp6(1),f.Q6J("hidden",!e.dataAvailable),f.xp6(1),f.Q6J("ngClass",f.VKq(27,Y,e.loading))("dtOptions",e.dtOptions)("dtTrigger",e.dtTrigger),f.xp6(4),f.Oqu(e.language.name),f.xp6(2),f.Oqu(e.language.type),f.xp6(2),f.Oqu(e.language.Schedule),f.xp6(2),f.Oqu(e.language.Method),f.xp6(2),f.Oqu(e.language.Decription),f.xp6(2),f.Oqu(e.language.Status),f.xp6(2),f.Oqu(e.language.Action),f.xp6(2),f.Q6J("ngForOf",e.alarmWorkFlowList))},directives:[a.yS,a.Od,n.O5,o.Fj,o.JJ,o.On,w.w9,c.G,n.mk,n.sg,o.JL,o.sg,o.u,w.Z2],styles:[".alarm-notifications-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.alarm-notifications-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{border-bottom:1px solid #CCCCCC}.alarm-notifications-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:8px;word-break:break-all;font-size:16px;font-weight:600}.alarm-notifications-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px;word-break:break-word;font-size:15px;font-style:normal;font-weight:400;line-height:24px;letter-spacing:0em}.alarm-notifications-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#f8f8fa}.alarm-notifications-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(5){min-width:100px}.alarm-notifications-table[_ngcontent-%COMP%]   .mt-15[_ngcontent-%COMP%]{margin-top:15rem}.dropleft[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]:before{display:none!important}.dropdown-toggle[_ngcontent-%COMP%]{outline:none!important;border:none!important;background-color:transparent!important}.dropdown[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 5px 15px #80808040;-webkit-box-shadow:0px 5px 15px rgba(128,128,128,.25);border-color:#0000000d!important}.dropdown[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button.dropdown-item[_ngcontent-%COMP%]{width:100%!important;border-radius:0!important;text-align:left;padding:10px 25px}.dropdown[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#edf5ff!important}.clickableRow[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0279ff;cursor:pointer}.clickableRow[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#0054b2}.search-box[_ngcontent-%COMP%]{width:73%;padding-right:30px}.hide-close-search[_ngcontent-%COMP%]{display:none}.show-close-search[_ngcontent-%COMP%]{color:gray;display:block;position:absolute;right:40px;font-size:22px;top:2px}.showHideTable[_ngcontent-%COMP%]{visibility:hidden}.cco-med-title[_ngcontent-%COMP%]{font-weight:300;font-size:24px;line-height:30px;color:#1a1f22;margin-bottom:15px}.min-width-500[_ngcontent-%COMP%]{min-width:500px}.warn-msg[_ngcontent-%COMP%]{width:100%;word-wrap:break-word;display:inline-block}.close-clear[_ngcontent-%COMP%]{position:absolute;top:13px;right:25px;cursor:pointer}.close-clear[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:11.7px;height:11.7px;background-size:11.7px}.min-w-200[_ngcontent-%COMP%]{min-width:250px}.filter-select[_ngcontent-%COMP%]{min-width:200px}.notification-modal[_ngcontent-%COMP%]{padding:10px 38px}.notification-list[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .notification-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#1a1f22;font-weight:400;font-size:14px;line-height:18px}.notification-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#4c4c4c}  .notification-large-modal .modal-dialog{max-width:45.6%!important}.min-w-50[_ngcontent-%COMP%]{min-width:50px}.min-w-230[_ngcontent-%COMP%]{min-width:230px}.select-muted-text[_ngcontent-%COMP%]{color:gray}  .ng-select-datasource .ng-dropdown-panel .ng-dropdown-panel-items .ng-option{height:auto!important}"]}),t})();var H=i(22759),F=i(54395),D=i(87519),Q=i(43190);function j(t,e){if(1&t&&(f.TgZ(0,"div",25),f.TgZ(1,"div",26),f.TgZ(2,"div",27),f.TgZ(3,"span",28),f._uU(4),f.qZA(),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw();f.xp6(4),f.Oqu(t.language.Loading)}}function B(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",29),f.TgZ(1,"span",30),f._UZ(2,"img",31),f.qZA(),f.TgZ(3,"button",32),f.NdJ("click",function(){return f.CHM(t),f.oxw().closeAlert()}),f._UZ(4,"span"),f.qZA(),f._UZ(5,"div",33),f.qZA()}if(2&t){const t=f.oxw();f.xp6(5),f.Q6J("innerHtml",t.errorInfo,f.oJD)}}function z(t,e){if(1&t&&(f.TgZ(0,"div",34),f._uU(1),f.qZA()),2&t){const t=f.oxw();f.xp6(1),f.hij(" ",t.language["Access denied due to RBAC. Please consult your Organization Administrator for access."]," ")}}function G(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",35),f.NdJ("click",function(){return f.CHM(t),f.oxw().clearSearchInp()}),f.TgZ(1,"button",36),f._UZ(2,"span"),f.qZA(),f.qZA()}}function V(t,e){if(1&t&&(f.TgZ(0,"tr"),f.TgZ(1,"td",39),f._uU(2),f.qZA(),f.TgZ(3,"td"),f._uU(4),f.qZA(),f.TgZ(5,"td",40),f._uU(6),f.qZA(),f.TgZ(7,"td"),f.TgZ(8,"button"),f._UZ(9,"span",44),f._uU(10),f.qZA(),f.qZA(),f.TgZ(11,"td"),f._uU(12),f.qZA(),f.qZA()),2&t){const t=e.$implicit,i=f.oxw(2);f.xp6(2),f.Oqu(t.recipient),f.xp6(2),f.Oqu(t.notificationType),f.xp6(2),f.Oqu(t.notificationName),f.xp6(2),f.Gre("",i.colorBtnMap[t.status]," border-0"),f.xp6(2),f.Oqu(t.status),f.xp6(2),f.Oqu(i.convertToDateTime(t.updatedTime))}}function K(t,e){if(1&t&&(f.TgZ(0,"tbody"),f.TgZ(1,"tr"),f.TgZ(2,"td",45),f._uU(3),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw(2);f.xp6(3),f.Oqu(t.language["No matching records found"])}}function X(t,e){if(1&t&&(f.TgZ(0,"div",37),f.TgZ(1,"table",38),f.TgZ(2,"thead"),f.TgZ(3,"tr"),f.TgZ(4,"th",39),f._uU(5),f.qZA(),f.TgZ(6,"th"),f._uU(7),f.qZA(),f.TgZ(8,"th",40),f._uU(9),f.qZA(),f.TgZ(10,"th",41),f._uU(11),f.qZA(),f.TgZ(12,"th"),f._uU(13),f.qZA(),f.qZA(),f.qZA(),f.TgZ(14,"tbody"),f.YNc(15,V,13,8,"tr",42),f.qZA(),f.YNc(16,K,4,1,"tbody",43),f._UZ(17,"tbody"),f.qZA(),f.qZA()),2&t){const t=f.oxw();f.xp6(1),f.Q6J("dtOptions",t.dtOptions),f.xp6(4),f.Oqu(t.language.Recipient),f.xp6(2),f.Oqu(t.language.Type),f.xp6(2),f.Oqu(t.language.notification),f.xp6(2),f.Oqu(t.language["Opt-In Status"]),f.xp6(2),f.Oqu(t.language.lastUpdated),f.xp6(2),f.Q6J("ngForOf",t.list),f.xp6(1),f.Q6J("ngIf",0==(null==t.list?null:t.list.length)||0===t.count||0===t.filterCount)}}const tt=[{path:"",component:J},{path:"recipients",component:(()=>{class t{constructor(t,e,i,n){this.translateService=t,this.http=e,this.commonOrgService=i,this.titleService=n,this.searchRec=new o.NI(""),this.optInStatus=new o.NI("All"),this.dtOptions={},this.dtTrigger=new d.xQ,this.loading=!1,this.showTable=!1,this.hasScopeAccess=!0,this.list=[],this.errorInfo="",this.successInfo="",this.optInStatusList=[{id:"All",name:"All recipients"},{id:"Cancelled",name:"Cancelled"},{id:"Confirmed",name:"Confirmed"},{id:"Expired",name:"Expired"},{id:"Pending",name:"Pending"}],this.colorBtnMap={Cancelled:"complete-but",Confirmed:"running-but",Expired:"expired-but",Pending:"paused-but"},this.count=0}ngOnInit(){this.language=this.translateService.defualtLanguage,this.tableLanguageOptions(),this.languageSubject=this.translateService.selectedLanguage.subscribe(t=>{this.language=t,this.titleService.setTitle(`${this.language.Recipients} - ${this.language["Alarm & Health Notifications"]} - ${this.language.Alarms} - ${this.language.Operations} - ${this.language.Operations} - ${this.language["Calix Cloud"]}`),this.tableLanguageOptions(),this.showTable=!1,setTimeout(()=>{this.showTable=!0,this.subscribeCount("")},100)}),this.titleService.setTitle(`${this.language.Recipients} - ${this.language["Alarm & Health Notifications"]} - ${this.language.Alarms} - ${this.language.Operations} - ${this.language.Operations} - ${this.language["Calix Cloud"]}`),this.listenSearch(),this.subscribeCount("")}listenSearch(){this.searchSub=(0,H.R)(document.getElementById("search-rec"),"keyup").pipe((0,F.b)(200),(0,D.x)(),(0,Q.w)(t=>(console.log(t),this.list=[],this.getCount(t.target.value)))).subscribe(t=>{(null==t?void 0:t["api-error"])||(this.filterCount=t||0,this.redraw())})}getCount(t){this.loading=!0;let e=`${p.N.API_BASE_URL}analytics-engine/subscriptionsCount?optInStatus=${this.optInStatus.value}`;return t?e+=`&recipientFilter=${encodeURIComponent(t)}`:this.searchRec.value&&(e+=`&recipientFilter=${encodeURIComponent(this.searchRec.value)}`),this.http.get(e).pipe((0,h.K)(t=>(t["api-error"]=!0,this.showErrorMessage(this.commonOrgService.pageErrorHandle(t)),(0,u.of)(t))))}subscribeCount(t,e){e&&(this.searchRec.setValue(""),this.optInStatus.setValue("All")),this.getCount(t).subscribe(e=>{(null==e?void 0:e["api-error"])||(this.initLoad||(this.count=e||0),this.filterCount=e||0,this.initLoad?this.redraw():this.getData(t))})}getData(t){this.showTable=!0,this.dtOptions={pagingType:"full_numbers",pageLength:10,serverSide:!0,processing:!1,lengthChange:!1,dom:"tipr",columnDefs:[{orderable:!0,className:"reorder",targets:0},{orderable:!1,targets:"_all"}],ajax:(t,e)=>{var i,n,o,a,s;console.log(t);let l=`${p.N.API_BASE_URL}analytics-engine/subscriptionsStatus?offset=${t.start}&pageSize=${t.length}&optInStatus=${this.optInStatus.value}&sortingOrder=${null===(o=null===(n=null===(i=null==t?void 0:t.order)||void 0===i?void 0:i[0])||void 0===n?void 0:n.dir)||void 0===o?void 0:o.toUpperCase()}`;(null===(a=t.search)||void 0===a?void 0:a.value)&&(l+=`&recipientFilter=${encodeURIComponent(null===(s=t.search)||void 0===s?void 0:s.value)}`),this.http.get(l).subscribe(t=>{this.list=t||[],this.loading=!1,e({recordsTotal:this.count?this.count:0,recordsFiltered:null!=this.filterCount?this.filterCount:this.count,data:[]})},t=>{this.loading=!1,this.showErrorMessage(this.commonOrgService.pageErrorHandle(t)),e({recordsTotal:this.count?this.count:0,recordsFiltered:null!=this.filterCount?this.filterCount:this.count,data:[]})},()=>{this.initLoad=!0,this.loading=!1})},drawCallback:t=>{this.tableLanguageOptions()}},this.tableLanguageOptions()}ngOnDestroy(){var t;null===(t=this.searchSub)||void 0===t||t.unsubscribe()}tableLanguageOptions(){"de_DE"==this.language.fileLanguage?this.dtOptions.language=this.translateService.de_DE:"fr"==this.language.fileLanguage?this.dtOptions.language=this.translateService.fr:"es"==this.language.fileLanguage?this.dtOptions.language=this.translateService.es:"en"==this.language.fileLanguage&&this.dtOptions.language&&delete this.dtOptions.language}closeAlert(){this.error=!1,this.success=!1}showErrorMessage(t){this.closeAlert(),this.errorInfo=t,this.error=!0,this.loading=!1}clearSearchInp(){this.searchRec.setValue(""),this.subscribeCount("")}redraw(){var t,e;null===(e=null===(t=this.dtElement)||void 0===t?void 0:t.dtInstance)||void 0===e||e.then(t=>{t.search(this.searchRec.value).draw()})}convertToDateTime(t){return t?(t=Number(t),new n.uU("en-US").transform(new Date(t),"short")):void 0}doRefresh(){this.loading=!0,this.http.post(`${p.N.API_BASE_URL}analytics-engine/synchronizeSubscriptionsStatus`,{},{responseType:"text"}).pipe((0,h.K)(t=>(t["api-error"]=!0,this.loading=!1,this.showErrorMessage(this.commonOrgService.pageErrorHandle(t)),(0,u.of)(t)))).subscribe(t=>{this.subscribeCount("",!0)})}}return t.\u0275fac=function(e){return new(e||t)(f.Y36(_.s),f.Y36(m.eN),f.Y36(A.v),f.Y36(O.Dx))},t.\u0275cmp=f.Xpm({type:t,selectors:[["app-recipients"]],viewQuery:function(t,e){if(1&t&&f.Gf(c.G,5),2&t){let t;f.iGM(t=f.CRH())&&(e.dtElement=t.first)}},decls:33,vars:14,consts:[[1,"ccl-tabs","my-3"],["id","tabs",1,"nav","nav-tabs"],[1,"nav-item"],["routerLink","/cco/operations/alarms/health-alarm-notifications",1,"nav-link","small"],[1,"nav-link","small","active",3,"click"],[1,"row"],["class","loader",4,"ngIf"],["class","w-100 alert alert-danger  fade show",4,"ngIf"],[1,"col-md-6"],[1,"pull-left","sub-imp-title","d-flex","justify-content-between"],[1,"primary","text-decoration-none","mb-3","cursor-pointer",3,"click"],[1,"icon-btn"],["src","../../../../../assets/img/ic_refresh.svg","alt",""],[1,"pull-right","sub-imp-title","d-flex","justify-content-between"],[1,""],["role","alert","class","alert alert-warning",4,"ngIf"],[1,"col-md-12"],[1,"row","w-100","justify-content-between"],[1,"col-md-4","ccl-form","position-relative"],["id","search-rec","placeholder","Search Recipients",1,"ccl-input",3,"formControl"],["class","close-clear",3,"click",4,"ngIf"],[1,"col-md-3","ccl-form","mb-2","d-flex","align-items-center"],[1,"mr-2","mb-0"],["bindValue","id","bindLabel","name",1,"w-100",3,"clearable","items","formControl","searchable","change"],["class","sub-imp-table table-responsive",4,"ngIf"],[1,"loader"],[1,"d-flex","justify-content-center"],[1,"spinner-border","text-primary"],[1,"sr-only"],[1,"w-100","alert","alert-danger","fade","show"],[1,"error-img"],["src","./assets/img/ic_error-36px.svg"],["type","button",1,"close",3,"click"],[1,"d-inline-flex",3,"innerHtml"],["role","alert",1,"alert","alert-warning"],[1,"close-clear",3,"click"],[1,"close"],[1,"sub-imp-table","table-responsive"],["datatable","",1,"table","table-borderless","w-100",3,"dtOptions"],[1,"recipient"],[1,"notification"],["id","Opt-In-Status"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"dot","mr-2"],["colspan","5",1,"no-data-available"]],template:function(t,e){1&t&&(f.TgZ(0,"div",0),f.TgZ(1,"ul",1),f.TgZ(2,"li",2),f.TgZ(3,"a",3),f._uU(4),f.qZA(),f.qZA(),f.TgZ(5,"li",2),f.TgZ(6,"a",4),f.NdJ("click",function(){return e.subscribeCount("",!0)}),f._uU(7),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.TgZ(8,"div",5),f.YNc(9,j,5,1,"div",6),f.YNc(10,B,6,1,"div",7),f.TgZ(11,"div",8),f.TgZ(12,"div",9),f.TgZ(13,"a",10),f.NdJ("click",function(){return e.doRefresh()}),f.TgZ(14,"span",11),f._UZ(15,"img",12),f.qZA(),f._uU(16),f.qZA(),f.qZA(),f.qZA(),f.TgZ(17,"div",8),f.TgZ(18,"div",13),f.TgZ(19,"div",14),f._uU(20),f.qZA(),f.qZA(),f.qZA(),f.YNc(21,z,2,1,"div",15),f.qZA(),f.TgZ(22,"div",5),f.TgZ(23,"div",16),f.TgZ(24,"div",17),f.TgZ(25,"div",18),f._UZ(26,"input",19),f.YNc(27,G,3,0,"div",20),f.qZA(),f.TgZ(28,"div",21),f.TgZ(29,"label",22),f._uU(30,"Filter: "),f.qZA(),f.TgZ(31,"ng-select",23),f.NdJ("change",function(){return e.subscribeCount("")}),f.qZA(),f.qZA(),f.qZA(),f.YNc(32,X,18,8,"div",24),f.qZA(),f.qZA()),2&t&&(f.xp6(4),f.Oqu(e.language.Notifications),f.xp6(3),f.Oqu(e.language.Recipients),f.xp6(2),f.Q6J("ngIf",e.loading),f.xp6(1),f.Q6J("ngIf",e.error),f.xp6(6),f.hij(" ",e.language.Refresh,""),f.xp6(4),f.Oqu(e.language["Opt-in status is updated once a day."]),f.xp6(1),f.Q6J("ngIf",!e.hasScopeAccess),f.xp6(5),f.Q6J("formControl",e.searchRec),f.xp6(1),f.Q6J("ngIf",null==e.searchRec?null:e.searchRec.value),f.xp6(4),f.Q6J("clearable",!1)("items",e.optInStatusList)("formControl",e.optInStatus)("searchable",!1),f.xp6(1),f.Q6J("ngIf",e.showTable))},directives:[a.yS,n.O5,o.Fj,o.JJ,o.oH,w.w9,c.G,n.sg],styles:[".blue[_ngcontent-%COMP%]{color:#00f!important}.search-close[_ngcontent-%COMP%]{position:absolute;right:27px;top:10px;color:#cdcdcd;cursor:pointer}.expired-but[_ngcontent-%COMP%]{font-size:12px;font-weight:600;text-align:Center;padding:5px 12px 5px 8px;border-radius:20px;line-height:15.08px;margin:2px 0;border:1px solid #CCCCCC!important;background-color:transparent}  table.dataTable td.dataTables_empty{display:none}.icon-btn[_ngcontent-%COMP%]{width:20px;height:20px}.close-clear[_ngcontent-%COMP%]{position:absolute;top:13px;right:25px;cursor:pointer}.close-clear[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:11.7px;height:11.7px;background-size:11.7px}.sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(1), .sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){width:40%!important;word-break:break-all}.sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(2), .sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){width:14%!important}.sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3), .sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){width:22%!important;word-wrap:break-word}.sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(4), .sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){width:16%!important}.sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(5), .sub-imp-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(5){width:23%!important;white-space:nowrap}"]}),t})()},{path:"alarm-notifications/view/:notificationId",component:s.l},{path:"outage-workflow/view/:notificationId",component:l.O},{path:"workflow/view/:notificationId",component:r.C}];let et=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=f.oAB({type:t}),t.\u0275inj=f.cJS({imports:[[a.Bz.forChild(tt)],a.Bz]}),t})(),it=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=f.oAB({type:t}),t.\u0275inj=f.cJS({imports:[[n.ez,et,o.u5,o.UX,c.T,w.A0]]}),t})()}}]);