{"ast":null,"code":"var MARKER_OK = 'connect-ok',\n  MARKER_NOT_OK = 'connect-not-ok';\n\n/**\n * @class\n * @constructor\n *\n * @param {EventBus} eventBus\n * @param {Dragging} dragging\n * @param {Connect} connect\n * @param {Canvas} canvas\n * @param {ToolManager} toolManager\n * @param {Rules} rules\n * @param {Mouse} mouse\n */\nexport default function GlobalConnect(eventBus, dragging, connect, canvas, toolManager, rules, mouse) {\n  var self = this;\n  this._dragging = dragging;\n  this._rules = rules;\n  this._mouse = mouse;\n  toolManager.registerTool('global-connect', {\n    tool: 'global-connect',\n    dragging: 'global-connect.drag'\n  });\n  eventBus.on('global-connect.hover', function (event) {\n    var context = event.context,\n      startTarget = event.hover;\n    var canStartConnect = context.canStartConnect = self.canStartConnect(startTarget);\n\n    // simply ignore hover\n    if (canStartConnect === null) {\n      return;\n    }\n    context.startTarget = startTarget;\n    canvas.addMarker(startTarget, canStartConnect ? MARKER_OK : MARKER_NOT_OK);\n  });\n  eventBus.on(['global-connect.out', 'global-connect.cleanup'], function (event) {\n    var startTarget = event.context.startTarget,\n      canStartConnect = event.context.canStartConnect;\n    if (startTarget) {\n      canvas.removeMarker(startTarget, canStartConnect ? MARKER_OK : MARKER_NOT_OK);\n    }\n  });\n  eventBus.on(['global-connect.ended'], function (event) {\n    var context = event.context,\n      startTarget = context.startTarget,\n      startPosition = {\n        x: event.x,\n        y: event.y\n      };\n    var canStartConnect = self.canStartConnect(startTarget);\n    if (!canStartConnect) {\n      return;\n    }\n    eventBus.once('element.out', function () {\n      eventBus.once(['connect.ended', 'connect.canceled'], function () {\n        eventBus.fire('global-connect.drag.ended');\n      });\n      connect.start(null, startTarget, startPosition);\n    });\n    return false;\n  });\n}\nGlobalConnect.$inject = ['eventBus', 'dragging', 'connect', 'canvas', 'toolManager', 'rules', 'mouse'];\n\n/**\n * Initiates tool activity.\n */\nGlobalConnect.prototype.start = function (event, autoActivate) {\n  this._dragging.init(event, 'global-connect', {\n    autoActivate: autoActivate,\n    trapClick: false,\n    data: {\n      context: {}\n    }\n  });\n};\nGlobalConnect.prototype.toggle = function () {\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n  var mouseEvent = this._mouse.getLastMoveEvent();\n  return this.start(mouseEvent, !!mouseEvent);\n};\nGlobalConnect.prototype.isActive = function () {\n  var context = this._dragging.context();\n  return context && /^global-connect/.test(context.prefix);\n};\n\n/**\n * Check if source shape can initiate connection.\n *\n * @param  {Shape} startTarget\n * @return {boolean}\n */\nGlobalConnect.prototype.canStartConnect = function (startTarget) {\n  return this._rules.allowed('connection.start', {\n    source: startTarget\n  });\n};","map":null,"metadata":{},"sourceType":"module"}