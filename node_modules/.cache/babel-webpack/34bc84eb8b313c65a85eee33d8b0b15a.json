{"ast":null,"code":"import { FormControl, FormGroup } from '@angular/forms';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app-services/translate.service\";\nimport * as i2 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i3 from \"src/app/shared/services/sso-auth.service\";\nimport * as i4 from \"../../netops-management.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/platform-browser\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"@angular/forms\";\nfunction EdgeSuiteComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelementStart(1, \"div\", 11);\n    i0.ɵɵelementStart(2, \"div\", 12);\n    i0.ɵɵelementStart(3, \"div\", 13);\n    i0.ɵɵelementStart(4, \"span\", 14);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.language.Loading);\n  }\n}\nfunction EdgeSuiteComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelementStart(1, \"span\", 16);\n    i0.ɵɵelement(2, \"img\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function EdgeSuiteComponent_div_2_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.closeAlert();\n    });\n    i0.ɵɵelement(4, \"span\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"innerHtml\", ctx_r1.errorInfo, i0.ɵɵsanitizeHtml);\n  }\n}\nfunction EdgeSuiteComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵelementStart(1, \"span\", 21);\n    i0.ɵɵelement(2, \"img\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function EdgeSuiteComponent_div_3_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.closeAlert();\n    });\n    i0.ɵɵelement(4, \"span\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"innerHtml\", ctx_r2.successInfo, i0.ɵɵsanitizeHtml);\n  }\n}\nfunction EdgeSuiteComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵelementStart(1, \"label\", 24);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 25);\n    i0.ɵɵelementStart(4, \"div\", 26);\n    i0.ɵɵelementStart(5, \"label\", 27);\n    i0.ɵɵelementStart(6, \"input\", 28);\n    i0.ɵɵlistener(\"change\", function EdgeSuiteComponent_div_9_Template_input_change_6_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.changeForm();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"span\");\n    i0.ɵɵelement(8, \"small\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", \"ProtectIQ\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", !ctx_r3.allowSubnetConfig || !ctx_r3.hasWriteAccess ? \"switch-disabled\" : \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵattribute(\"disabled\", !ctx_r3.hasWriteAccess || !ctx_r3.allowSubnetConfig ? true : null);\n  }\n}\nfunction EdgeSuiteComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵelementStart(1, \"label\", 24);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 25);\n    i0.ɵɵelementStart(4, \"div\", 26);\n    i0.ɵɵelementStart(5, \"label\", 29);\n    i0.ɵɵelementStart(6, \"input\", 30);\n    i0.ɵɵlistener(\"change\", function EdgeSuiteComponent_div_10_Template_input_change_6_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.changeForm();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"span\");\n    i0.ɵɵelement(8, \"small\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", \"ExperienceIQ\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", !ctx_r4.allowSubnetConfig || !ctx_r4.hasWriteAccess ? \"switch-disabled\" : \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵattribute(\"disabled\", !ctx_r4.hasWriteAccess || !ctx_r4.allowSubnetConfig ? true : null);\n  }\n}\nfunction EdgeSuiteComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵelementStart(1, \"div\", 31);\n    i0.ɵɵelementStart(2, \"button\", 32);\n    i0.ɵɵlistener(\"click\", function EdgeSuiteComponent_div_11_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.reset();\n    });\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function EdgeSuiteComponent_div_11_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return ctx_r16.save();\n    });\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r5.language.reset);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r5.language.submit);\n  }\n}\nexport let EdgeSuiteComponent = /*#__PURE__*/(() => {\n  class EdgeSuiteComponent {\n    constructor(translateService, dialogService, sso, service, router, titleService) {\n      var _a, _b;\n      this.translateService = translateService;\n      this.dialogService = dialogService;\n      this.sso = sso;\n      this.service = service;\n      this.router = router;\n      this.titleService = titleService;\n      this.showSaveButtons = false;\n      this.settings = {\n        subscribedToProtectIq: false,\n        subscribedToExperienceIq: false\n      };\n      this.hasWriteAccess = false;\n      this.allowSubnetConfig = true;\n      this.ORG_ID = this.sso.getOrgId();\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n      });\n      let scopes = this.sso.getScopes();\n      if (environment.VALIDATE_SCOPE && environment.VALIDATE_FOUNDATION_SCOPE) {\n        scopes['cloud.rbac.csc.netops.config.edgesuitesbulkprovisioning'] = scopes['cloud.rbac.csc.netops.config.edgesuitesbulkprovisioning'] ? scopes['cloud.rbac.csc.netops.config.edgesuitesbulkprovisioning'] : [];\n        //Secure Onboarding、 Stale Device Purge、Subscriber Profile and Subnet Configuration - admin scope check\n        if (scopes && ((_a = scopes['cloud.rbac.csc.netops.config.edgesuitesbulkprovisioning']) === null || _a === void 0 ? void 0 : _a.includes('write'))) {\n          this.hasWriteAccess = true;\n        }\n        if (scopes && ((_b = scopes['cloud.rbac.coc.operations.subscriber.configurations']) === null || _b === void 0 ? void 0 : _b.includes('write'))) {\n          this.hasWriteAccess = true;\n        }\n      } else {\n        this.hasWriteAccess = true;\n      }\n      let enttlmnts = this.sso.getEntitlements();\n      if (this.router.url.includes('cco/operations') && enttlmnts[210] && !enttlmnts[102]) {\n        this.allowSubnetConfig = false;\n      }\n    }\n    ngOnInit() {\n      this.settingsForm = new FormGroup({\n        subscribedToProtectIq: new FormControl(false),\n        subscribedToExperienceIq: new FormControl(false)\n      });\n      if (this.router.url.includes('cco/operations/cco-subscriber-operations')) {\n        this.titleService.setTitle('Edge Suites Bulk Provisioning - Configurations - Subscriber Operations - Operations - Operations - Calix Cloud');\n      } else if (this.router.url.includes('/support/netops-management')) {\n        this.titleService.setTitle('Edge Suites Bulk Provisioning - Configurations - Netops - Support - Calix Cloud');\n      }\n      this.closeAlert();\n      this.getSettings();\n    }\n    ngOnDestroy() {\n      if (this.languageSubject) this.languageSubject.unsubscribe();\n      if (this.getListSubs) this.getListSubs.unsubscribe();\n      if (this.updateListSubs) this.updateListSubs.unsubscribe();\n    }\n    getSettings() {\n      this.loading = true;\n      this.showSaveButtons = false;\n      this.getListSubs = this.service.getIqSuites(this.ORG_ID).subscribe(resp => {\n        if (resp && Object.keys(resp).length !== 0) {\n          this.settings = resp;\n          this.loading = false;\n        } else {\n          this.settings = {\n            subscribedToProtectIq: false,\n            subscribedToExperienceIq: false\n          };\n        }\n        this.settingsForm.patchValue(this.settings);\n      }, err => {\n        this.pageErrorHandle(err);\n        this.settings = {\n          subscribedToProtectIq: false,\n          subscribedToExperienceIq: false\n        };\n        this.settingsForm.patchValue(this.settings);\n        this.loading = false;\n      });\n    }\n    changeForm() {\n      let form = JSON.stringify(this.settingsForm.value);\n      let list = JSON.stringify(this.settings);\n      if (form !== list) {\n        this.showSaveButtons = true;\n      } else {\n        this.showSaveButtons = false;\n      }\n    }\n    reset() {\n      this.getSettings();\n    }\n    save() {\n      this.loading = true;\n      let form = this.settingsForm.value;\n      this.updateListSubs = this.service.updateIQSuitesConfigs(this.ORG_ID, form).subscribe(resp => {\n        this.getSettings();\n      }, err => {\n        this.pageErrorHandle(err);\n        this.loading = false;\n      });\n    }\n    pageErrorHandle(err) {\n      if (err.status == 401) {\n        this.errorInfo = this.language['Access Denied'];\n      } else {\n        this.errorInfo = this.sso.pageErrorHandle(err);\n      }\n      setTimeout(() => {\n        this.error = true;\n        this.loading = false;\n      }, 500);\n    }\n    closeAlert() {\n      this.error = false;\n      this.success = false;\n    }\n  }\n  EdgeSuiteComponent.ɵfac = function EdgeSuiteComponent_Factory(t) {\n    return new (t || EdgeSuiteComponent)(i0.ɵɵdirectiveInject(i1.TranslateService), i0.ɵɵdirectiveInject(i2.NgbModal), i0.ɵɵdirectiveInject(i3.SsoAuthService), i0.ɵɵdirectiveInject(i4.NetopsServiceService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i6.Title));\n  };\n  EdgeSuiteComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EdgeSuiteComponent,\n    selectors: [[\"app-edge-suite\"]],\n    decls: 12,\n    vars: 7,\n    consts: [[1, \"loader-wrapper\", \"position-relative\"], [\"class\", \"loader-wrapper-info\", 4, \"ngIf\"], [\"class\", \"w-100 alert alert-danger fade show\", 4, \"ngIf\"], [\"class\", \"w-100 alert alert-success fade show\", 4, \"ngIf\"], [1, \"container\", \"sys-contain\"], [1, \"ccl-form\", \"needs-validation\", 3, \"formGroup\"], [1, \"row\"], [1, \"col-md-10\", \"col-md-4\", \"col-sm-12\", \"pr-5\", \"pl-0\"], [1, \"ccl-form\", \"mt-3\", \"needs-validation\", \"mt-3\"], [\"class\", \"form-group inline-input row\", 4, \"ngIf\"], [1, \"loader-wrapper-info\"], [1, \"loader\"], [1, \"d-flex\", \"justify-content-center\"], [1, \"spinner-border\", \"text-primary\"], [1, \"sr-only\"], [1, \"w-100\", \"alert\", \"alert-danger\", \"fade\", \"show\"], [1, \"error-img\"], [\"src\", \"./assets/img/ic_error-36px.svg\"], [\"type\", \"button\", 1, \"close\", 3, \"click\"], [1, \"d-inline-flex\", 3, \"innerHtml\"], [1, \"w-100\", \"alert\", \"alert-success\", \"fade\", \"show\"], [1, \"success-img\"], [\"src\", \"./assets/img/success-icon.svg\"], [1, \"form-group\", \"inline-input\", \"row\"], [1, \"col-md-3\", \"col-form-label\"], [1, \"col-md-6\"], [1, \"toggle-swtbtn\", \"checkbox\", \"switcher\", 3, \"ngClass\"], [\"for\", \"subscribedToProtectIq\"], [\"type\", \"checkbox\", \"id\", \"subscribedToProtectIq\", \"formControlName\", \"subscribedToProtectIq\", 3, \"change\"], [\"for\", \"subscribedToExperienceIq\"], [\"type\", \"checkbox\", \"id\", \"subscribedToExperienceIq\", \"formControlName\", \"subscribedToExperienceIq\", 3, \"change\"], [1, \"col-md-10\", \"offset-md-2\", \"text-right\"], [1, \"btn-default\", \"primary\", \"md-btn\", \"mr-2\", 3, \"click\"], [1, \"btn-default\", \"primary\", \"md-btn\", \"px-0\", 3, \"click\"]],\n    template: function EdgeSuiteComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, EdgeSuiteComponent_div_1_Template, 6, 1, \"div\", 1);\n        i0.ɵɵtemplate(2, EdgeSuiteComponent_div_2_Template, 6, 1, \"div\", 2);\n        i0.ɵɵtemplate(3, EdgeSuiteComponent_div_3_Template, 6, 1, \"div\", 3);\n        i0.ɵɵelementStart(4, \"div\", 4);\n        i0.ɵɵelementStart(5, \"form\", 5);\n        i0.ɵɵelementStart(6, \"div\", 6);\n        i0.ɵɵelementStart(7, \"div\", 7);\n        i0.ɵɵelementStart(8, \"div\", 8);\n        i0.ɵɵtemplate(9, EdgeSuiteComponent_div_9_Template, 9, 3, \"div\", 9);\n        i0.ɵɵtemplate(10, EdgeSuiteComponent_div_10_Template, 9, 3, \"div\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(11, EdgeSuiteComponent_div_11_Template, 6, 2, \"div\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.error);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.success);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"formGroup\", ctx.settingsForm);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.sso.getEntitlementsArr().indexOf(\"203\") > -1 || ctx.sso.getEntitlementsArr().indexOf(\"205\") > -1);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.sso.getEntitlementsArr().indexOf(\"204\") > -1 || ctx.sso.getEntitlementsArr().indexOf(\"205\") > -1);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showSaveButtons && ctx.hasWriteAccess);\n      }\n    },\n    directives: [i7.NgIf, i8.ɵNgNoValidate, i8.NgControlStatusGroup, i8.FormGroupDirective, i7.NgClass, i8.CheckboxControlValueAccessor, i8.NgControlStatus, i8.FormControlName],\n    styles: [\".opacity-50[_ngcontent-%COMP%]{opacity:.5}.switch-disabled[_ngcontent-%COMP%]{opacity:.5}.switch-disabled[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:not-allowed}\"]\n  });\n  return EdgeSuiteComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}