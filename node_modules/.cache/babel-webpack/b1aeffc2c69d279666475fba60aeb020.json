{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport { DataTableDirective } from 'angular-datatables';\nimport { Subject } from 'rxjs';\nimport jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\nimport { DatePipe } from '@angular/common';\nimport { maskString } from 'src/app/cco/shared/functions/cco-mask';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/shared/services/custom-translate.service\";\nimport * as i2 from \"src/app/sys-admin/services/common.service\";\nimport * as i3 from \"src/app/shared/services/sso-auth.service\";\nimport * as i4 from \"@angular/common/http\";\nimport * as i5 from \"../../reports/location-report-api.service\";\nimport * as i6 from \"src/app/shared/services/export-excel.service\";\nimport * as i7 from \"../../../shared/chart-options.service\";\nimport * as i8 from \"@angular/router\";\nimport * as i9 from \"@angular/common\";\nimport * as i10 from \"angular-datatables\";\nimport * as i11 from \"@ng-bootstrap/ng-bootstrap\";\nfunction ActiveSubscribersComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.language[\"Access denied due to RBAC. Please consult your Organization Administrator for access.\"], \"\\n\");\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelementStart(1, \"span\", 17);\n    i0.ɵɵelement(2, \"img\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function ActiveSubscribersComponent_div_1_div_1_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.closeAlert();\n    });\n    i0.ɵɵelement(4, \"span\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"div\", 20);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"innerHtml\", ctx_r2.errorInfo, i0.ɵɵsanitizeHtml);\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵelementStart(1, \"button\", 22);\n    i0.ɵɵelementStart(2, \"p\", 23);\n    i0.ɵɵelement(3, \"i\", 24);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 25);\n    i0.ɵɵelementStart(6, \"button\", 26);\n    i0.ɵɵelementStart(7, \"span\", 27);\n    i0.ɵɵlistener(\"click\", function ActiveSubscribersComponent_div_1_div_3_Template_span_click_7_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return ctx_r10.downloadPdf();\n    });\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 26);\n    i0.ɵɵelementStart(10, \"span\", 27);\n    i0.ɵɵlistener(\"click\", function ActiveSubscribersComponent_div_1_div_3_Template_span_click_10_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return ctx_r12.downloadCSV();\n    });\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r3.language.export, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r3.language.exportPdf);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r3.language.exportCsv);\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_4_p_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 31);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r13 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", ctx_r13.language.location, \" \", ctx_r13.language.Active_subscriber, \" \");\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_4_p_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 31);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r14 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", ctx_r14.language.network, \" \", ctx_r14.language.Active_subscriber, \" \");\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_4_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"slice\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r15 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\"\", ctx_r15.language.location, \" : \", ctx_r15.filters.locationsSelectedNames ? i0.ɵɵpipeBind3(2, 3, ctx_r15.filters.locationsSelectedNames, 0, 3) : \"\", \" \", ctx_r15.filters.locationsSelectedNames ? ctx_r15.filters.locationsSelectedNames[3] ? \"...\" : \"\" : \"\", \" \\u00A0\\u00A0\");\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtemplate(1, ActiveSubscribersComponent_div_1_div_4_p_1_Template, 2, 2, \"p\", 29);\n    i0.ɵɵtemplate(2, ActiveSubscribersComponent_div_1_div_4_p_2_Template, 2, 2, \"p\", 29);\n    i0.ɵɵelementStart(3, \"p\", 30);\n    i0.ɵɵtemplate(4, ActiveSubscribersComponent_div_1_div_4_span_4_Template, 3, 7, \"span\", 15);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"slice\");\n    i0.ɵɵpipe(7, \"date\");\n    i0.ɵɵpipe(8, \"date\");\n    i0.ɵɵelement(9, \"br\");\n    i0.ɵɵtext(10, \" \\u00A0\\u00A0 \");\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.filters.type === \"location\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.filters.type === \"network\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.filters.type === \"location\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolateV([\" \", ctx_r4.filters.applicationsSelectedNames ? ctx_r4.language.Application + \":\" : \"\", \" \", ctx_r4.filters.applicationsSelectedNames ? i0.ɵɵpipeBind3(6, 16, ctx_r4.filters.applicationsSelectedNames, 0, 3) : \"\", \" \", ctx_r4.filters.applicationsSelectedNames ? ctx_r4.filters.applicationsSelectedNames[3] ? \"...\" : \"\" : \"\", \"\\u00A0\\u00A0 \", ctx_r4.language.timeWindow, \": \", i0.ɵɵpipeBind2(7, 20, ctx_r4.filters.startDate, \"MM/dd/yyyy\"), \" \", ctx_r4.language.to, \" \", i0.ɵɵpipeBind2(8, 23, ctx_r4.filters.endDate, \"MM/dd/yyyy\"), \" [Coordinated Universal Time] \\u00A0\\u00A0 \", ctx_r4.language.treshold, \" (Bytes): \", ctx_r4.filters.threshold, \" \"]);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate4(\" \", ctx_r4.language.elim, \" : \", ctx_r4.filters.eliminateUnknownSelected === \"yes\" ? ctx_r4.language.Yes : ctx_r4.language.No, \" \\u00A0\\u00A0 \", ctx_r4.language.thres, \" : \", ctx_r4.filters.thresholdTypeSelected === \"AllEndpoints\" ? ctx_r4.language[\"All Endpoints\"] : ctx_r4.language[\"Unresolvable Endpoints\"], \"\\u00A0\\u00A0 \");\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵelementStart(1, \"div\", 33);\n    i0.ɵɵelementStart(2, \"div\", 34);\n    i0.ɵɵelementStart(3, \"span\", 35);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r5.language.Loading);\n  }\n}\nfunction ActiveSubscribersComponent_div_1_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 36);\n    i0.ɵɵelementStart(1, \"div\", 37);\n    i0.ɵɵelementStart(2, \"div\", 38);\n    i0.ɵɵelementStart(3, \"div\", 39);\n    i0.ɵɵelement(4, \"div\", 40);\n    i0.ɵɵelementStart(5, \"div\", 41);\n    i0.ɵɵelementStart(6, \"div\", 42);\n    i0.ɵɵelementStart(7, \"input\", 43);\n    i0.ɵɵlistener(\"keyup\", function ActiveSubscribersComponent_div_1_div_7_Template_input_keyup_7_listener($event) {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext(2);\n      return ctx_r16.search($event.target.value);\n    })(\"search\", function ActiveSubscribersComponent_div_1_div_7_Template_input_search_7_listener($event) {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return ctx_r18.search($event.target.value);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 44);\n    i0.ɵɵelement(9, \"i\", 45);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(7);\n    i0.ɵɵpropertyInterpolate(\"placeholder\", ctx_r6.language.searchAdmins);\n  }\n}\nfunction ActiveSubscribersComponent_div_1_tbody_25_tr_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 47);\n    i0.ɵɵelementStart(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵelementStart(4, \"div\", 48);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\", 49);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\", 49);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\", 49);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\", 49);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r20 = ctx.$implicit;\n    const ctx_r19 = i0.ɵɵnextContext(3);\n    i0.ɵɵpropertyInterpolate(\"id\", item_r20._id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r20.location ? item_r20.location : \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", item_r20.subscriber ? item_r20.subscriber : \"\", \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r20.usOctets ? ctx_r19.convertByteToGB(item_r20.usOctets) : 0);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r20.dsOctets ? ctx_r19.convertByteToGB(item_r20.dsOctets) : 0);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", item_r20.totalOctets ? ctx_r19.convertByteToGB(item_r20.totalOctets) : 0, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r20.hitCount ? item_r20.hitCount : 0);\n  }\n}\nfunction ActiveSubscribersComponent_div_1_tbody_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tbody\");\n    i0.ɵɵtemplate(1, ActiveSubscribersComponent_div_1_tbody_25_tr_1_Template, 14, 7, \"tr\", 46);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r7.tableData);\n  }\n}\nfunction ActiveSubscribersComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵtemplate(1, ActiveSubscribersComponent_div_1_div_1_Template, 6, 1, \"div\", 4);\n    i0.ɵɵelementStart(2, \"div\", 5);\n    i0.ɵɵtemplate(3, ActiveSubscribersComponent_div_1_div_3_Template, 12, 3, \"div\", 6);\n    i0.ɵɵtemplate(4, ActiveSubscribersComponent_div_1_div_4_Template, 12, 26, \"div\", 7);\n    i0.ɵɵelementStart(5, \"div\", 8);\n    i0.ɵɵtemplate(6, ActiveSubscribersComponent_div_1_div_6_Template, 5, 1, \"div\", 9);\n    i0.ɵɵtemplate(7, ActiveSubscribersComponent_div_1_div_7_Template, 10, 1, \"div\", 10);\n    i0.ɵɵelementStart(8, \"div\", 11);\n    i0.ɵɵelementStart(9, \"div\", 12);\n    i0.ɵɵelementStart(10, \"table\", 13);\n    i0.ɵɵelementStart(11, \"thead\");\n    i0.ɵɵelementStart(12, \"tr\");\n    i0.ɵɵelementStart(13, \"th\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"th\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"th\", 14);\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"th\", 14);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"th\", 14);\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"th\", 14);\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(25, ActiveSubscribersComponent_div_1_tbody_25_Template, 2, 1, \"tbody\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.error);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.dataAvailable);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.runClicked);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.loading);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.dataAvailable && 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"hidden\", ctx_r1.loading || !ctx_r1.dataAvailable || !ctx_r1.pageAvailable);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"dtOptions\", ctx_r1.dtOptions)(\"dtTrigger\", ctx_r1.dtTrigger);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r1.language.location);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.language.subscriber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.language.upUsage);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.language.downUsage);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.language.totalUsage);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.language.hitCount);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r1.tableData == null ? null : ctx_r1.tableData.length) != 0);\n  }\n}\nexport let ActiveSubscribersComponent = /*#__PURE__*/(() => {\n  class ActiveSubscribersComponent {\n    constructor(customTranslateService, commonOrgService, sso, http, locationservice, exportExcel, chartOptionService, router) {\n      this.customTranslateService = customTranslateService;\n      this.commonOrgService = commonOrgService;\n      this.sso = sso;\n      this.http = http;\n      this.locationservice = locationservice;\n      this.exportExcel = exportExcel;\n      this.chartOptionService = chartOptionService;\n      this.router = router;\n      this.pageAvailable = false;\n      this.loading = false;\n      this.errorInfo = '';\n      this.tableData = [];\n      this.filterCount = 0;\n      this.dtOptions = {};\n      this.dtTrigger = new Subject();\n      this.baseUrl = `${environment.CCO_REPORTS_BASE_URL}reports/activesubscribers?`;\n      this.url = \"\";\n      this.hasScopeAccess = false;\n      this.ORG_ID = this.sso.getOrgId();\n      this.language = this.customTranslateService.defualtLanguage;\n      this.frTable = this.customTranslateService.fr;\n      this.esTable = this.customTranslateService.es;\n      if (this.language) {\n        this.pageAvailable = true;\n      }\n      this.languageSubs = this.customTranslateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n        this.loading = true;\n        setTimeout(() => {\n          if (this.renderedOnce) this.renderTable(true);\n        }, 500);\n      });\n    }\n    ngOnInit() {\n      var _a, _b;\n      let scopes = this.sso.getScopes();\n      if (environment.VALIDATE_SCOPE && window.location.pathname.indexOf('/cco/traffic/') > -1) {\n        if (((_a = scopes['cloud.rbac.coc.traffic.network.report']) === null || _a === void 0 ? void 0 : _a.indexOf('read')) !== -1 || ((_b = scopes['cloud.rbac.coc.traffic.location.report']) === null || _b === void 0 ? void 0 : _b.indexOf('read')) !== -1) {\n          this.hasScopeAccess = true;\n        }\n      } else {\n        this.hasScopeAccess = true;\n      }\n      this.renderedOnce = false;\n      this.closeAlert();\n      this.dtOptions = {\n        pagingType: 'full_numbers',\n        pageLength: 20,\n        lengthChange: false,\n        processing: false,\n        dom: 'tipr',\n        order: [],\n        paging: true,\n        initComplete: () => {\n          setTimeout(() => {\n            this.loading = false;\n          }, 300);\n        }\n      };\n      this.tableLanguageOptions();\n      this.columnDefs = [{\n        headerName: this.language.location,\n        field: 'location'\n      }, {\n        headerName: this.language.subscriber,\n        field: 'subscriber'\n      }, {\n        headerName: this.language.upUsage,\n        field: 'usOctets'\n      }, {\n        headerName: this.language.downUsage,\n        field: 'dsOctets'\n      }, {\n        headerName: this.language.totalUsage,\n        field: 'totalOctets'\n      }, {\n        headerName: this.language.hitCount,\n        field: 'hitCount'\n      }\n      // { headerName: this.language.aggregateCount, field: 'aggCount' }\n      ];\n    }\n\n    ngOnDestroy() {\n      if (this.subscribe) {\n        this.subscribe.unsubscribe();\n      }\n      if (this.languageSubs) {\n        this.languageSubs.unsubscribe();\n      }\n      if (this.dtTrigger) {\n        this.dtTrigger.unsubscribe();\n        this.dtTrigger.complete();\n      }\n    }\n    loadChartData(data) {\n      let orgId = this.sso.getOrganizationID(this.router.url);\n      this.error = false;\n      this.loading = true;\n      this.chartOptionService.btnDisabled = true;\n      let loc = data.locationsSelected != undefined ? data.locationsSelected.length : 0;\n      let app = data.applicationsSelected != undefined ? data.applicationsSelected.length : 0;\n      let minUnresolvedOnly = data.thresholdTypeSelected == 'AllEndpoints' ? 'false' : 'true';\n      let eliminateUnknownSelected = data.eliminateUnknownSelected == 'Yes' || data.eliminateUnknownSelected == \"yes\" ? `&eliminateUnknown=subscriber` : \"\";\n      let location1 = \"\",\n        application1 = \"\";\n      if (loc > 0 && !data.locationsSelected.includes(\"All\")) {\n        data.locationsSelected.forEach(element => {\n          location1 = location1 + '&location=' + element;\n        });\n      }\n      if (app > 0 && !data.applicationsSelected.includes(\"All\")) {\n        data.applicationsSelected.forEach(element => {\n          application1 = application1 + '&application=' + element;\n        });\n      }\n      let startDate = new Date(data.startDate);\n      let endDate = new Date(data.endDate);\n      let granularity = '24hour';\n      startDate = this.locationservice.getISOStartOfDay(startDate);\n      endDate = this.locationservice.getISOEndOfDay(endDate);\n      this.url = `${this.baseUrl}org=${orgId}&tenant=0&granularity=${granularity}&startTime=${startDate}&endTime=${endDate}${application1}${location1}${eliminateUnknownSelected}&min=${data.threshold}&minUnresolvedOnly=${minUnresolvedOnly}`;\n      let eliminateUnknown = '';\n      if (data['type'] && data['type'] === 'location') {\n        eliminateUnknown = '&eliminateUnknown=location';\n        this.url = `${this.url}${eliminateUnknown}`;\n      }\n      this.filters = data;\n      this.runClicked = true;\n      this.getdata(false);\n    }\n    getdata(rerender) {\n      // will change after the original API gets\n      let url = `${environment.FA_API_BASE_URL}correlator/flowendpoint/count`;\n      this.subscribe = this.http.get(this.url).subscribe(res => {\n        if (sessionStorage.getItem('showSensitiveInfo') != 'true' && res) {\n          res.forEach(r => r.subscriber = maskString(r.subscriber));\n        }\n        this.tableData = res ? res : [];\n        this.exportData = res;\n        this.renderTable(rerender);\n        // this.loading = false;\n        this.chartOptionService.btnDisabled = false;\n      }, err => {\n        this.tableData = [];\n        this.exportData = [];\n        this.renderTable(rerender);\n        this.pageErrorHandle(err);\n        //this.loading = false;\n        this.chartOptionService.btnDisabled = false;\n      });\n    }\n    renderTable(rerender) {\n      this.tableLanguageOptions();\n      if (rerender || this.renderedOnce) {\n        this.rerender();\n        this.dataAvailable = true;\n        // setTimeout(() => {\n        //   this.loading = false;\n        // }, 1000)\n      } else {\n        this.dtTrigger.next();\n        this.renderedOnce = true;\n        this.dataAvailable = true;\n        // setTimeout(() => {\n        //   this.loading = false;\n        // }, 1000)\n      }\n    }\n\n    rerender() {\n      this.dtElement.dtInstance.then(dtInstance => {\n        // Destroy the table first\n        dtInstance.destroy();\n        this.dtTrigger.next();\n      });\n    }\n    search(term) {\n      this.dtElement.dtInstance.then(dtInstance => {\n        dtInstance.search(term).draw();\n      });\n    }\n    tableLanguageOptions() {\n      if (this.language.fileLanguage == 'fr') {\n        this.dtOptions.language = this.frTable;\n      } else if (this.language.fileLanguage == 'es') {\n        this.dtOptions.language = this.esTable;\n      } else if (this.language.fileLanguage == 'de_DE') {\n        this.dtOptions.language = this.customTranslateService.de_DE;\n      } else if (this.language.fileLanguage == 'en' && this.dtOptions.language) {\n        delete this.dtOptions.language;\n      }\n    }\n    getAllData(pdf) {\n      let url = `${environment.FA_API_BASE_URL}correlator/flowendpoint?pagenumber=${0}&pagesize=${this.dataCount}`;\n      this.pdfSubs = this.locationservice.getData(this.url).subscribe(data => {\n        this.exportData = data ? data : [];\n        if (pdf) {\n          this.doPDFDownload();\n        } else {\n          this.doCSVDownload();\n        }\n      }, err => {\n        if (pdf) {\n          this.doPDFDownload();\n        } else {\n          this.doCSVDownload();\n        }\n        this.pageErrorHandle(err);\n      });\n    }\n    downloadCSV() {\n      if (this.exportData && this.exportData.length) {\n        this.doCSVDownload();\n      } else {\n        this.getAllData(false);\n      }\n    }\n    doCSVDownload() {\n      let pipe = new DatePipe('en-US');\n      let timezoneName = 'UTC';\n      let exportData = this.exportDataConvertor(this.exportData);\n      let name = this.filters.type === 'location' ? 'Location_Active_Subscribers' : 'Network_Active_Subscribers';\n      let extraData = `${this.language.network} ${this.language.Active_subscriber}\\r\\n${this.language.Application} : ${this.filters['applicationsSelectedNames'] ? this.filters['applicationsSelectedNames'] : \"\"}\\r\\n${this.language.timeWindow} : ${pipe.transform(this.filters.startDate, 'MM/dd/yyyy')} - ${pipe.transform(this.filters.endDate, 'MM/dd/yyyy')} [${timezoneName}]\\r\\n${this.language.treshold} (Bytes): ${this.filters['threshold']}\\r\\n${this.language.elim} : ${this.filters['eliminateUnknownSelected'] === 'yes' ? this.language.Yes : this.language.No}\\r\\n${this.language.thres} : ${this.filters['thresholdTypeSelected'] === 'AllEndpoints' ? \"All Endpoints\" : \"Unresolvable Endpoints\"}\\r\\n`;\n      if (this.filters.type === 'location') {\n        extraData = `${this.language.location} ${this.language.Active_subscriber}\\r\\n${this.language.location} : ${this.filters['locationsSelectedNames']}\\r\\n${this.language.Application} : ${this.filters['applicationsSelectedNames'] ? this.filters['applicationsSelectedNames'] : \"\"}\\r\\n${this.language.timeWindow} : ${pipe.transform(this.filters.startDate, 'MM/dd/yyyy')} - ${pipe.transform(this.filters.endDate, 'MM/dd/yyyy')} [${timezoneName}]\\r\\n${this.language.treshold} (Bytes): ${this.filters['threshold']}\\r\\n${this.language.elim} : ${this.filters['eliminateUnknownSelected'] === 'yes' ? this.language.Yes : this.language.No}\\r\\n${this.language.thres} : ${this.filters['thresholdTypeSelected'] === 'AllEndpoints' ? \"All Endpoints\" : \"Unresolvable Endpoints\"}\\r\\n`;\n      }\n      if (exportData.length) {\n        this.exportExcel.downLoadCSV(name, exportData, extraData);\n      } else {\n        this.exportExcel.downLoadCSV(name, [], extraData);\n      }\n    }\n    downloadPdf() {\n      if (this.exportData && this.exportData.length) {\n        this.doPDFDownload();\n      } else {\n        this.getAllData(true);\n      }\n    }\n    doPDFDownload() {\n      let data = this.exportData;\n      const bodyData = [],\n        headerArray = this.columnDefs.map(obj => obj.headerName);\n      data.forEach(obj => {\n        const rowDatum = [];\n        this.columnDefs.forEach(colObj => {\n          if (colObj.field == 'usOctets' || colObj.field == 'dsOctets' || colObj.field == 'totalOctets') {\n            rowDatum.push(obj[colObj.field] ? this.convertByteToGB(obj[colObj.field]) : 0);\n          } else {\n            rowDatum.push(obj[colObj.field] ? obj[colObj.field] : colObj.field === 'hitCount' ? 0 : '');\n          }\n        });\n        bodyData.push(rowDatum);\n      });\n      let pipe = new DatePipe('en-US');\n      let timezoneName = 'UTC';\n      let extraData = `\\n${this.language.Application} : ${this.filters['applicationsSelectedNames'] ? this.filters['applicationsSelectedNames'] : \"\"}\\r\\n${this.language.timeWindow} : ${pipe.transform(this.filters.startDate, 'MM/dd/yyyy')} - ${pipe.transform(this.filters.endDate, 'MM/dd/yyyy')} [${timezoneName}]\\r\\n${this.language.treshold} (Bytes): ${this.filters['threshold']}\\r\\n${this.language.elim} : ${this.filters['eliminateUnknownSelected'] === 'yes' ? \"Yes\" : \"No\"}\\r\\n${this.language.thres} : ${this.filters['thresholdTypeSelected'] === 'AllEndpoints' ? \"All Endpoints\" : \"Unresolvable Endpoints\"}\\r\\n`;\n      if (this.filters.type === 'location') {\n        extraData = `\\n${this.language.location} : ${this.filters['locationsSelectedNames']}\\r\\n${this.language.Application} : ${this.filters['applicationsSelectedNames'] ? this.filters['applicationsSelectedNames'] : \"\"}\\r\\n${this.language.timeWindow} : ${pipe.transform(this.filters.startDate, 'MM/dd/yyyy')} - ${pipe.transform(this.filters.endDate, 'MM/dd/yyyy')} [${timezoneName}]\\r\\n${this.language.treshold} (Bytes): ${this.filters['threshold']}\\r\\n${this.language.elim} : ${this.filters['eliminateUnknownSelected'] === 'yes' ? \"Yes\" : \"No\"}\\r\\n${this.language.thres} : ${this.filters['thresholdTypeSelected'] === 'AllEndpoints' ? \"All Endpoints\" : \"Unresolvable Endpoints\"}\\r\\n`;\n      }\n      const doc = new jsPDF(\"landscape\");\n      const pageWidth = doc.internal.pageSize.width || doc.internal.pageSize.getWidth();\n      doc.text(`${this.filters.type === 'location' ? this.language.location : this.language.network} ${this.language.Active_subscriber}`, pageWidth / 2 - 30, 10);\n      doc.setFontSize(10);\n      var strArr = doc.splitTextToSize(`${extraData}`, 280);\n      doc.text(strArr, 7, 10);\n      //doc.text(document.getElementById('criteriaText').innerText, 5, 20);\n      //doc.text(`${extraData}`, 5, 10);\n      autoTable(doc, {\n        margin: {\n          top: 5,\n          right: 5,\n          bottom: 5,\n          left: 5\n        },\n        startY: 50,\n        tableWidth: \"auto\",\n        showHead: 'everyPage',\n        pageBreak: 'auto',\n        theme: 'striped',\n        head: [headerArray],\n        body: bodyData\n      });\n      let name = this.filters.type === 'location' ? 'Location_Active_Subscribers' : 'Network_Active_Subscribers';\n      doc.save(`${name}.pdf`);\n    }\n    exportDataConvertor(array) {\n      let check = Array.isArray(array);\n      let data = [];\n      if (check) {\n        array.forEach(el => {\n          data.push({\n            'Location': el.location ? el.location : '',\n            'Subscriber': el.subscriber ? el.subscriber : '',\n            'Up Usage(GB)': el.usOctets ? this.convertByteToGB(el.usOctets) : 0,\n            'Down Usage(GB)': el.dsOctets ? this.convertByteToGB(el.dsOctets) : 0,\n            'Total Usage(GB)': el.totalOctets ? this.convertByteToGB(el.totalOctets) : 0,\n            'Hit Count': el.hitCount ? el.hitCount : 0\n            // 'Aggregate Count': el.aggCount ? el.aggCount : ''\n          });\n        });\n      }\n\n      return data;\n    }\n    pageErrorHandle(err) {\n      if (err.status == 401) {\n        this.errorInfo = this.language['Access Denied'];\n      } else {\n        this.errorInfo = this.commonOrgService.pageErrorHandle(err);\n      }\n      this.showError(this.errorInfo);\n      this.loading = false;\n    }\n    closeAlert() {\n      this.error = false;\n    }\n    showError(msg) {\n      this.closeAlert();\n      this.errorInfo = msg;\n      this.error = true;\n      $(\"html, body\").animate({\n        scrollTop: 0\n      }, \"slow\");\n    }\n    makeIsoDate(value) {\n      let a = value.split('.');\n      let b = a[0].split(\":\");\n      b.pop();\n      return b.join(':') + ':00Z';\n    }\n    convertByteToGB(bytes) {\n      if (bytes) {\n        return (bytes / Math.pow(1000, 3)).toFixed(5);\n      } else return \"\";\n    }\n  }\n  ActiveSubscribersComponent.ɵfac = function ActiveSubscribersComponent_Factory(t) {\n    return new (t || ActiveSubscribersComponent)(i0.ɵɵdirectiveInject(i1.CustomTranslateService), i0.ɵɵdirectiveInject(i2.CommonService), i0.ɵɵdirectiveInject(i3.SsoAuthService), i0.ɵɵdirectiveInject(i4.HttpClient), i0.ɵɵdirectiveInject(i5.LocationReportApiService), i0.ɵɵdirectiveInject(i6.ExportExcelService), i0.ɵɵdirectiveInject(i7.ChartOptionsService), i0.ɵɵdirectiveInject(i8.Router));\n  };\n  ActiveSubscribersComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ActiveSubscribersComponent,\n    selectors: [[\"app-active-subscribers\"]],\n    viewQuery: function ActiveSubscribersComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(DataTableDirective, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.dtElement = _t.first);\n      }\n    },\n    decls: 2,\n    vars: 2,\n    consts: [[\"role\", \"alert\", \"class\", \"alert alert-warning\", 4, \"ngIf\"], [\"class\", \"col-md-12 mt-4\", 4, \"ngIf\"], [\"role\", \"alert\", 1, \"alert\", \"alert-warning\"], [1, \"col-md-12\", \"mt-4\"], [\"class\", \"w-100 alert alert-danger  fade show my-3\", 4, \"ngIf\"], [1, \"h-auto\"], [\"class\", \"cus-dd dropdown-button float-right\", \"placement\", \"bottom-right\", \"ngbDropdown\", \"\", 4, \"ngIf\"], [\"class\", \"text-margin-50\", 4, \"ngIf\"], [\"id\", \"fa-chart-wrapper\", 1, \"fa-chart-wrapper\", \"chart-min-h\"], [\"class\", \"loader\", 4, \"ngIf\"], [\"class\", \"row my-3\", 4, \"ngIf\"], [1, \"row\", \"my-3\", \"min-height-65\", 3, \"hidden\"], [1, \"col\"], [\"id\", \"active_subscribers\", \"width\", \"100%\", \"datatable\", \"\", 1, \"row-border\", \"hover\", \"table-alter\", 3, \"dtOptions\", \"dtTrigger\"], [1, \"alnright\"], [4, \"ngIf\"], [1, \"w-100\", \"alert\", \"alert-danger\", \"fade\", \"show\", \"my-3\"], [1, \"error-img\"], [\"src\", \"./assets/img/ic_error-36px.svg\"], [\"type\", \"button\", 1, \"close\", 3, \"click\"], [1, \"d-inline-flex\", 3, \"innerHtml\"], [\"placement\", \"bottom-right\", \"ngbDropdown\", \"\", 1, \"cus-dd\", \"dropdown-button\", \"float-right\"], [\"id\", \"dropdownExchange\", \"ngbDropdownToggle\", \"\", 1, \"mr-2\"], [1, \"listdata\", \"bar-label\", \"mb0\"], [1, \"fa\", \"fa-bars\", \"mr-2\"], [\"ngbDropdownMenu\", \"\", \"aria-labelledby\", \"dropdownExchange\", \"id\", \"supportListId\"], [\"ngbDropdownItem\", \"\", 1, \"greyaa\"], [3, \"click\"], [1, \"text-margin-50\"], [\"class\", \"chart-main-title\", 4, \"ngIf\"], [\"id\", \"criteriaText\", 1, \"hc-chart-subtitle\"], [1, \"chart-main-title\"], [1, \"loader\"], [1, \"d-flex\", \"justify-content-center\"], [1, \"spinner-border\", \"text-primary\"], [1, \"sr-only\"], [1, \"row\", \"my-3\"], [1, \"col-md-6\", \"offset-md-6\"], [1, \"text-right\", \"flat-right\"], [1, \"row\"], [1, \"col-md-4\"], [1, \"col-md-8\"], [1, \"ccl-form\"], [\"type\", \"search\", \"name\", \"searchbox\", 1, \"input-sm\", 3, \"placeholder\", \"keyup\", \"search\"], [1, \"serach-but\", \"btn-default\", \"primary\", \"btn-icon-md\", \"inline\"], [\"aria-hidden\", \"true\", 1, \"fa\", \"fa-search\"], [3, \"id\", 4, \"ngFor\", \"ngForOf\"], [3, \"id\"], [1, \"d-flex\", \"col-subs-width\"], [\"align\", \"right\"]],\n    template: function ActiveSubscribersComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ActiveSubscribersComponent_div_0_Template, 2, 1, \"div\", 0);\n        i0.ɵɵtemplate(1, ActiveSubscribersComponent_div_1_Template, 26, 15, \"div\", 1);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", !ctx.hasScopeAccess);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.pageAvailable && ctx.hasScopeAccess);\n      }\n    },\n    directives: [i9.NgIf, i10.DataTableDirective, i11.NgbDropdown, i11.NgbDropdownToggle, i11.NgbDropdownMenu, i11.NgbDropdownItem, i9.NgForOf],\n    pipes: [i9.SlicePipe, i9.DatePipe],\n    styles: [\".export_menu[_ngcontent-%COMP%]   image[_ngcontent-%COMP%]{transform:translate(2px)}.cus-dd.dropdown-button.show[_ngcontent-%COMP%]   .dropdown-menu.show[_ngcontent-%COMP%]{width:auto;min-width:74.59px;top:-1px!important;left:-8px!important;border-radius:0!important;z-index:5!important;margin:0;padding:5px 0;box-shadow:#888 3px 3px 10px;border:1px solid #999999;background:white}.cus-dd.dropdown-button.show[_ngcontent-%COMP%]   .listdata[_ngcontent-%COMP%]{font-weight:bold;color:#000;background-color:#e6ebf5}.cus-dd.dropdown-button.show[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px!important;line-height:15px;font-size:11px!important}.cus-dd.dropdown-button.show[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#fff;background:#335cad}.cus-dd[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]:after{display:none!important}.cus-dd[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{width:auto!important}.cus-dd[_ngcontent-%COMP%]   .listdata[_ngcontent-%COMP%]{padding:0 8px 4px 4px;border-radius:0}.cus-dd[_ngcontent-%COMP%]   .listdata[_ngcontent-%COMP%]:hover{background-color:#e6e6e6}.bar-label[_ngcontent-%COMP%]{font-size:12px;font-family:\\\"Lucida Grande\\\",\\\"Lucida Sans Unicode\\\",Arial,Helvetica,sans-serif;color:#333}.bar-label[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{font-size:18px;color:#666;margin-bottom:2px}.alnright[_ngcontent-%COMP%]{text-align:right}.text-margin-50[_ngcontent-%COMP%]{text-align:center;margin-top:50px}.chart-main-title[_ngcontent-%COMP%]{font-family:\\\"Source Sans Pro\\\",sans-serif;font-size:18px;color:#333;line-height:1.1640625}.hc-chart-subtitle[_ngcontent-%COMP%], .hc-chart-subtitle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Lato;color:#000;font-size:12px;line-height:1.1640625}.min-height-65[_ngcontent-%COMP%]{min-height:65vh}.col-subs-width[_ngcontent-%COMP%]{max-width:240px;word-break:break-all;max-height:230px;overflow:auto}\"]\n  });\n  return ActiveSubscribersComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}