{"ast":null,"code":"import cmdHelper from 'bpmn-js-properties-panel/lib/helper/CmdHelper';\nimport entryFactory from 'bpmn-js-properties-panel/lib/factory/EntryFactory';\nimport { query as domQuery } from 'min-dom';\n\n/**\n * Create an input or output mapping entry for a single input or output entry\n * @param {Object} parameter - BusinessObject for the respective paramter (can be 'zeebe:Input' or 'zeebe:Output')\n * @param {Function} translate - translate function.\n * @param {Object} options - Options.\n * @param {string} [options.idPrefix] - preFix used to construct the 'id' of the GUI entries\n * @param {Function} [options.onToggle] - function to be called when collapsible is toggled.\n * @param {Function} [options.onRemove] - function to be called when entry (collapsbile + source + target) is removed\n * @param {string} [options.prop] - moddle (zeebe-bpmn-moddle) property name for the IOMapping.\n *\n * @returns {Object} An Object containing multiple Objects in its `entries` attribute,\n * each representing a properties-panel entry. First entry will always be a collapsible followed\n * by two inputs (one for source and one for target).\n */\nexport default function (parameter, translate, options = {}) {\n  const result = {},\n    entries = result.entries = [];\n\n  // heading ////////////////////////////////////////////////////////\n  const collapsible = entryFactory.collapsible({\n    id: `${options.idPrefix}-collapsible`,\n    cssClasses: ['bpp-collapsible--with-mapping'],\n    open: false,\n    onRemove: options.onRemove,\n    onToggle: options.onToggle,\n    get: function () {\n      return {\n        title: parameter.target,\n        // In the heading do not show the leading `=` of the FEEL expression\n        description: getFormattedTargetValue(parameter.source)\n      };\n    }\n  });\n  const isOpen = options.isOpen || collapsible.isOpen;\n  result.setOpen = function (value) {\n    const entryNode = domQuery(`[data-entry=\"${collapsible.id}\"]`);\n    collapsible.setOpen(value, entryNode);\n  };\n  entries.push(collapsible);\n\n  // parameter target ////////////////////////////////////////////////////////\n  entries.push(entryFactory.validationAwareTextField(translate, {\n    id: `${options.idPrefix}-parameterTarget`,\n    label: getTargetTextInputLabel(translate, options.prop),\n    modelProperty: 'target',\n    getProperty: function () {\n      return parameter.target;\n    },\n    setProperty: function (element, values) {\n      return cmdHelper.updateBusinessObject(element, parameter, values);\n    },\n    validate: function (element, values) {\n      const validation = {},\n        targetValue = values.target;\n      if (!targetValue) {\n        validation.target = getTargetTextInputLabel(translate, options.prop) + ' ' + translate('must not be empty');\n      } else if (targetValue.indexOf(' ') >= 0) {\n        validation.target = getTargetTextInputLabel(translate, options.prop) + ' ' + translate('must not contain whitespaces');\n      }\n      return validation;\n    },\n    hidden: function () {\n      return !isOpen();\n    }\n  }));\n\n  // parameter source ////////////////////////////////////////////////////////\n  entries.push(entryFactory.validationAwareTextField(translate, {\n    id: `${options.idPrefix}-parameterSource`,\n    label: translate('Variable Assignment Value'),\n    modelProperty: 'source',\n    getProperty: function () {\n      return parameter.source;\n    },\n    setProperty: function (element, values) {\n      return cmdHelper.updateBusinessObject(element, parameter, values);\n    },\n    validate: function (element, value) {\n      const validation = {},\n        sourceValue = value.source;\n      if (!sourceValue) {\n        validation.source = translate('Variable Assignment Value must not be empty');\n      } else if (!sourceValue.startsWith('=')) {\n        validation.source = translate('Variable Assignment Value must be a valid FEEL expression and therefore start with \\'=\\'');\n      }\n      return validation;\n    },\n    hidden: function () {\n      return !isOpen();\n    }\n  }));\n  return result;\n}\n\n// helper ///////////////////////\n\n/**\n * Get label for the target input text field according to the property that is edited\n * @param {Function} translate translate.\n * @param {string} prop moddle (zeebe-bpmn-moddle) property name for the IOMapping.\n *\n * @returns {string} Label which makes sense in accordance with the provided property.\n */\nfunction getTargetTextInputLabel(translate, prop) {\n  if (prop === 'inputParameters') {\n    return translate('Local Variable Name');\n  }\n  if (prop === 'outputParameters') {\n    return translate('Process Variable Name');\n  }\n  return;\n}\n\n/**\n * Get formatted target value by removing first character\n * @param {string} targetValue\n *\n * @returns {string} formatted target value\n */\nfunction getFormattedTargetValue(targetValue) {\n  return targetValue.substr(1);\n}","map":null,"metadata":{},"sourceType":"module"}