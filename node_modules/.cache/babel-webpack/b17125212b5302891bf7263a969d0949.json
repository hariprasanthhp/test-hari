{"ast":null,"code":"import { environment } from '../../../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app-services/translate.service\";\nimport * as i2 from \"src/app/shared/services/download.service\";\nimport * as i3 from \"../../../../shared/services/sso-auth.service\";\nimport * as i4 from \"../../shared/service/call-outcome-report.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/platform-browser\";\nimport * as i7 from \"src/app/support/data.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@angular/forms\";\nimport * as i10 from \"@ng-select/ng-select\";\nfunction AuditReportComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.language.Audit_Report);\n  }\n}\nfunction AuditReportComponent_div_1_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵelementStart(1, \"span\", 15);\n    i0.ɵɵelement(2, \"img\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function AuditReportComponent_div_1_div_1_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.isModalError = !ctx_r6.isModalError;\n    });\n    i0.ɵɵelement(4, \"span\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 18);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r2.language[\"No data available\"]);\n  }\n}\nfunction AuditReportComponent_div_1_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵelementStart(1, \"span\", 15);\n    i0.ɵɵelement(2, \"img\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function AuditReportComponent_div_1_div_2_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.isError = !ctx_r8.isError;\n    });\n    i0.ɵɵelement(4, \"span\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 18);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r3.alertMessage);\n  }\n}\nfunction AuditReportComponent_div_1_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r5.language.Time_Period_Report_Error, \" \");\n  }\n}\nconst _c0 = function () {\n  return {\n    standalone: true\n  };\n};\nfunction AuditReportComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtemplate(1, AuditReportComponent_div_1_div_1_Template, 7, 1, \"div\", 5);\n    i0.ɵɵtemplate(2, AuditReportComponent_div_1_div_2_Template, 7, 1, \"div\", 5);\n    i0.ɵɵelementStart(3, \"div\", 6);\n    i0.ɵɵelementStart(4, \"form\", 7);\n    i0.ɵɵelementStart(5, \"div\", 8);\n    i0.ɵɵelementStart(6, \"ng-select\", 9, 10);\n    i0.ɵɵlistener(\"change\", function AuditReportComponent_div_1_Template_ng_select_change_6_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.onChangeTimePeriod();\n    })(\"ngModelChange\", function AuditReportComponent_div_1_Template_ng_select_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.selectedTimePeriod = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, AuditReportComponent_div_1_div_8_Template, 2, 1, \"div\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 12);\n    i0.ɵɵelementStart(10, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AuditReportComponent_div_1_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.downloadReportFile();\n    });\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const _r4 = i0.ɵɵreference(7);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isModalError);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isError);\n    i0.ɵɵadvance(4);\n    i0.ɵɵpropertyInterpolate(\"placeholder\", ctx_r1.language.Time_Period);\n    i0.ɵɵproperty(\"searchable\", false)(\"clearable\", false)(\"items\", ctx_r1.timePeriod)(\"ngModel\", ctx_r1.selectedTimePeriod)(\"ngModelOptions\", i0.ɵɵpureFunction0(11, _c0));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", (_r4 == null ? null : _r4.invalid) && ctx_r1.submit);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.bttnDissable);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r1.language.Download_Report);\n  }\n}\nexport let AuditReportComponent = /*#__PURE__*/(() => {\n  class AuditReportComponent {\n    constructor(translateService, downloadService, sso, callOutcomeReportService, router, titleService, service) {\n      this.translateService = translateService;\n      this.downloadService = downloadService;\n      this.sso = sso;\n      this.callOutcomeReportService = callOutcomeReportService;\n      this.router = router;\n      this.titleService = titleService;\n      this.service = service;\n      this.timePeriod = [{\n        name: 'Last 30 days',\n        id: \"30\"\n      }, {\n        name: 'Last 60 days',\n        id: \"60\"\n      }, {\n        name: 'Last 90 days',\n        id: \"90\"\n      }];\n      this.hasWriteAccess = false;\n      this.isModalError = false;\n      this.hasScopeAccess = false;\n      this.bttnDissable = false;\n      this.submit = false;\n      this.alertMessage = '';\n      this.orgId = this.sso.getOrgId();\n    }\n    ngOnInit() {\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n        this.titleService.setTitle(`${this.language['Audit_Report']} - ${this.language['Reports']} - ${this.language['NetOps']} - ${this.language['Service']} -  ${this.language['Calix Cloud']}`);\n        this.timePeriod = [{\n          name: this.language['Last_30_days'],\n          id: \"30\"\n        }, {\n          name: this.language['Last_60_days'],\n          id: \"60\"\n        }, {\n          name: this.language['Last_90_days'],\n          id: \"90\"\n        }];\n      });\n      let scopes = this.sso.getScopes();\n      if (!this.router.url.includes('cco/operations/cco-reports')) {\n        this.titleService.setTitle(`${this.language['Audit_Report']} - ${this.language['Reports']} - ${this.language['NetOps']} - ${this.language['Service']} -  ${this.language['Calix Cloud']}`);\n        if (environment.VALIDATE_SCOPE) {\n          scopes['cloud.rbac.csc.netops.reports.auditreports'] = scopes['cloud.rbac.csc.netops.reports.auditreports'] ? scopes['cloud.rbac.csc.netops.reports.auditreports'] : [];\n          if (scopes && scopes['cloud.rbac.csc.netops.reports.auditreports'].length) {\n            this.hasScopeAccess = true;\n          }\n          if (scopes && scopes['cloud.rbac.csc.netops.reports.auditreports'] && scopes['cloud.rbac.csc.netops.reports.auditreports'].indexOf('write') !== -1) {\n            this.hasWriteAccess = true;\n          }\n        } else {\n          this.hasWriteAccess = true;\n        }\n      } else {\n        this.titleService.setTitle('Audit Report - Reports - Operations - Operations -  Calix Cloud');\n        if (environment.VALIDATE_SCOPE) {\n          scopes['cloud.rbac.coc.operations.report.auditreports'] = scopes['cloud.rbac.coc.operations.report.auditreports'] ? scopes['cloud.rbac.coc.operations.report.auditreports'] : [];\n          if (scopes && scopes['cloud.rbac.coc.operations.report.auditreports'].length) {\n            this.hasScopeAccess = true;\n          }\n          if (scopes && scopes['cloud.rbac.coc.operations.report.auditreports'] && scopes['cloud.rbac.coc.operations.report.auditreports'].indexOf('write') !== -1) {\n            this.hasWriteAccess = true;\n          }\n        } else {\n          this.hasWriteAccess = true;\n        }\n      }\n      if (!this.hasScopeAccess) {\n        return;\n      } else {\n        this.sso.setPageAccess(true);\n      }\n      this.timePeriod = [{\n        name: this.language['Last_30_days'],\n        id: \"30\"\n      }, {\n        name: this.language['Last_60_days'],\n        id: \"60\"\n      }, {\n        name: this.language['Last_90_days'],\n        id: \"90\"\n      }];\n    }\n    onChangeTimePeriod() {\n      if (this.selectedTimePeriod) {\n        this.bttnDissable = false;\n      } else {\n        this.bttnDissable = true;\n      }\n    }\n    downloadReportFile() {\n      this.submit = true;\n      // this.bttnDissable= true;\n      if (!this.selectedTimePeriod) return;\n      this.isError = false;\n      this.isModalError = false;\n      let timeZone = this.getTimezoneName();\n      this.callOutcomeReportService.getAuditReportFilePath(this.orgId, this.selectedTimePeriod, timeZone).subscribe(res => {\n        this.selectedTimePeriod = null;\n        if (res != null) {\n          this.downloadService.saveToDisk(JSON.parse(res).fileName, null, true);\n        } else {\n          this.isModalError = true;\n        }\n        this.isError = false;\n        this.submit = false;\n      }, err => {\n        this.isError = true;\n        this.pageErrorHandle(err);\n      });\n    }\n    ngOnDestroy() {\n      this.languageSubject.unsubscribe();\n    }\n    getTimezoneName() {\n      return Intl.DateTimeFormat().resolvedOptions().timeZone;\n    }\n    pageErrorHandle(err, type = \"\") {\n      if (err.status == 401) {\n        this.alertMessage = this.language['Access Denied'];\n      } else if (err.status == 500) {\n        this.alertMessage = this.language['internalServerError'];\n      } else if (err.status == 400) {\n        let errorMsg = JSON.parse(err.error);\n        this.alertMessage = errorMsg.error;\n      } else {\n        this.alertMessage = this.sso.pageErrorHandle(err);\n      }\n      this.isError = true;\n      $(\"body\").scrollTop(0);\n    }\n  }\n  AuditReportComponent.ɵfac = function AuditReportComponent_Factory(t) {\n    return new (t || AuditReportComponent)(i0.ɵɵdirectiveInject(i1.TranslateService), i0.ɵɵdirectiveInject(i2.DownloadService), i0.ɵɵdirectiveInject(i3.SsoAuthService), i0.ɵɵdirectiveInject(i4.CallOutcomeReportService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i6.Title), i0.ɵɵdirectiveInject(i7.DataServiceService));\n  };\n  AuditReportComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AuditReportComponent,\n    selectors: [[\"app-audit-report\"]],\n    decls: 2,\n    vars: 2,\n    consts: [[\"class\", \"row no-gutters my-3\", 4, \"ngIf\"], [\"id\", \"call-outcome-report\", \"class\", \"tab-pane\", 4, \"ngIf\"], [1, \"row\", \"no-gutters\", \"my-3\"], [1, \"d-block\", \"d-sm-none\", \"ccl-Secondary-title\", \"mb-2\", \"col-md-12\", \"border-bottom\"], [\"id\", \"call-outcome-report\", 1, \"tab-pane\"], [\"class\", \"py-3 alert alert-danger\", 4, \"ngIf\"], [\"id\", \"netops_callOutcomeReport_formdiv\", 1, \"row\", \"pb-2\"], [1, \"w-100\"], [1, \"col-4\", \"mb-3\"], [\"id\", \"timePeriod\", \"name\", \"timePeriod\", \"bindLabel\", \"name\", \"autofocus\", \"\", \"bindValue\", \"id\", \"name\", \"rttype\", \"required\", \"\", 3, \"searchable\", \"clearable\", \"items\", \"placeholder\", \"ngModel\", \"ngModelOptions\", \"change\", \"ngModelChange\"], [\"rttype\", \"ngModel\"], [\"class\", \"errorMessage\", 4, \"ngIf\"], [1, \"col-md-12\"], [\"type\", \"button\", \"id\", \"netops_callOutcomeReport_download\", 1, \"btn-default\", \"primary\", \"px-3\", \"mb-2\", 3, \"disabled\", \"click\"], [1, \"py-3\", \"alert\", \"alert-danger\"], [1, \"success-img\"], [\"src\", \"./assets/img/error-icon.svg\"], [\"type\", \"button\", \"id\", \"close-error-btn\", \"data-dismiss\", \"alert\", \"aria-label\", \"Close\", 1, \"close\", 3, \"click\"], [1, \"d-inline-flex\"], [1, \"errorMessage\"]],\n    template: function AuditReportComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AuditReportComponent_div_0_Template, 3, 1, \"div\", 0);\n        i0.ɵɵtemplate(1, AuditReportComponent_div_1_Template, 12, 12, \"div\", 1);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.hasScopeAccess);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.hasScopeAccess);\n      }\n    },\n    directives: [i8.NgIf, i9.ɵNgNoValidate, i9.NgControlStatusGroup, i9.NgForm, i10.NgSelectComponent, i9.RequiredValidator, i9.NgControlStatus, i9.NgModel],\n    styles: [\"div.checkbox.switcher[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]{float:right}div.checkbox.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding:0;cursor:pointer}div.checkbox.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{vertical-align:middle}div.checkbox.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}div.checkbox.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] + span[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{position:relative;display:inline-block;width:45px;height:25px;background:#ffffff;border:1px solid #0279ff;border-radius:50px;transition:all .3s ease-in-out;padding:5px}div.checkbox.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{position:absolute;display:block;width:20px;height:19px;background:#0279ff;border-radius:50%;transition:all .3s ease-in-out;left:2px;top:2px}div.checkbox.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]{background:#269bff;border-color:#269bff}div.checkbox.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], div.radio.switcher[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{left:50%;background:#ffffff}form[_ngcontent-%COMP%]{width:100%}\"]\n  });\n  return AuditReportComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}