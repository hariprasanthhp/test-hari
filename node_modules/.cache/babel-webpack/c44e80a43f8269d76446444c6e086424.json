{"ast":null,"code":"import { add as collectionAdd, remove as collectionRemove } from 'diagram-js/lib/util/Collections';\nexport default function UpdateCanvasRootHandler(canvas, modeling) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n}\nUpdateCanvasRootHandler.$inject = ['canvas', 'modeling'];\nUpdateCanvasRootHandler.prototype.execute = function (context) {\n  var canvas = this._canvas;\n  var newRoot = context.newRoot,\n    newRootBusinessObject = newRoot.businessObject,\n    oldRoot = canvas.getRootElement(),\n    oldRootBusinessObject = oldRoot.businessObject,\n    bpmnDefinitions = oldRootBusinessObject.$parent,\n    diPlane = oldRootBusinessObject.di;\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(newRoot, true);\n\n  // (2) update root elements\n  collectionAdd(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = bpmnDefinitions;\n  collectionRemove(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = null;\n\n  // (3) wire di\n  oldRootBusinessObject.di = null;\n  diPlane.bpmnElement = newRootBusinessObject;\n  newRootBusinessObject.di = diPlane;\n  context.oldRoot = oldRoot;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n};\n\nUpdateCanvasRootHandler.prototype.revert = function (context) {\n  var canvas = this._canvas;\n  var newRoot = context.newRoot,\n    newRootBusinessObject = newRoot.businessObject,\n    oldRoot = context.oldRoot,\n    oldRootBusinessObject = oldRoot.businessObject,\n    bpmnDefinitions = newRootBusinessObject.$parent,\n    diPlane = newRootBusinessObject.di;\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(oldRoot, true);\n\n  // (2) update root elements\n  collectionRemove(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = null;\n  collectionAdd(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = bpmnDefinitions;\n\n  // (3) wire di\n  newRootBusinessObject.di = null;\n  diPlane.bpmnElement = oldRootBusinessObject;\n  oldRootBusinessObject.di = diPlane;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n};","map":null,"metadata":{},"sourceType":"module"}