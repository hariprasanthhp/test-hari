{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/cco/issues/service/issue.service\";\nimport * as i2 from \"../../services/home-geomap.service\";\nimport * as i3 from \"src/app/shared/services/sso-auth.service\";\nimport * as i4 from \"@angular/common/http\";\nimport * as i5 from \"src/app/sys-admin/services/common.service\";\nimport * as i6 from \"src/app-services/translate.service\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../../../issues/alarms-shared/alarm-details/alarm-details.component\";\nfunction AlarmDetailsModalComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵelementStart(2, \"div\", 4);\n    i0.ɵɵelementStart(3, \"div\", 5);\n    i0.ɵɵelementStart(4, \"span\", 6);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r0.language.Loading);\n  }\n}\nfunction AlarmDetailsModalComponent_ng_container_1_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelementStart(1, \"span\", 11);\n    i0.ɵɵelement(2, \"img\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AlarmDetailsModalComponent_ng_container_1_div_1_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return ctx_r5.closeAlert();\n    });\n    i0.ɵɵelement(4, \"span\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"div\", 14);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"innerHtml\", ctx_r2.language[ctx_r2.errorInfo] || ctx_r2.errorInfo, i0.ɵɵsanitizeHtml);\n  }\n}\nfunction AlarmDetailsModalComponent_ng_container_1_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelementStart(1, \"div\", 16);\n    i0.ɵɵelementStart(2, \"img\", 17);\n    i0.ɵɵlistener(\"click\", function AlarmDetailsModalComponent_ng_container_1_div_2_Template_img_click_2_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.onRefreshAckShelve($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 18);\n    i0.ɵɵelementStart(4, \"p\", 19);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r3.language[\"No Data Available\"]);\n  }\n}\nfunction AlarmDetailsModalComponent_ng_container_1_app_alarm_details_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-alarm-details\", 20);\n    i0.ɵɵlistener(\"ackShelveData\", function AlarmDetailsModalComponent_ng_container_1_app_alarm_details_3_Template_app_alarm_details_ackShelveData_0_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return ctx_r9.onAckShelve($event);\n    })(\"refreshAckShelveBtn\", function AlarmDetailsModalComponent_ng_container_1_app_alarm_details_3_Template_app_alarm_details_refreshAckShelveBtn_0_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return ctx_r11.onRefreshAckShelve($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"fullData\", ctx_r4.fullData)(\"showAckShelveBtn\", ctx_r4.showAckShelveBtn)(\"hasWriteAccess\", ctx_r4.hasWriteAccess)(\"hideSource\", ctx_r4.hideSource)(\"connected\", true)(\"clickedAlarmType\", \"Alarm\")(\"alarmType\", \"Alarm\");\n  }\n}\nfunction AlarmDetailsModalComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AlarmDetailsModalComponent_ng_container_1_div_1_Template, 6, 1, \"div\", 7);\n    i0.ɵɵtemplate(2, AlarmDetailsModalComponent_ng_container_1_div_2_Template, 6, 1, \"div\", 8);\n    i0.ɵɵtemplate(3, AlarmDetailsModalComponent_ng_container_1_app_alarm_details_3_Template, 1, 7, \"app-alarm-details\", 9);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.error);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.dataAvailable);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.dataAvailable);\n  }\n}\nexport let AlarmDetailsModalComponent = /*#__PURE__*/(() => {\n  class AlarmDetailsModalComponent {\n    constructor(issueService, homeGeomapService, ssoService, http, commonOrgService, translateService) {\n      this.issueService = issueService;\n      this.homeGeomapService = homeGeomapService;\n      this.ssoService = ssoService;\n      this.http = http;\n      this.commonOrgService = commonOrgService;\n      this.translateService = translateService;\n      this.hasWriteAccess = false;\n      this.baseUrl = `${environment.API_BASE_URL}analytics-engine/`;\n      this.error = false;\n      this.loading = false;\n      this.list = [];\n      this.showAckShelveBtn = false;\n      this.fullData = {};\n      this.hideSource = false;\n    }\n    ngOnInit() {\n      var _a;\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n        // this.loadIntialData();\n        // if (this.renderOnce) {\n        //   this.loadChart();\n        // }\n      });\n\n      let scopes = this.ssoService.getScopes();\n      if (((_a = scopes['cloud.rbac.coc.insights.activdevicesgeomap']) === null || _a === void 0 ? void 0 : _a.indexOf('write')) !== -1) {\n        this.hasWriteAccess = true;\n      }\n      this.systemDetails = this.issueService.getgeoMapHomeFilterParams();\n      this.getAlarmDetails();\n      console.log(this.systemDetails);\n    }\n    getAlarmDetails() {\n      this.list = [];\n      this.dataAvailable = false;\n      this.loading = true;\n      this.error = false;\n      let params = {};\n      params = {\n        // region: this.systemDetails['systemDetails']['deviceRegion']['region_uuid'],\n        // location: this.systemDetails['systemDetails']['deviceLocation']['networkgroup_uuid'],\n        // system: this.systemDetails['systemDetails']['deviceUuid'],\n        // fsan_serialnumber: this.systemDetails['systemDetails']['fsan_serialnumber']\n        //   ? this.systemDetails['systemDetails']['fsan_serialnumber']\n        //   : '',\n        //date: `${this.dateUtilsService.getUtCMilliSecByDateObj(fields['startDate'])},${this.dateUtilsService.getUtCMilliSecByDateObj(fields['endDate'], true)}`,\n        // historyReport: false,\n        severity: 'MAJOR,MINOR,CRITICAL,INFO,WARNING',\n        notificationType: 'Alarm',\n        // alarmEventName: this.systemDetails['system'] ? this.systemDetails['system'] : undefined,\n        searchValue: this.systemDetails['systemDetails']['outageAlarmId'] ? this.systemDetails['systemDetails']['outageAlarmId'] : undefined,\n        searchField: 'alarmId'\n        // cco_ack: 'all',\n      };\n\n      let query = '';\n      for (var key in params) {\n        if (params[key] == undefined || params[key] == '') {\n          continue;\n        }\n        if (query != '') {\n          query += '&';\n        }\n        query += key + '=' + encodeURIComponent(params[key]);\n      }\n      let url = `${this.baseUrl}alarmListByPagination?historyReport=false&pageSize=1&${query}`;\n      this.http.get(url).subscribe(resp => {\n        this.processListResp(resp);\n      }, err => {\n        this.loading = false;\n        this.pageErrorHandle(err);\n      });\n    }\n    pageErrorHandle(err) {\n      if (err.status == 401) {\n        this.errorInfo = this.language['Access Denied'];\n      } else {\n        this.errorInfo = this.commonOrgService.pageErrorHandle(err);\n      }\n      this.closeAlert();\n      this.error = true;\n    }\n    closeAlert() {\n      this.error = false;\n    }\n    processListResp(resp) {\n      if (resp && resp['alarms']) {\n        resp['alarms'].forEach(element => {\n          var _a, _b;\n          if (!element['subject']['deviceName']) {\n            element['subject']['deviceName'] = this.systemDetails['systemDetails']['deviceUuid'];\n          }\n          element['subject']['deviceName'] = (_a = element['subject']['deviceName']) === null || _a === void 0 ? void 0 : _a.replace('device=', '');\n          element['subject']['deviceName'] = (_b = element['subject']['deviceName']) === null || _b === void 0 ? void 0 : _b.replace('DEVICE=', '');\n          element['subject']['resourceForUI'] = this.issueService.generateResourceForUI(element, element.type === 'EXA' ? true : false);\n        });\n        this;\n        this.list = resp['alarms'];\n        if (this.list && this.list.length > 0) {\n          this.viewDetails(this.list[0], 0);\n          this.dataAvailable = true;\n        }\n      } else {\n        this.dataAvailable = false;\n        this.list = [];\n      }\n      this.loading = false;\n    }\n    onAckShelve(data) {\n      var _a, _b;\n      console.log(data);\n      if (typeof (data === null || data === void 0 ? void 0 : data.ack) !== 'undefined') {\n        if ((_a = this.list[this.index]) === null || _a === void 0 ? void 0 : _a.subject) {\n          this.list[this.index].subject.ccoAck = data === null || data === void 0 ? void 0 : data.ack;\n        }\n      } else if (typeof (data === null || data === void 0 ? void 0 : data.shelve) !== 'undefined') {\n        if ((_b = this.list[this.index]) === null || _b === void 0 ? void 0 : _b.subject) {\n          this.list[this.index].subject.ccoShelved = data === null || data === void 0 ? void 0 : data.shelve;\n        }\n      }\n    }\n    onRefreshAckShelve(value) {\n      this.showAckShelveBtn = false;\n      this.homeGeomapService.closeModal();\n    }\n    viewDetails(item, index) {\n      this.hideSource = false;\n      this.index = index;\n      this.fullData = item;\n      this.showAckShelveBtn = true;\n      this.loading = false;\n    }\n  }\n  AlarmDetailsModalComponent.ɵfac = function AlarmDetailsModalComponent_Factory(t) {\n    return new (t || AlarmDetailsModalComponent)(i0.ɵɵdirectiveInject(i1.IssueService), i0.ɵɵdirectiveInject(i2.HomeGeomapService), i0.ɵɵdirectiveInject(i3.SsoAuthService), i0.ɵɵdirectiveInject(i4.HttpClient), i0.ɵɵdirectiveInject(i5.CommonService), i0.ɵɵdirectiveInject(i6.TranslateService));\n  };\n  AlarmDetailsModalComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AlarmDetailsModalComponent,\n    selectors: [[\"app-alarm-details-modal\"]],\n    decls: 2,\n    vars: 2,\n    consts: [[\"class\", \"loader-wrapper-info\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"loader-wrapper-info\"], [1, \"loader\"], [1, \"d-flex\", \"justify-content-center\"], [\"role\", \"\", 1, \"spinner-border\", \"text-primary\"], [1, \"sr-only\"], [\"class\", \"w-100 alert alert-danger fade show my-3\", 4, \"ngIf\"], [\"class\", \"row\", 4, \"ngIf\"], [3, \"fullData\", \"showAckShelveBtn\", \"hasWriteAccess\", \"hideSource\", \"connected\", \"clickedAlarmType\", \"alarmType\", \"ackShelveData\", \"refreshAckShelveBtn\", 4, \"ngIf\"], [1, \"w-100\", \"alert\", \"alert-danger\", \"fade\", \"show\", \"my-3\"], [1, \"error-img\"], [\"src\", \"./assets/img/ic_error-36px.svg\"], [\"type\", \"button\", 1, \"close\", 3, \"click\"], [1, \"d-inline-flex\", 3, \"innerHtml\"], [1, \"row\"], [1, \"col-12\", \"text-right\", \"pr-4\", \"pt-2\"], [\"aria-hidden\", \"true\", \"src\", \"assets/img/ic_close-44px.svg\", \"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"pointer\", \"mr-2\", 3, \"click\"], [1, \"col-md-12\", \"pl-5\", \"pb-2\", \"text-left\"], [1, \"pb-1\"], [3, \"fullData\", \"showAckShelveBtn\", \"hasWriteAccess\", \"hideSource\", \"connected\", \"clickedAlarmType\", \"alarmType\", \"ackShelveData\", \"refreshAckShelveBtn\"]],\n    template: function AlarmDetailsModalComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AlarmDetailsModalComponent_div_0_Template, 6, 1, \"div\", 0);\n        i0.ɵɵtemplate(1, AlarmDetailsModalComponent_ng_container_1_Template, 4, 3, \"ng-container\", 1);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n      }\n    },\n    directives: [i7.NgIf, i8.AlarmDetailsComponent],\n    styles: [\"\"]\n  });\n  return AlarmDetailsModalComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}