{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport * as moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"src/app/shared/services/sso-auth.service\";\nimport * as i3 from \"@angular/router\";\nexport let NetworkReportApiService = /*#__PURE__*/(() => {\n  class NetworkReportApiService {\n    constructor(httpClient, sso, router) {\n      this.httpClient = httpClient;\n      this.sso = sso;\n      this.router = router;\n      this.orgId = this.sso.getOrganizationID(this.router.url);\n    }\n    getTraffic(params) {\n      let startDate = new Date(params.startDate);\n      let endDate = new Date(params.endDate);\n      startDate = this.getISOStartOfDay(startDate);\n      endDate = this.getISOEndOfDay(endDate);\n      let criteria = params.criteriaSelected ? params.criteriaSelected : 'usage';\n      let granularity = this.getGranularity(startDate, endDate, 'traffic', criteria);\n      startDate = this.getStartUTCDate(params.startDate, 0);\n      endDate = this.getEndUTCDate(params.endDate);\n      if (criteria != 'usage') {\n        params.startTime = params.startTime - 1;\n        params.endTime = params.endTime - 1;\n        let diff = moment(endDate).diff(moment(startDate), \"hour\");\n        let dayDiff = moment(endDate).diff(moment(startDate), \"days\");\n        granularity = dayDiff <= 31 ? '1hour' : '24hour';\n        if (diff <= 72 && dayDiff <= 3) {\n          let d = new Date(params.startDate);\n          startDate = this.getStartUTCDate(params.startDate, params.startTime);\n          endDate = this.getStartUTCDate(d, params.endTime);\n          granularity = '1min';\n          params.APIStartDate = startDate;\n          params.APIendDate = endDate;\n        }\n      } else if (criteria == 'usage') {\n        startDate = this.getISOStartOfDay(params.startDate);\n        endDate = this.getISOEndOfDay(params.endDate);\n      }\n      let url = `${environment.CCO_REPORTS_BASE_URL}timeseries?org=${this.orgId}&tenant=0&granularity=${granularity}&startTime=${startDate}&endTime=${endDate}&output=${criteria}&direction=both`;\n      return this.httpClient.get(url);\n    }\n    getTopLocations(params, page) {\n      let startDate = new Date(params.startDate);\n      let endDate = new Date(params.endDate);\n      let criteria = params.criteriaSelected ? params.criteriaSelected : 'usage';\n      let limit = params.limit ? params.limit : 10;\n      let direction = params.directionSelected ? params.directionSelected : 'both';\n      startDate = this.getISOStartOfDay(startDate);\n      endDate = this.getISOEndOfDay(endDate);\n      let granularity = this.getGranularity(startDate, endDate, 'topLocations');\n      if (criteria !== 'usage') {\n        startDate = this.getStartUTCDate(params.startDate, 0);\n        endDate = this.getEndUTCDate(params.endDate);\n      }\n      let url = `${environment.CCO_REPORTS_BASE_URL}reports/toplocations?org=${this.orgId}&tenant=0&granularity=${granularity}&startTime=${startDate}&endTime=${endDate}&output=${criteria}&count=${limit}&direction=${direction}`;\n      if (page && page == 'apps-top-locations') {\n        let appParams = '';\n        if (params['applicationsSelected'] && !params['applicationsSelected'].includes(\"All\")) {\n          params['applicationsSelected'].forEach(element => {\n            appParams += `&application=${element}`;\n          });\n          url = `${url}${appParams}`;\n        }\n      }\n      return this.httpClient.get(url);\n    }\n    TopApplication(params, page) {\n      let startDate = new Date(params.startDate);\n      let endDate = new Date(params.endDate);\n      let criteria = params.criteriaSelected ? params.criteriaSelected : 'usage';\n      let limit = params.limit ? params.limit : 10;\n      let direction = params.directionSelected ? params.directionSelected : 'both';\n      let group = params.groupSelected == 'yes' ? true : false;\n      startDate = this.getISOStartOfDay(startDate);\n      endDate = this.getISOEndOfDay(endDate);\n      let granularity = this.getGranularity(startDate, endDate, 'topApplications');\n      if (criteria !== 'usage') {\n        startDate = this.getStartUTCDate(params.startDate, 0);\n        endDate = this.getEndUTCDate(params.endDate);\n      }\n      let url = `${environment.CCO_REPORTS_BASE_URL}/reports/topapplications?org=${this.orgId}&tenant=0&granularity=${granularity}&startTime=${startDate}&endTime=${endDate}&output=${criteria}&count=${limit}&direction=${direction}&groupApplications=${group}`;\n      return this.httpClient.get(url);\n    }\n    makeIsoDate(value) {\n      let a = value.split('.');\n      let b = a[0].split(\":\");\n      b.pop();\n      return b.join(':') + ':00Z';\n    }\n    getISODate(dt) {\n      let d = new Date(dt);\n      let year = d.getFullYear();\n      let month = `${d.getMonth() + 1}`;\n      let day = `${d.getDate()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      let date = `${year}-${month}-${day}T00:00:00Z`;\n      return date;\n    }\n    getAppTraffic(params) {\n      let startDate = new Date(params.startDate);\n      let endDate = new Date(params.endDate);\n      startDate = this.getISOStartOfDay(startDate);\n      endDate = this.getISOEndOfDay(endDate);\n      let granularity = this.getGranularity(startDate, endDate);\n      startDate = this.getStartUTCDate(params.startDate, 0);\n      endDate = this.getEndUTCDate(params.endDate);\n      let url = `${environment.CCO_REPORTS_BASE_URL}timeseries?org=${this.orgId}&tenant=0&granularity=1hour&startTime=${startDate}&endTime=${endDate}&output=rate&direction=both&groupBy=application&count=${params['limit']}`;\n      return this.httpClient.get(url);\n    }\n    getTopSubdata(params, module) {\n      let startDate = new Date(params.startDate);\n      let endDate = new Date(params.endDate);\n      let criteria = params.criteriaSelected ? params.criteriaSelected : 'usage';\n      let limit = params.limit ? params.limit : 10;\n      let direction = params.directionSelected ? params.directionSelected : 'both';\n      startDate = this.getISOStartOfDay(startDate);\n      endDate = this.getISOEndOfDay(endDate);\n      let granularity = this.getGranularity(startDate, endDate, 'topSubscribers');\n      if (criteria !== 'usage') {\n        startDate = this.getStartUTCDate(params.startDate, 0);\n        endDate = this.getEndUTCDate(params.endDate);\n      }\n      let url = `${environment.CCO_REPORTS_BASE_URL}/reports/topsubscribers?org=${this.orgId}&tenant=0&granularity=${granularity}&startTime=${startDate}&endTime=${endDate}&output=${criteria}&count=${limit}&direction=${direction}`;\n      let locationParams = '';\n      if (module === 'location' && params['locationsSelected'] && !params['locationsSelected'].includes(\"All\")) {\n        params['locationsSelected'].forEach(element => {\n          locationParams += \"&location=\" + element;\n        });\n        url = `${url}${locationParams}`;\n      } else {\n        locationParams = '';\n      }\n      let applicationParams = '';\n      if (module === 'application' && params['applicationsSelected'] && !params['applicationsSelected'].includes(\"All\")) {\n        params['applicationsSelected'].forEach(element => {\n          applicationParams += \"&application=\" + element;\n        });\n        url = `${url}${applicationParams}`;\n      } else {\n        applicationParams = '';\n      }\n      let eliminateUnknown = '';\n      if (module === 'location' && params['type'] && params['type'] === 'location') {\n        eliminateUnknown = '&eliminateUnknown=location';\n        url = `${url}${eliminateUnknown}`;\n      }\n      return this.httpClient.get(url);\n    }\n    getPowerUsers(params, page) {\n      let date = new Date();\n      let monthCount = params.periodSelected ? parseInt(params.periodSelected) : -1;\n      let firstDay = new Date(date.getFullYear(), date.getMonth() + monthCount, 1);\n      let lastDay = new Date(date.getFullYear(), date.getMonth(), 0);\n      let startDate = this.getISODate(firstDay);\n      let endDate = this.getISODate(lastDay);\n      let direction = params.directionSelected ? params.directionSelected : 'both';\n      let minPeak = parseInt(params.peakRateFrom) > 0 ? parseInt(params.peakRateFrom) * (1024 * 1024) : 0;\n      let maxPeak = parseInt(params.peakRateTo) > 0 ? parseInt(params.peakRateTo) * (1024 * 1024) : 0;\n      // let minPeak = params.peakRateFrom >= 0 ? `${params.peakRateFrom}` : '';\n      // let maxPeak = params.peakRateTo >= 0 ? `${params.peakRateTo}` : '';\n      let granularity = '24hour';\n      startDate = this.getStartUTCDate(firstDay, 0);\n      endDate = this.getEndUTCDate(lastDay);\n      let url = `${environment.CCO_REPORTS_BASE_URL}reports/powerusers?org=${this.orgId}&tenant=0&granularity=${granularity}&startTime=${startDate}&endTime=${endDate}&direction=${direction}&minPeak=${minPeak}&maxPeak=${maxPeak}`;\n      return this.httpClient.get(url);\n    }\n    getDatePrevMonth(monthCount) {\n      let date = new Date();\n      // let firstDay = new Date(date.getFullYear(), date.getMonth() + monthCount, 1);\n      // let lastDay = new Date();\n      let firstDay = new Date(date.getFullYear(), date.getMonth() + monthCount, 1);\n      let lastDay = new Date(date.getFullYear(), date.getMonth(), 0);\n      return {\n        start: firstDay,\n        end: lastDay\n      };\n    }\n    getGranularity(startDate, endDate, reportType = '', criteriaType = '') {\n      let granularity = '';\n      if (reportType == 'traffic') {\n        let diff = moment(endDate).diff(moment(startDate), \"hour\");\n        let dayDiff = moment(endDate).diff(moment(startDate), \"days\");\n        if (criteriaType != 'usage') {\n          granularity = diff <= 72 && dayDiff <= 3 ? '1min' : dayDiff <= 31 && diff > 72 ? '1hour' : '24hour';\n        } else {\n          granularity = diff <= 24 ? '1hour' : '24hour';\n        }\n      }\n      if (reportType == 'topSubscribers' || reportType == 'topApplications' || reportType == 'topLocations') {\n        let diff = moment(endDate).diff(moment(startDate), \"hour\");\n        granularity = diff <= 72 ? '1hour' : '24hour';\n      }\n      return granularity;\n    }\n    checkSameDate(params) {\n      let date1 = new Date(params.startDate).setHours(0, 0, 0, 0);\n      let date2 = new Date(params.endDate).setHours(0, 0, 0, 0);\n      if (date1 == date2) {\n        return true;\n      }\n      return false;\n    }\n    getStartDate(dt, hour, diff) {\n      let d = new Date(dt);\n      if (diff === 3 && hour < 48 && hour >= 24) {\n        d.setDate(new Date(d).getDate() + 1);\n      } else if (diff === 3 && hour >= 48) {\n        d.setDate(new Date(d).getDate() + 2);\n      }\n      if (diff === 2 && hour >= 24) {\n        d.setDate(new Date(d).getDate() + 1);\n      }\n      if (hour >= 48) {\n        hour = hour - 48;\n      } else if (hour >= 24) {\n        hour = hour - 24;\n      }\n      let year = `${d.getFullYear()}`;\n      let month = `${d.getMonth() + 1}`;\n      let day = `${d.getDate()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      let hr = hour > 9 ? hour : '0' + hour;\n      let date = `${year}-${month}-${day}T${hr}:00:00Z`;\n      return date;\n    }\n    getEndDate(dt, hour, diff) {\n      let d = new Date(dt);\n      if (diff == 3 && hour <= 48 && hour > 24) {\n        d.setDate(new Date(d).getDate() - 1);\n      } else if (diff == 3 && hour <= 24) {\n        d.setDate(new Date(d).getDate() - 2);\n      }\n      if (diff == 2 && hour <= 24) {\n        d.setDate(new Date(d).getDate() - 1);\n      }\n      if (hour === 24 || hour === 48 || hour === 72) {\n        d.setDate(new Date(d).getDate() + 1);\n        hour = 0;\n      }\n      if (hour >= 48) {\n        hour = hour - 48;\n      } else if (hour >= 24) {\n        hour = hour - 24;\n      }\n      let year = `${d.getFullYear()}`;\n      let month = `${d.getMonth() + 1}`;\n      let day = `${d.getDate()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      let hr = hour > 9 ? hour : '0' + hour;\n      let date = `${year}-${month}-${day}T${hr}:00:00Z`;\n      return date;\n    }\n    getStartUTCDate(dt, addHours) {\n      let d = new Date(dt);\n      d.setHours(addHours, 0, 0, 0);\n      let year = d.getUTCFullYear();\n      let month = `${d.getUTCMonth() + 1}`;\n      let day = `${d.getUTCDate()}`;\n      let hr = `${d.getUTCHours()}`;\n      let min = `${d.getUTCMinutes()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      if (hr.length < 2) {\n        hr = `0${hr}`;\n      }\n      if (min.length < 2) {\n        min = `0${min}`;\n      }\n      let date = `${year}-${month}-${day}T${hr}:${min}:00Z`;\n      return date;\n    }\n    getEndUTCDate(dt) {\n      let d = new Date(dt);\n      d.setHours(0, 0, 0, 0);\n      d.setDate(new Date(d).getDate() + 1);\n      let year = d.getUTCFullYear();\n      let month = `${d.getUTCMonth() + 1}`;\n      let day = `${d.getUTCDate()}`;\n      let hr = `${d.getUTCHours()}`;\n      let min = `${d.getUTCMinutes()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      if (hr.length < 2) {\n        hr = `0${hr}`;\n      }\n      if (min.length < 2) {\n        min = `0${min}`;\n      }\n      let date = `${year}-${month}-${day}T${hr}:${min}:00Z`;\n      return date;\n    }\n    getISOStartEndDate(dt, end, addHours) {\n      let d = new Date(dt);\n      let today = new Date();\n      if (!end) {\n        //let hrsToAdd = addHours ? addHours : 0;\n        let hrsToAdd = 0;\n        d.setHours(0 + hrsToAdd, 0, 0, 0);\n      } else {\n        d.setHours(23, 59, 0, 0);\n      }\n      let year = d.getUTCFullYear();\n      let month = `${d.getUTCMonth() + 1}`;\n      let day = `${d.getUTCDate()}`;\n      let hr = `${d.getUTCHours()}`;\n      let min = `${d.getUTCMinutes()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      if (end) {\n        let selectedDate = new Date(d);\n        if (selectedDate > today) {\n          hr = `${new Date().getUTCHours()}`;\n          min = `${new Date().getUTCMinutes()}`;\n        }\n      }\n      if (hr.length < 2) {\n        hr = `0${hr}`;\n      }\n      if (min.length < 2) {\n        min = `0${min}`;\n      }\n      let date = `${year}-${month}-${day}T${hr}:${min}:00Z`;\n      return date;\n    }\n    getISOStartOfDay(dt) {\n      //returns 12AM UTC of day\n      let d = new Date(dt);\n      let year = d.getFullYear();\n      let month = `${d.getMonth() + 1}`;\n      let day = `${d.getDate()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      let date = `${year}-${month}-${day}T00:00:00Z`;\n      return date;\n    }\n    getISOEndOfDay(dt) {\n      //returns 12AM UTC of Next day of End date\n      let d = new Date(dt);\n      d.setDate(new Date(d).getDate() + 1);\n      let year = d.getFullYear();\n      let month = `${d.getMonth() + 1}`;\n      let day = `${d.getDate()}`;\n      if (month.length < 2) {\n        month = `0${month}`;\n      }\n      if (day.length < 2) {\n        day = `0${day}`;\n      }\n      let date = `${year}-${month}-${day}T00:00:00Z`;\n      return date;\n    }\n  }\n  NetworkReportApiService.ɵfac = function NetworkReportApiService_Factory(t) {\n    return new (t || NetworkReportApiService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.SsoAuthService), i0.ɵɵinject(i3.Router));\n  };\n  NetworkReportApiService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: NetworkReportApiService,\n    factory: NetworkReportApiService.ɵfac,\n    providedIn: 'root'\n  });\n  return NetworkReportApiService;\n})();","map":null,"metadata":{},"sourceType":"module"}