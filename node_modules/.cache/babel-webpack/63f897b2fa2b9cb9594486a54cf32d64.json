{"ast":null,"code":"import { NavigationEnd, RouteConfigLoadStart, RouteConfigLoadEnd } from '@angular/router';\nimport { environment } from './../environments/environment';\nimport * as $ from 'jquery';\nimport * as Highcharts from 'highcharts';\nimport { fromEvent } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../app/shared/services/sso-auth.service\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i5 from \"src/app-services/translate.service\";\nimport * as i6 from \"./shared/services/custom-translate.service\";\nimport * as i7 from \"./sys-admin/services/common.service\";\nimport * as i8 from \"src/app-services/routing.services\";\nimport * as i9 from \"@angular/common\";\nconst _c0 = [\"tosModal\"];\nconst _c1 = [\"declineTOSModal\"];\nconst _c2 = [\"apigeeErrorModal\"];\nconst _c3 = [\"refreshModal\"];\nfunction AppComponent_div_0_a_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"a\", 16);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_0_a_11_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      ctx_r10.hideUpdatePopup();\n      return ctx_r10.updateLater();\n    });\n    i0.ɵɵtext(1, \"Remind me in 30m\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵelementStart(1, \"div\", 9);\n    i0.ɵɵelement(2, \"img\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 11);\n    i0.ɵɵelementStart(4, \"h3\", 12);\n    i0.ɵɵtext(5, \"Updates Available\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 12);\n    i0.ɵɵtext(7, \"Calix Cloud has been updated. Do you want to apply these changes now? Updating will cause this page to refresh.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 13);\n    i0.ɵɵelementStart(9, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_0_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      ctx_r12.hideUpdatePopup();\n      return ctx_r12.refreshPage();\n    });\n    i0.ɵɵtext(10, \"Update now\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, AppComponent_div_0_a_11_Template, 2, 0, \"a\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", !ctx_r0.isUpdateAnimation ? \"fadeInUp\" : \"fadeInDwon\");\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.updateLaterClicked);\n  }\n}\nfunction AppComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 17);\n    i0.ɵɵelementStart(1, \"span\", 18);\n    i0.ɵɵelement(2, \"img\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_1_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.errorMsg = \"\";\n    });\n    i0.ɵɵelement(4, \"span\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"div\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"innerHtml\", ctx_r1.errorMsg, i0.ɵɵsanitizeHtml);\n  }\n}\nfunction AppComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵelementStart(1, \"div\", 23);\n    i0.ɵɵelementStart(2, \"div\", 24);\n    i0.ɵɵelementStart(3, \"div\", 25);\n    i0.ɵɵelementStart(4, \"span\", 26);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r2.language.Loading);\n  }\n}\nfunction AppComponent_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵelementStart(1, \"h4\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_6_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return ctx_r19.loadDeclineTosModal();\n    });\n    i0.ɵɵelement(4, \"span\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 30, 31);\n    i0.ɵɵelement(7, \"div\", 32);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 33);\n    i0.ɵɵelementStart(9, \"div\", 34);\n    i0.ɵɵelementStart(10, \"div\", 35);\n    i0.ɵɵelementStart(11, \"p\", 36);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 35);\n    i0.ɵɵelementStart(14, \"div\", 37);\n    i0.ɵɵelementStart(15, \"button\", 38);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_6_Template_button_click_15_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return ctx_r21.loadDeclineTosModal();\n    });\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"button\", 39);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_6_Template_button_click_17_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return ctx_r22.agreeTos();\n    });\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r4.language[\"Terms of Service\"]);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"innerHtml\", ctx_r4.body, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r4.language.Note, \": \", ctx_r4.language[\"Scroll terms to bottom to enable the Accept button\"], \". \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r4.language[\"I Decline\"], \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r4.acceptBtnDisabled);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r4.language[\"I Accept\"]);\n  }\n}\nfunction AppComponent_ng_template_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵelementStart(1, \"h4\", 40);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 41);\n    i0.ɵɵelement(4, \"i\", 42);\n    i0.ɵɵtext(5);\n    i0.ɵɵelement(6, \"br\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelement(8, \"br\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelement(10, \"br\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 43);\n    i0.ɵɵelementStart(12, \"button\", 44);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_8_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r26);\n      const ctx_r25 = i0.ɵɵnextContext();\n      return ctx_r25.doLogout();\n    });\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r6.language[\"Decline Terms of Service\"]);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r6.language[\"Since you did not accept the Terms of Service, we are logging you out\"], \".\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r6.language[\"If you would like to sign in successfully, we recommend you read and accept the terms of service agreement\"], \".\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r6.language[\"You will be directed to the Cloud product page\"], \".\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r6.language.Close);\n  }\n}\nfunction AppComponent_ng_template_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r30 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵelement(1, \"h4\", 40);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"div\", 41);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 43);\n    i0.ɵɵelementStart(5, \"button\", 45);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_10_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r30);\n      const ctx_r29 = i0.ɵɵnextContext();\n      return ctx_r29.doLogout();\n    });\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r8.language[\"Invalid apigee keys force logging out you\"], \". \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r8.language.Close);\n  }\n}\nconst borderRadius = require('highcharts-border-radius');\nborderRadius(Highcharts);\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(router, sso, http, dialogService, translateService, customTranslateService, elementRef, commonOrgService, routerService) {\n      this.router = router;\n      this.sso = sso;\n      this.http = http;\n      this.dialogService = dialogService;\n      this.translateService = translateService;\n      this.customTranslateService = customTranslateService;\n      this.elementRef = elementRef;\n      this.commonOrgService = commonOrgService;\n      this.routerService = routerService;\n      this.loading = true;\n      this.tosAgreed = true;\n      this.isLogout = false;\n      this.ngbModalOptions = {\n        size: 'lg',\n        backdrop: 'static',\n        keyboard: false,\n        windowClass: 'custom-md-modal'\n      };\n      this.date = new Date();\n      this.updateLaterClicked = false;\n      this.isUpdateAnimation = true;\n      this.isUpdateAvailable = false;\n      this.lastActivityMs = Date.now();\n      this.IDLE_4_HOURS_MS = 4 * 60 * 60 * 1000;\n      this.IDLE_15_MINUTES_MS = 15 * 60 * 1000;\n      this.acceptBtnDisabled = true;\n      this.page = '';\n      if (!sessionStorage.getItem('defaultLanguage')) {\n        sessionStorage.setItem('defaultLanguage', 'en');\n      }\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n      });\n      this.router.events.subscribe(ev => {\n        if (ev instanceof RouteConfigLoadStart) {\n          this.loadingRouteConfig = true;\n        } else if (ev instanceof RouteConfigLoadEnd) {\n          this.loadingRouteConfig = false;\n        }\n        if (ev instanceof NavigationEnd) {\n          this.loadingRouteConfig = false;\n          this.routerService.previousUrl = this.routerService.currentUrl ? this.routerService.currentUrl : '';\n          this.routerService.currentUrl = ev && ev.url ? ev.url : '';\n        }\n      });\n    }\n    ngOnInit() {\n      var _a;\n      if (JSON.parse(localStorage.getItem(\"calix.loggedIn\"))) {\n        this.commonOrgService.initUpdateCronJob(false);\n      }\n      this.commonOrgService.isNewVersionAvailable.subscribe(response => {\n        this.isUpdateAnimation = response.isUpdateAnimation;\n        this.isUpdateAvailable = response.isUpdateAvailable;\n      });\n      const url = new URL(window.location.href);\n      // setTimeout(() => {\n      //   window.location.reload();\n      // },1000)\n      if (url.pathname.includes('/subscriber/search') || ((_a = history === null || history === void 0 ? void 0 : history.state) === null || _a === void 0 ? void 0 : _a.externalUser)) {\n        let param = {};\n        const urlSplit = window.location.href.split('?');\n        if (urlSplit.length > 1) {\n          param = urlSplit[1].split('&').map(obj => {\n            const keyValue = obj.split('=');\n            return {\n              [keyValue[0]]: keyValue[1]\n            };\n          }).reduce((prev, curr) => Object.assign(prev, curr), {});\n        }\n        const params = {\n          'subscriberLocationId': encodeURIComponent(decodeURIComponent(param['subscriberLocationId'] || '').trim()),\n          'ticketId': encodeURIComponent(param['ticketId'])\n        };\n        sessionStorage.setItem('outsideUser', JSON.stringify({\n          url: url.pathname,\n          param: params,\n          externalUser: true\n        }));\n      }\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n      });\n      //this.checkRightClicksForNewTab();\n      //this.checkDataAvailableForNewTab();\n      this.sso.setTabId(Math.random().toString());\n      //this.getActiveTabsParam();\n      //this.sso.changeStorage();\n      this.getPageName();\n      this.watchActiveLogin();\n      this.watchIdleTime();\n      this.receiveLogoutFlag();\n      this.checkUserActivityIdle();\n      this.catchApigeeError();\n    }\n    checkDataAvailableForNewTab() {\n      if (localStorage.sessionStorage && !sessionStorage.length) {\n        Object.entries(JSON.parse(localStorage.sessionStorage)).forEach(arr => {});\n      }\n    }\n    checkRightClicksForNewTab() {\n      document.addEventListener('contextmenu', function (evt) {\n        evt.stopPropagation();\n        localStorage.setItem('sessionStorage', JSON.stringify(sessionStorage));\n      }, false);\n    }\n    watchIdleTime() {\n      if (environment.API_BASE_URL.indexOf('dev.api.calix.ai') !== -1) {\n        //console.log(`idle time out set to ${15 * 60 * 1000} milli seconds`)\n        this.idleTimeoutMs = this.IDLE_4_HOURS_MS; // 15 minutes\n      } else {\n        this.idleTimeoutMs = this.IDLE_4_HOURS_MS; // 15 minutes\n      }\n      // this.idleTimeoutMs = this.IDLE_4_HOURS_MS;\n      this.addSessionTimeoutTimer();\n    }\n    addDocumentClickEvent() {\n      fromEvent(document, 'click').subscribe(event => {\n        this.sso.setLastActivityTime();\n      });\n    }\n    checkUserActivityIdle() {\n      let path = window.location.pathname;\n      if (path.indexOf('login') !== -1 || path.indexOf('redirect') !== -1) {\n        return;\n      }\n      if (this.sso.getLastActivityTime() + this.idleTimeoutMs < Date.now()) {\n        console.log(`Force to Logout for idle TOO long (${this.idleTimeoutMs / 1000 / 60} minutes) --------------------`);\n        if (this.intervalId) {\n          window.clearInterval(this.intervalId);\n          this.intervalId = null;\n        }\n        this.isUpdateAvailable = false;\n        this.router.navigate(['/logout']);\n      }\n    }\n    addSessionTimeoutTimer() {\n      if (this.intervalId) {\n        window.clearInterval(this.intervalId);\n        this.intervalId = null;\n      }\n      this.intervalId = window.setInterval(() => {\n        this.checkUserActivityIdle();\n      }, 1 * 60 * 1000);\n    }\n    watchActiveLogin() {\n      this.loginCheck();\n      this.watchLoginService = setInterval(() => {\n        this.loginCheck();\n      }, 10000);\n    }\n    receiveLogoutFlag() {\n      this.logoutSubscribe = this.sso.logoutResult$.subscribe(json => {\n        this.watchIdleTime();\n        if (json.logout) {\n          this.isLogout = true;\n        } else {\n          this.isLogout = false;\n        }\n      });\n    }\n    loginCheck() {\n      // if (this.isLogout) {\n      //   return;\n      // }\n      if (!this.sso.isLoggedIn()) {\n        let path = window.location.pathname;\n        if (path.indexOf('login') !== -1 || path.indexOf('redirect') !== -1) {\n          return;\n        }\n        console.log('logged out from other tab');\n        const searchParam = new URL(window.location.href).searchParams;\n        const param = {\n          'subscriberLocationId': (searchParam.get('subscriberLocationId') || '').trim(),\n          'ticketId': searchParam.get('ticketId')\n        };\n        const state = path.includes('/subscriber/search') ? {\n          url: path,\n          param: param,\n          externalUser: true\n        } : {};\n        this.router.navigate(['logout'], {\n          state: state\n        });\n      }\n    }\n    loadTosFile() {\n      this.errorMsg = '';\n      this.tosAgreed = false;\n      let url = '';\n      let entArr = this.sso.getEntitlementsArr();\n      this.page = this.sso.getRelativeUrl();\n      if (this.page === 'cco') {\n        url = `${environment.TOS_API_URL}/coc/${environment.CCO_TOS_MD_HASH}`;\n      } else if (this.page === 'foundation') {\n        url = `${environment.TOS_API_URL}/foundation/${environment.FOUNDATION_TOS_MD_HASH}`;\n      } else if (this.page === 'support') {\n        if (entArr.indexOf(\"118\") !== -1) {\n          url = `${environment.TOS_API_URL}/support/${environment.CSC_TOS_MD_HASH}`;\n        } else {\n          url = `${environment.TOS_API_URL}/support_basic/${environment.CSC_BASIC_TOS_MD_HASH}`;\n        }\n      } else {\n        url = `${environment.TOS_API_URL}/marketing/${environment.CMC_TOS_MD_HASH}`;\n      }\n      this.http.get(url).subscribe(json => {\n        if (json.accept) {\n          this.tosAgreed = true;\n          if (this.page === 'cco') {\n            this.sso.setCcoTos(true);\n          } else if (this.page === 'foundation') {\n            this.sso.setFoundationTos(true);\n          } else if (this.page === 'support') {\n            this.sso.setCscTos(true);\n          } else {\n            this.sso.setCmcTos(true);\n          }\n        } else {\n          this.tosAgreed = false;\n          this.loadTosModal();\n        }\n      }, error => {\n        this.errorMsg = this.commonOrgService.pageErrorHandle(error);\n        this.tosAgreed = true;\n        if (this.page === 'cco') {\n          this.sso.setCcoTos(true);\n        } else if (this.page === 'foundation') {\n          this.sso.setFoundationTos(true);\n        } else if (this.page === 'support') {\n          this.sso.setCscTos(true);\n        } else {\n          this.sso.setCmcTos(true);\n        }\n      });\n    }\n    loadTosModal() {\n      let entArr = this.sso.getEntitlementsArr();\n      let appType = '';\n      if (this.page === 'cco') {\n        appType = 'coc';\n      } else if (this.page === 'foundation') {\n        appType = 'foundation';\n      } else if (this.page === 'support') {\n        if (entArr.indexOf(\"118\") !== -1) {\n          appType = 'support';\n        } else {\n          appType = 'support_basic';\n        }\n      } else {\n        if (entArr.indexOf(\"119\") !== -1 || entArr.indexOf(\"209\") !== -1) {\n          appType = 'marketing';\n        }\n      }\n      this.acceptBtnDisabled = true;\n      let url = `assets/tos/${appType}/tos-agreement.html`;\n      this.http.get(url, {\n        responseType: 'text'\n      }).subscribe(text => {\n        this.body = text;\n        this.close();\n        if (this.page === 'foundation') {\n          this.modalRef = this.dialogService.open(this.tosModal, this.ngbModalOptions);\n        } else if (this.page === 'cco') {\n          if (this.sso.checkUserHasServiceAccessByAppId(\"coc\")) {\n            this.modalRef = this.dialogService.open(this.tosModal, this.ngbModalOptions);\n          } else {\n            this.modalRef = this.dialogService.open(this.tosModal, this.ngbModalOptions);\n          }\n        } else if (this.page === 'support') {\n          if (this.sso.checkUserHasServiceAccessByAppId(\"csc\")) {\n            this.modalRef = this.dialogService.open(this.tosModal, this.ngbModalOptions);\n          } else {\n            this.modalRef = this.dialogService.open(this.tosModal, this.ngbModalOptions);\n          }\n        } else {\n          if (this.sso.checkUserHasServiceAccessByAppId(\"cmc\")) {\n            this.modalRef = this.dialogService.open(this.tosModal, this.ngbModalOptions);\n          } else {\n            this.tosAgreed = true;\n            this.sso.setCmcTos(true);\n          }\n        }\n        this.addScrollListener();\n      }, error => {});\n    }\n    addScrollListener() {\n      var myDiv = document.getElementById('tos-body');\n      myDiv.scrollTop = 0;\n      let that = this;\n      $('#tos-body').on('scroll', function () {\n        // if ($(this).scrollTop() + $(this).innerHeight() >= ($(this)[0].scrollHeight - 50)) {\n        //   console.log('end reached');\n        //   that.acceptBtnDisabled = false;\n        // }\n        let frameContents = $(\".terms-content\").contents();\n        let frameHeight = frameContents.height();\n        let modelBodyHeight = $('.terms-content').height();\n        let scrollTop = $(this).scrollTop();\n        if (scrollTop + modelBodyHeight > frameHeight - 50) {\n          that.acceptBtnDisabled = false;\n        }\n      });\n    }\n    loadDeclineTosModal() {\n      var myDiv = document.getElementById('tos-body');\n      myDiv.scrollTop = 0;\n      if (this.tosAgreed) {\n        return;\n      }\n      this.close();\n      this.modalRef = this.dialogService.open(this.declineTOSModal, this.ngbModalOptions);\n    }\n    doLogout() {\n      this.close();\n      this.tosAgreed = true;\n      this.router.navigate(['logout']);\n    }\n    agreeTos() {\n      this.acceptBtnDisabled = true;\n      var myDiv = document.getElementById('tos-body');\n      let entArr = this.sso.getEntitlementsArr();\n      let version = '';\n      let appType = '';\n      if (this.page === 'foundation') {\n        appType = 'foundation';\n        version = environment.FOUNDATION_TOS_MD_HASH;\n      } else if (this.page === 'cco') {\n        appType = 'coc';\n        version = environment.CCO_TOS_MD_HASH;\n      } else if (this.page === 'support') {\n        if (entArr.indexOf(\"118\") !== -1) {\n          version = environment.CSC_TOS_MD_HASH;\n          appType = 'support';\n        } else {\n          version = environment.CSC_BASIC_TOS_MD_HASH;\n          appType = 'support_basic';\n        }\n      } else {\n        if (entArr.indexOf(\"119\") !== -1 || entArr.indexOf(\"209\") !== -1) {\n          version = environment.CMC_TOS_MD_HASH;\n          appType = 'marketing';\n        }\n      }\n      let params = {\n        \"version\": version,\n        \"appType\": appType,\n        \"accept\": true\n      };\n      this.http.post(environment.TOS_API_URL, params, {\n        responseType: 'text'\n      }).subscribe(json => {\n        myDiv.scrollTop = 0;\n        this.acceptBtnDisabled = false;\n        if (this.page === 'foundation') {\n          this.sso.setFoundationTos(true);\n        } else if (this.page === 'cco') {\n          this.sso.setCcoTos(true);\n        } else if (this.page === 'support') {\n          this.sso.setCscTos(true);\n        } else {\n          this.sso.setCmcTos(true);\n        }\n        this.tosAgreed = true;\n        this.close();\n        //this.tosModalClose.nativeElement.click();\n      }, error => {\n        this.tosAgreed = true;\n        myDiv.scrollTop = 0;\n        this.acceptBtnDisabled = false;\n      });\n    }\n    getPageName() {\n      this.sso.relativeUrlResult$.subscribe(json => {\n        this.page = json.page;\n        if (this.page === 'cco' && !this.sso.isCcoTermsAccept()) {\n          this.tosAgreed = false;\n          this.loadTosFile();\n        } else if (this.page === 'foundation' && !this.sso.isFoundationTermsAccept()) {\n          this.tosAgreed = false;\n          this.loadTosFile();\n        } else if (this.page === 'support' && !this.sso.isSupportTermsAccept()) {\n          this.tosAgreed = false;\n          this.loadTosFile();\n        } else if (this.page === 'marketing' && !this.sso.isMarketingTermsAccept()) {\n          this.tosAgreed = false;\n          this.loadTosFile();\n        }\n        // else if (this.page === 'cco' && !this.sso.isCcoTermsAccept()) {\n        //   this.tosAgreed = false;\n        //   this.loadTosFile();\n        // }\n        this.tosAgreed = true;\n      }, err => {\n        this.tosAgreed = true;\n      });\n    }\n    close() {\n      if (this.modalRef) {\n        this.modalRef.close();\n      }\n    }\n    ngOnDestroy() {\n      // if (this.watchLoginService) {\n      //   clearInterval(this.watchLoginService);\n      // }\n      if (this.logoutSubscribe) {\n        this.logoutSubscribe.unsubscribe();\n      }\n      if (this.languageSubject) {\n        this.languageSubject.unsubscribe();\n      }\n    }\n    actionAuditLog(url) {\n      const loginData = localStorage.getItem('calix.login_data') ? JSON.parse(localStorage.getItem('calix.login_data')) : '';\n      if (loginData) {\n        for (let i = 0; i < 2; i++) {\n          const path = `/support/system/${i ? 'auditlog' : 'actionlog'}`;\n          const request = {\n            \"orgid\": loginData.OrgId,\n            \"user\": loginData.OrgId,\n            \"appid\": \"CSC\",\n            \"optype\": url,\n            \"target\": \"system\",\n            \"timestamp\": {},\n            \"severity\": \"0\",\n            \"message\": i ? `[uname=${loginData.username}][ip=${loginData.clientIp}]` : ''\n          };\n          this.sso.actionAuditLog(path, request).subscribe(res => {}, err => {});\n        }\n      }\n    }\n    getActiveTabsParam() {\n      $(window).off('focus');\n      $(window).on('focus', () => {\n        let obj = {};\n        const tabId = this.sso.getTabId();\n        for (let key in window.localStorage) {\n          const val = localStorage.getItem(key);\n          if (val.includes(tabId)) obj[key] = val.replace(tabId, '');\n        }\n      });\n    }\n    catchApigeeError() {\n      this.sso.apigeeError$.subscribe(json => {\n        sessionStorage.setItem('hard_refresh_the_page', 'true');\n        this.modalRef = this.dialogService.open(this.apigeeErrorModal);\n        setTimeout(() => {\n          this.doLogout();\n        }, 10000);\n      });\n    }\n    ngAfterViewInit() {\n      this.addDocumentClickEvent();\n      if (localStorage.getItem('defaultLanguage')) {\n        sessionStorage.setItem('defaultLanguage', localStorage.getItem('defaultLanguage'));\n        this.translateService.changeLanguage(localStorage.getItem('defaultLanguage'));\n        this.customTranslateService.changeLanguage(localStorage.getItem('defaultLanguage'));\n      }\n    }\n    ngAfterViewChecked() {\n      if (this.elementRef.nativeElement.querySelector('input[type]')) this.elementRef.nativeElement.querySelectorAll('input[type]').forEach(input => input.addEventListener(\"blur\", this.removeTrialingSpaces));\n    }\n    removeTrialingSpaces(event) {\n      if (environment.API_BASE_URL.includes('dev.api.calix')) event.target.value = event.target.value.trim();\n    }\n    refreshPage() {\n      setTimeout(() => {\n        window.location.reload();\n      }, 500);\n    }\n    updateLater() {\n      this.updateLaterClicked = true;\n      this.commonOrgService.initUpdateCronJob(true);\n    }\n    hideUpdatePopup() {\n      this.isUpdateAnimation = false;\n      setTimeout(() => {\n        this.isUpdateAvailable = false;\n      }, 500);\n    }\n  }\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.SsoAuthService), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i4.NgbModal), i0.ɵɵdirectiveInject(i5.TranslateService), i0.ɵɵdirectiveInject(i6.CustomTranslateService), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i7.CommonService), i0.ɵɵdirectiveInject(i8.RouterService));\n  };\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"app-root\"]],\n    viewQuery: function AppComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7);\n        i0.ɵɵviewQuery(_c1, 7);\n        i0.ɵɵviewQuery(_c2, 7);\n        i0.ɵɵviewQuery(_c3, 7);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tosModal = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.declineTOSModal = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.apigeeErrorModal = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.refreshModal = _t.first);\n      }\n    },\n    decls: 12,\n    vars: 4,\n    consts: [[\"class\", \"update-popup animated \", 3, \"ngClass\", 4, \"ngIf\"], [\"class\", \"w-100 alert alert-danger  fade show my-3\", 4, \"ngIf\"], [\"id\", \"app-main-div\", 3, \"hidden\"], [\"class\", \"loader-wrapper-info\", 4, \"ngIf\"], [\"id\", \"TermOfServiceModal\"], [\"tosModal\", \"\"], [\"declineTOSModal\", \"\"], [\"apigeeErrorModal\", \"\"], [1, \"update-popup\", \"animated\", 3, \"ngClass\"], [1, \"ml-3\"], [\"src\", \"../assets/img/ic_info_white.svg\", \"alt\", \"\"], [1, \"text-white\", \"w-72\"], [1, \"m-0\"], [1, \"d-flex\", \"align-items-center\", \"flex-column\", \"w-20\"], [1, \"btn-default\", \"text-dark\", 3, \"click\"], [\"class\", \"text-white text-decoration-none pointer mt-1\", 3, \"click\", 4, \"ngIf\"], [1, \"text-white\", \"text-decoration-none\", \"pointer\", \"mt-1\", 3, \"click\"], [1, \"w-100\", \"alert\", \"alert-danger\", \"fade\", \"show\", \"my-3\"], [1, \"error-img\"], [\"src\", \"./assets/img/ic_error-36px.svg\"], [\"type\", \"button\", 1, \"close\", 3, \"click\"], [1, \"d-inline-flex\", 3, \"innerHtml\"], [1, \"loader-wrapper-info\"], [1, \"loader\"], [1, \"d-flex\", \"justify-content-center\"], [\"role\", \"\", 1, \"spinner-border\", \"text-primary\"], [1, \"sr-only\"], [1, \"modal-header\"], [\"type\", \"button\", \"aria-label\", \"Close\", 1, \"close\", 3, \"click\"], [\"aria-hidden\", \"true\"], [\"id\", \"tos-body\", 1, \"modal-body\", \"terms-content\"], [\"tosModalBody\", \"\"], [3, \"innerHtml\"], [1, \"modal-footer\", 2, \"display\", \"block !important\", \"align-items\", \"none\"], [1, \"row\"], [1, \"col-12\"], [1, \"mb-0\"], [1, \"flex-end\"], [\"type\", \"button\", 1, \"btn\", \"btn-default\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", \"ml-2\", 3, \"disabled\", \"click\"], [1, \"modal-title\"], [1, \"modal-body\"], [\"aria-hidden\", \"true\", 1, \"fa\", \"fa-info-circle\"], [1, \"modal-footer\"], [\"type\", \"button\", \"id\", \"popupConfirmButton\", \"data-dismiss\", \"modal\", 1, \"btn\", \"btn-default\", \"btn-lg\", 3, \"click\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", 1, \"btn\", \"btn-default\", \"btn-lg\", 3, \"click\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AppComponent_div_0_Template, 12, 2, \"div\", 0);\n        i0.ɵɵtemplate(1, AppComponent_div_1_Template, 6, 1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelement(3, \"router-outlet\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(4, \"router-outlet\");\n        i0.ɵɵtemplate(5, AppComponent_div_5_Template, 6, 1, \"div\", 3);\n        i0.ɵɵtemplate(6, AppComponent_ng_template_6_Template, 19, 7, \"ng-template\", 4, 5, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(8, AppComponent_ng_template_8_Template, 14, 5, \"ng-template\", null, 6, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(10, AppComponent_ng_template_10_Template, 7, 2, \"ng-template\", null, 7, i0.ɵɵtemplateRefExtractor);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.isUpdateAvailable);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorMsg);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"hidden\", !ctx.tosAgreed);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.loadingRouteConfig);\n      }\n    },\n    directives: [i9.NgIf, i1.RouterOutlet, i9.NgClass],\n    styles: [\".terms-content[_ngcontent-%COMP%]{min-height:300px;max-height:350px;overflow-y:auto}.btn[_ngcontent-%COMP%]{padding:10px 15px!important;font-size:14px;line-height:16px}.modal-footer[_ngcontent-%COMP%]{border-top:1px solid #ccc!important}.update-popup[_ngcontent-%COMP%]{height:87px;background-color:#333;display:flex;align-items:center;justify-content:space-between;padding:1rem}.w-72[_ngcontent-%COMP%]{width:72%}.w-20[_ngcontent-%COMP%]{width:20%}@keyframes fadeInUp{0%{margin-top:0}to{margin-top:-100px}}@keyframes fadeInDwon{0%{margin-top:-100px}to{margin-top:0}}.fadeInDwon[_ngcontent-%COMP%]{animation-name:fadeInDwon;-webkit-animation-name:fadeInDwon}.animated[_ngcontent-%COMP%]{animation-duration:.5s;animation-fill-mode:both;-webkit-animation-duration:.5s;-webkit-animation-fill-mode:both}.fadeInUp[_ngcontent-%COMP%]{animation-name:fadeInUp;-webkit-animation-name:fadeInUp}\"]\n  });\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}