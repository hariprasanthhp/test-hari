{"ast":null,"code":"import { forEach, isArray } from 'min-dash';\nvar NOT_REGISTERED_ERROR = 'is not a registered action',\n  IS_REGISTERED_ERROR = 'is already registered';\n\n/**\n * An interface that provides access to modeling actions by decoupling\n * the one who requests the action to be triggered and the trigger itself.\n *\n * It's possible to add new actions by registering them with ´registerAction´\n * and likewise unregister existing ones with ´unregisterAction´.\n *\n *\n * ## Life-Cycle and configuration\n *\n * The editor actions will wait for diagram initialization before\n * registering default actions _and_ firing an `editorActions.init` event.\n *\n * Interested parties may listen to the `editorActions.init` event with\n * low priority to check, which actions got registered. Other components\n * may use the event to register their own actions via `registerAction`.\n *\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function EditorActions(eventBus, injector) {\n  // initialize actions\n  this._actions = {};\n  var self = this;\n  eventBus.on('diagram.init', function () {\n    // all diagram modules got loaded; check which ones\n    // are available and register the respective default actions\n    self._registerDefaultActions(injector);\n\n    // ask interested parties to register available editor\n    // actions on diagram initialization\n    eventBus.fire('editorActions.init', {\n      editorActions: self\n    });\n  });\n}\nEditorActions.$inject = ['eventBus', 'injector'];\n\n/**\n * Register default actions.\n *\n * @param {Injector} injector\n */\nEditorActions.prototype._registerDefaultActions = function (injector) {\n  // (1) retrieve optional components to integrate with\n\n  var commandStack = injector.get('commandStack', false);\n  var modeling = injector.get('modeling', false);\n  var selection = injector.get('selection', false);\n  var zoomScroll = injector.get('zoomScroll', false);\n  var copyPaste = injector.get('copyPaste', false);\n  var canvas = injector.get('canvas', false);\n  var rules = injector.get('rules', false);\n  var keyboardMove = injector.get('keyboardMove', false);\n  var keyboardMoveSelection = injector.get('keyboardMoveSelection', false);\n\n  // (2) check components and register actions\n\n  if (commandStack) {\n    this.register('undo', function () {\n      commandStack.undo();\n    });\n    this.register('redo', function () {\n      commandStack.redo();\n    });\n  }\n  if (copyPaste && selection) {\n    this.register('copy', function () {\n      var selectedElements = selection.get();\n      copyPaste.copy(selectedElements);\n    });\n  }\n  if (copyPaste) {\n    this.register('paste', function () {\n      copyPaste.paste();\n    });\n  }\n  if (zoomScroll) {\n    this.register('stepZoom', function (opts) {\n      zoomScroll.stepZoom(opts.value);\n    });\n  }\n  if (canvas) {\n    this.register('zoom', function (opts) {\n      canvas.zoom(opts.value);\n    });\n  }\n  if (modeling && selection && rules) {\n    this.register('removeSelection', function () {\n      var selectedElements = selection.get();\n      if (!selectedElements.length) {\n        return;\n      }\n      var allowed = rules.allowed('elements.delete', {\n          elements: selectedElements\n        }),\n        removableElements;\n      if (allowed === false) {\n        return;\n      } else if (isArray(allowed)) {\n        removableElements = allowed;\n      } else {\n        removableElements = selectedElements;\n      }\n      if (removableElements.length) {\n        modeling.removeElements(removableElements.slice());\n      }\n    });\n  }\n  if (keyboardMove) {\n    this.register('moveCanvas', function (opts) {\n      keyboardMove.moveCanvas(opts);\n    });\n  }\n  if (keyboardMoveSelection) {\n    this.register('moveSelection', function (opts) {\n      keyboardMoveSelection.moveSelection(opts.direction, opts.accelerated);\n    });\n  }\n};\n\n/**\n * Triggers a registered action\n *\n * @param  {string} action\n * @param  {Object} opts\n *\n * @return {Unknown} Returns what the registered listener returns\n */\nEditorActions.prototype.trigger = function (action, opts) {\n  if (!this._actions[action]) {\n    throw error(action, NOT_REGISTERED_ERROR);\n  }\n  return this._actions[action](opts);\n};\n\n/**\n * Registers a collections of actions.\n * The key of the object will be the name of the action.\n *\n * @example\n * ´´´\n * var actions = {\n *   spaceTool: function() {\n *     spaceTool.activateSelection();\n *   },\n *   lassoTool: function() {\n *     lassoTool.activateSelection();\n *   }\n * ];\n *\n * editorActions.register(actions);\n *\n * editorActions.isRegistered('spaceTool'); // true\n * ´´´\n *\n * @param  {Object} actions\n */\nEditorActions.prototype.register = function (actions, listener) {\n  var self = this;\n  if (typeof actions === 'string') {\n    return this._registerAction(actions, listener);\n  }\n  forEach(actions, function (listener, action) {\n    self._registerAction(action, listener);\n  });\n};\n\n/**\n * Registers a listener to an action key\n *\n * @param  {string} action\n * @param  {Function} listener\n */\nEditorActions.prototype._registerAction = function (action, listener) {\n  if (this.isRegistered(action)) {\n    throw error(action, IS_REGISTERED_ERROR);\n  }\n  this._actions[action] = listener;\n};\n\n/**\n * Unregister an existing action\n *\n * @param {string} action\n */\nEditorActions.prototype.unregister = function (action) {\n  if (!this.isRegistered(action)) {\n    throw error(action, NOT_REGISTERED_ERROR);\n  }\n  this._actions[action] = undefined;\n};\n\n/**\n * Returns the number of actions that are currently registered\n *\n * @return {number}\n */\nEditorActions.prototype.getActions = function () {\n  return Object.keys(this._actions);\n};\n\n/**\n * Checks wether the given action is registered\n *\n * @param {string} action\n *\n * @return {boolean}\n */\nEditorActions.prototype.isRegistered = function (action) {\n  return !!this._actions[action];\n};\nfunction error(action, message) {\n  return new Error(action + ' ' + message);\n}","map":null,"metadata":{},"sourceType":"module"}