{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport * as constants from '../../../shared/constants/marketing.constants';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./../shared/services/explore-data-common.service\";\nimport * as i3 from \"../shared/services/download-file-name.service\";\nimport * as i4 from \"src/app/shared/services/sso-auth.service\";\nimport * as i5 from \"src/app-services/translate.service\";\nexport let MarketingExploreDataRetentionApiService = /*#__PURE__*/(() => {\n  class MarketingExploreDataRetentionApiService {\n    constructor(httpClient, marketingExploreCommonService, downloadFileNameService, ssoAuthService, translateService) {\n      this.httpClient = httpClient;\n      this.marketingExploreCommonService = marketingExploreCommonService;\n      this.downloadFileNameService = downloadFileNameService;\n      this.ssoAuthService = ssoAuthService;\n      this.translateService = translateService;\n      this.baseURL = environment.cmcBaseURL;\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n      });\n      // BASIC\n      this.churnRateInsights = this.baseURL + 'insights/churn-user-count-by-month?';\n      this.retention = this.baseURL + 'target-segmentation/retention-insights-report?';\n      this.churnRisk = this.baseURL + 'marketing/churn-candidate?';\n      this.churnRiskSummary = this.baseURL + 'marketing/churn-candidate-count?';\n      // DRILL DOWN\n      this.churnRateInsightsDrillDown = this.baseURL + 'insights/churn-user-report-overall?';\n      // INLINE TABLE CHARTS\n      this.churnRateInsightsInlineCharts = this.baseURL + 'insights/single-churn-user-history?';\n      // DRILL DOWN EXPORT\n      this.churnRateInsightsDrillDownExport = this.baseURL + 'insights/churn-user-report-overall?';\n      this.churnRateInsightsDrillDownHistoryExport = this.baseURL + 'insights/churn-user-history?';\n      this.churnRateInsightsDrillDownHistorySingleExport = this.baseURL + 'insights/single-churn-user-history?';\n      this.retentionExport = this.baseURL + 'target-segmentation/retention-insights-report?';\n      this.churnRiskExport = this.baseURL + 'marketing/churn-candidate?';\n    }\n    // BASIC\n    ChurnRateInsights() {\n      return this.httpClient.get(this.marketingExploreCommonService.queryParamsAssigner(this.churnRateInsights));\n    }\n    ChurnRisk() {\n      return this.httpClient.get(this.marketingExploreCommonService.queryParamsAssigner(`${this.churnRisk}page=1&size=10&output=json&`));\n    }\n    ChurnRiskSummary() {\n      return this.httpClient.get(this.marketingExploreCommonService.queryParamsAssigner(`${this.churnRiskSummary}`) + '&output=json');\n    }\n    Retention() {\n      return this.httpClient.get(this.marketingExploreCommonService.queryParamsAssigner(`${this.retention}page=1&size=10&output=json&`));\n    }\n    // DRILL DOWN\n    ChurnRateInsightsDrillDown(clickData) {\n      let startEndDate = this.marketingExploreCommonService.monthStartEndCategoriesCreator(clickData.tier);\n      let tech = clickData.tech.replace('+', '%2B');\n      return this.httpClient.get(this.marketingExploreCommonService.queryParamsWithoutPeriod(`${this.churnRateInsightsDrillDown}tier=${tech}&page=${clickData.page}&size=${clickData.size}&start=${startEndDate.startDate}&end=${startEndDate.endDate}&`));\n    }\n    // DRILL DOWN CHARTS\n    ChurnRateInsightsInlineCharts(clickData, rowDetails) {\n      let newMonth;\n      var element = clickData.tier;\n      newMonth = element.split('-');\n      var month = constants.monthsArray.findIndex(x => x === newMonth[0]);\n      var category = parseInt(newMonth[1]) + 2000;\n      var tier_data = category + \"-\" + month;\n      return this.httpClient.get(this.marketingExploreCommonService.queryParamsAssigner(`${this.churnRateInsightsInlineCharts}endpoint-id=${rowDetails.endPointId}&churn-date=${tier_data}&`));\n    }\n    // DRILL DOWN EXPORT \n    ChurnRateInsightsDrillDownExport(clickData) {\n      let startEndDate = this.marketingExploreCommonService.monthStartEndCategoriesCreator(clickData.tier);\n      let tier = clickData.tech.replace('+', '%2B');\n      let fileNameTier = this.downloadFileNameService.generateReplaceSpecialChar(clickData.tech);\n      let fileName = this.downloadFileNameService.generateDownloadNameForDrillDown(`${this.language.churn_rate_insights}-${clickData.tier}-${fileNameTier.toLowerCase()}`);\n      let downloadURL = this.marketingExploreCommonService.queryParamsWOPeriodAssigner(`${this.churnRateInsightsDrillDownExport}tier=${tier}&start=${startEndDate.startDate}&end=${startEndDate.endDate}&filename=churn-rate-insights-${clickData.tier}-${fileNameTier}&`);\n      return {\n        downloadURL: downloadURL,\n        fileName: fileName\n      };\n    }\n    ChurnRateInsightsDrillDownHistoryExport(clickData) {\n      let tier = clickData.tech.replace('+', '%2B');\n      let fileNameTier = this.downloadFileNameService.generateReplaceSpecialChar(clickData.tech);\n      let month = clickData.tier.toLowerCase();\n      let fileName = this.downloadFileNameService.generateDownloadNameForDrillDown(`${this.language.churn_rate_insights}-${month}-${fileNameTier.toLowerCase()}-history`);\n      let downloadURL = this.marketingExploreCommonService.queryParamsWOPeriodAssigner(`${this.churnRateInsightsDrillDownHistoryExport}tier=${tier}&file=true&filename=churn-rate-insights-${month}-${fileNameTier}-history&`);\n      return {\n        downloadURL: downloadURL,\n        fileName: fileName\n      };\n    }\n    ////\n    ChurnRateInsightsDrillDownHistorySingleExport(clickData, exportData) {\n      let tier = clickData.tech.replace('+', '%2B');\n      let fileNameTech = exportData.data.name.replace(' ', '-');\n      let fileNameTier = this.downloadFileNameService.generateReplaceSpecialChar(clickData.tech);\n      let month = clickData.tier.toLowerCase();\n      let newMonth;\n      var element = clickData.tier;\n      newMonth = element.split('-');\n      var monthVal = constants.monthsArray.findIndex(x => x === newMonth[0]);\n      var category = parseInt(newMonth[1]) + 2000;\n      var tier_data = category + \"-\" + monthVal;\n      let fileName = this.downloadFileNameService.generateDownloadNameForDrillDown(`${this.language.churn_rate_insights}-${month}-${fileNameTier.toLowerCase()}--${exportData.data.accountNumber}-${fileNameTech.toLowerCase()}`);\n      let downloadURL = this.marketingExploreCommonService.queryParamsAssigner(`${this.churnRateInsightsDrillDownHistorySingleExport}endpoint-id=${exportData.endPointId}&churn-date=${tier_data}&file=true&filename=churn-rate-insights-${month}-${fileNameTier}-${exportData.data.accountNumber}-${fileNameTech.toLowerCase()}&`);\n      return {\n        downloadURL: downloadURL,\n        fileName: fileName\n      };\n    }\n    ///\n    RetentionExport() {\n      let fileName = this.downloadFileNameService.generateDownloadNameForDrillDown(this.language.retention_insights_report);\n      let downloadURL = this.marketingExploreCommonService.queryParamsAssigner(`${this.retentionExport}`);\n      return {\n        downloadURL: downloadURL,\n        fileName: fileName\n      };\n    }\n    ChurnRiskExport() {\n      let fileName = this.downloadFileNameService.generateDownloadNameForDrillDown(`${this.language.Churn_Risk}-${this.language.Report}`);\n      let downloadURL = this.marketingExploreCommonService.queryParamsAssigner(`${this.churnRiskExport}`);\n      return {\n        downloadURL: downloadURL,\n        fileName: fileName\n      };\n    }\n  }\n  MarketingExploreDataRetentionApiService.ɵfac = function MarketingExploreDataRetentionApiService_Factory(t) {\n    return new (t || MarketingExploreDataRetentionApiService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.MarketingExploreCommonService), i0.ɵɵinject(i3.DownloadFileNameService), i0.ɵɵinject(i4.SsoAuthService), i0.ɵɵinject(i5.TranslateService));\n  };\n  MarketingExploreDataRetentionApiService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: MarketingExploreDataRetentionApiService,\n    factory: MarketingExploreDataRetentionApiService.ɵfac,\n    providedIn: 'root'\n  });\n  return MarketingExploreDataRetentionApiService;\n})();","map":null,"metadata":{},"sourceType":"module"}