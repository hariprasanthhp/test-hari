{"ast":null,"code":"import { MessageService } from 'primeng/api';\nimport { WindowRefService } from '../shared/services/window-ref.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../shared/services/sso-auth.service\";\nimport * as i2 from \"@angular/platform-browser\";\nimport * as i3 from \"./shared/services/marketing-api.sevice\";\nimport * as i4 from \"primeng/api\";\nimport * as i5 from \"src/app-services/translate.service\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"./component/marketing-header/marketing-header.component\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"./component/marketing-footer/marketing-footer.component\";\nimport * as i10 from \"primeng/toast\";\nfunction MarketingComponent_p_toast_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"p-toast\");\n  }\n}\nexport let MarketingComponent = /*#__PURE__*/(() => {\n  class MarketingComponent {\n    constructor(sso, titleService, marketingApiService, messageService, translateService, router) {\n      this.sso = sso;\n      this.titleService = titleService;\n      this.marketingApiService = marketingApiService;\n      this.messageService = messageService;\n      this.translateService = translateService;\n      this.router = router;\n      this.tosAgreed = false;\n      this.showMarketing = false;\n      this.sso.setRelativeUrl('marketing');\n      this.titleService.setTitle('Marketing - Calix Cloud');\n      let entitlement = this.sso.getEntitlements();\n      this.baseUrl = WindowRefService.prototype.nativeWindow.split('//')[1].split('.')[0];\n      if (this.router.url.split(\"/\")[1] == 'marketing') {\n        (function (apiKey) {\n          (function (p, e, n, d, o) {\n            var v, w, x, y, z;\n            o = p[d] = p[d] || {};\n            o._q = [];\n            v = [\"initialize\", \"identify\", \"updateOptions\", \"pageLoad\", \"track\"];\n            for (w = 0, x = v.length; w < x; ++w) (function (m) {\n              o[m] = o[m] || function () {\n                o._q[m === v[0] ? \"unshift\" : \"push\"]([m].concat([].slice.call(arguments, 0)));\n              };\n            })(v[w]);\n            y = e.createElement(n);\n            y.async = !0;\n            y.src = \"https://cdn.pendo.io/agent/static/\" + apiKey + \"/pendo.js\";\n            z = e.getElementsByTagName(n)[0];\n            z.parentNode.insertBefore(y, z);\n          })(window, document, \"script\", \"pendo\");\n        })(\"1a540890-2412-4f18-4d82-7e719948b829\");\n        if (localStorage.getItem(\"calix.userId\") && localStorage.getItem('calix.spid')) {\n          pendo.initialize({\n            visitor: {\n              id: localStorage.getItem(\"calix.userId\"),\n              lang: sessionStorage.getItem(\"defaultLanguage\"),\n              url: this.getUrl(),\n              orgId: JSON.parse(localStorage.getItem(\"calix.login_data\")).OrgId,\n              userType: JSON.parse(localStorage.getItem(\"calix.login_data\")).user_type,\n              CMCType: entitlement['209'] ? 'CMC Plus' : 'CMC'\n              // language: \"fr_CA\",\n              // visitor_lang: \"FR_CS\",\n            },\n\n            account: {\n              id: localStorage.getItem(\"calix.spid\")\n              // language: localStorage.getItem(\"defaultLanguage\"), // Highly recommended\n            }\n          });\n        }\n      }\n    }\n\n    ngOnInit() {\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n      });\n      if (this.sso.isMarketingTermsAccept()) {\n        this.tosAgreed = true;\n      }\n      this.baseApiLoader();\n      this.sso.cmcTos$.subscribe(data => {\n        this.tosAgreed = true;\n        this.baseApiLoader();\n      });\n      let scopes = this.sso.getScopes();\n      let validScopes = Object.keys(scopes);\n      if (validScopes) {\n        for (let i = 0; i < validScopes.length; i++) {\n          if (validScopes[i].indexOf('cloud.rbac.cmc') !== -1 || validScopes[i].indexOf('cloud.cmc') !== -1) {\n            let enttlmnts = this.sso.getEntitlements();\n            if (enttlmnts[119] || enttlmnts[209]) {\n              this.showMarketing = true;\n            }\n            break;\n          }\n        }\n      }\n      setTimeout(() => {\n        this.showSuccess();\n      }, 2000);\n    }\n    ngOnDestroy() {\n      if (this.languageSubject) {\n        this.languageSubject.unsubscribe();\n      }\n    }\n    baseApiLoader() {\n      if (this.tosAgreed) {\n        let scope = this.sso.getScopes();\n        this.marketingApiService.openQlikConnection();\n        // if (!this.sso.isSecureAccess()) {\n        this.marketingApiService.userPreferenceApiLoader();\n        // }\n      }\n    }\n\n    showSuccess() {\n      let gp = this.sso.getGracePeriodsNew(); //this.sso.getGracePeriods();\n      let roles = this.sso.getRoles();\n      if (gp && roles && roles.indexOf('OrgAdmin') !== -1) {\n        for (let i = 0; i < gp.length; i++) {\n          this.messageService.add({\n            severity: 'warn',\n            summary: gp[i],\n            detail: '',\n            sticky: true\n          });\n        }\n      }\n    }\n    getUrl() {\n      if (this.baseUrl == 'cloud-stg') {\n        return 'stage';\n      } else if (this.baseUrl == 'calixcloud-ca') {\n        return 'prod_ca';\n      } else if (this.baseUrl == 'stage') {\n        return 'stage_local';\n      } else if (this.baseUrl.split(':')[0] == 'localhost') {\n        return 'local';\n      } else if (this.baseUrl == 'calixcloud') {\n        return 'prod';\n      } else if (this.baseUrl == 'cloud-dev') {\n        return 'dev';\n      } else {\n        return 'contact admin';\n      }\n    }\n  }\n  MarketingComponent.ɵfac = function MarketingComponent_Factory(t) {\n    return new (t || MarketingComponent)(i0.ɵɵdirectiveInject(i1.SsoAuthService), i0.ɵɵdirectiveInject(i2.Title), i0.ɵɵdirectiveInject(i3.MarketingApiService), i0.ɵɵdirectiveInject(i4.MessageService), i0.ɵɵdirectiveInject(i5.TranslateService), i0.ɵɵdirectiveInject(i6.Router));\n  };\n  MarketingComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MarketingComponent,\n    selectors: [[\"app-marketing\"]],\n    features: [i0.ɵɵProvidersFeature([MessageService])],\n    decls: 9,\n    vars: 6,\n    consts: [[1, \"page-wrapper\", 3, \"hidden\"], [1, \"maximus\"], [4, \"ngIf\"], [\"role\", \"alert\", 1, \"alert\", \"alert-warning\", 3, \"hidden\"], [3, \"hidden\"]],\n    template: function MarketingComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelement(2, \"app-marketing-header\");\n        i0.ɵɵtemplate(3, MarketingComponent_p_toast_3_Template, 1, 0, \"p-toast\", 2);\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵtext(5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\", 4);\n        i0.ɵɵelement(7, \"router-outlet\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(8, \"app-marketing-footer\", 4);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"hidden\", !ctx.tosAgreed);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", false);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"hidden\", ctx.showMarketing);\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", ctx.language[\"Access denied due to RBAC. Please consult your Organization Administrator for access.\"], \" \");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"hidden\", !ctx.showMarketing);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"hidden\", !ctx.tosAgreed);\n      }\n    },\n    directives: [i7.MarketingHeaderComponent, i8.NgIf, i6.RouterOutlet, i9.MarketingFooterComponent, i10.Toast],\n    styles: [\"a[_ngcontent-%COMP%]:hover{text-decoration:none}\"]\n  });\n  return MarketingComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}