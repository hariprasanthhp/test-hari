{"ast":null,"code":"import BpmnTreeWalker from './BpmnTreeWalker';\n\n/**\n * The importBpmnDiagram result.\n *\n * @typedef {Object} ImportBPMNDiagramResult\n *\n * @property {Array<string>} warnings\n */\n\n/**\n* The importBpmnDiagram error.\n*\n* @typedef {Error} ImportBPMNDiagramError\n*\n* @property {Array<string>} warnings\n*/\n\n/**\n * Import the definitions into a diagram.\n *\n * Errors and warnings are reported through the specified callback.\n *\n * @param  {djs.Diagram} diagram\n * @param  {ModdleElement<Definitions>} definitions\n * @param  {ModdleElement<BPMNDiagram>} [bpmnDiagram] the diagram to be rendered\n * (if not provided, the first one will be rendered)\n *\n * Returns {Promise<ImportBPMNDiagramResult, ImportBPMNDiagramError>}\n */\nexport function importBpmnDiagram(diagram, definitions, bpmnDiagram) {\n  var importer, eventBus, translate;\n  var error,\n    warnings = [];\n\n  /**\n   * Walk the diagram semantically, importing (=drawing)\n   * all elements you encounter.\n   *\n   * @param {ModdleElement<Definitions>} definitions\n   * @param {ModdleElement<BPMNDiagram>} bpmnDiagram\n   */\n  function render(definitions, bpmnDiagram) {\n    var visitor = {\n      root: function (element) {\n        return importer.add(element);\n      },\n      element: function (element, parentShape) {\n        return importer.add(element, parentShape);\n      },\n      error: function (message, context) {\n        warnings.push({\n          message: message,\n          context: context\n        });\n      }\n    };\n    var walker = new BpmnTreeWalker(visitor, translate);\n\n    // traverse BPMN 2.0 document model,\n    // starting at definitions\n    walker.handleDefinitions(definitions, bpmnDiagram);\n  }\n  return new Promise(function (resolve, reject) {\n    try {\n      importer = diagram.get('bpmnImporter');\n      eventBus = diagram.get('eventBus');\n      translate = diagram.get('translate');\n      eventBus.fire('import.render.start', {\n        definitions: definitions\n      });\n      render(definitions, bpmnDiagram);\n      eventBus.fire('import.render.complete', {\n        error: error,\n        warnings: warnings\n      });\n      return resolve({\n        warnings: warnings\n      });\n    } catch (e) {\n      e.warnings = warnings;\n      return reject(e);\n    }\n  });\n}","map":null,"metadata":{},"sourceType":"module"}