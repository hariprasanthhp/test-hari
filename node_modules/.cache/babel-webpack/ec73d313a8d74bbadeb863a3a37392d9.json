{"ast":null,"code":"import { Observable, Subject, throwError } from 'rxjs';\nimport { environment } from 'src/environments/environment';\nimport { catchError, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"src/app/shared/services/sso-auth.service\";\nimport * as i3 from \"@angular/forms\";\nexport let IssueService = /*#__PURE__*/(() => {\n  class IssueService {\n    constructor(httpClient, ssoAuthService, fb) {\n      this.httpClient = httpClient;\n      this.ssoAuthService = ssoAuthService;\n      this.fb = fb;\n      this.transformedAlarms = ['multiple-onts-down-network', 'multiple-onts-down-pon', 'multiple-onts-down-olt'];\n      this.baseURL = environment.API_BASE_URL;\n      this.issuesFilterChanged$ = new Subject();\n      this.geoMapFilterChanged$ = new Subject();\n      this.homegeomapNavigation$ = new Subject();\n      this.isIssueMap = false;\n      this.issuesGeoMapFiltersParams = {};\n      this.filtersForm = this.fb.group({\n        startDate: [''],\n        endDate: [''],\n        alarmType: [''],\n        region: [''],\n        location: [''],\n        system: [''],\n        fsan: [''],\n        severity: [''],\n        category: [''],\n        customCategory: [''],\n        eventName: 'All',\n        cco_ack: 'all',\n        cco_shelv: 'all'\n      });\n      this.selectedDate = new Subject();\n      this.filterCount$ = this.selectedDate.asObservable();\n      this.currentIssuesFilterParams = {};\n      this.geoMapHomeFilterParams = {};\n      this.regions = this.baseURL + 'nfa/regions?tenant=0';\n      this.locations = this.baseURL + 'nfa/locations?tenant=0';\n      this.systems = this.baseURL + 'nfa/systems?tenant=0';\n    }\n    filterCounts(ids) {\n      this.selectedDate.next(ids);\n      this.dateParams = ids;\n      return this.dateParams;\n    }\n    listen(eventname) {\n      return new Observable(subscriber => {\n        // socket.on(eventname, (data) => {\n        //   subscriber.next(data);\n        // })\n      });\n    }\n    emit(eventname, data) {\n      // console.log(\"data\");\n      // socket.emit(eventname, data);\n    }\n    getRegions(includeDeleted = false) {\n      let query = ``;\n      if (includeDeleted) {\n        query += `&includeDeleted=true`;\n      }\n      return this.httpClient.get(`${this.regions}${query}`).pipe(map(res => {\n        res.sort((a, b) => (a[\"name\"] || \"\").toString().localeCompare((b[\"name\"] || \"\").toString(), 'en', {\n          numeric: false\n        }));\n        return res;\n      }), catchError(this.handleError));\n    }\n    getLocations(id) {\n      let region = '&region=' + id;\n      return this.httpClient.get(`${this.locations}${region}`).pipe(map(res => {\n        res.sort((a, b) => (a[\"name\"] || \"\").toString().localeCompare((b[\"name\"] || \"\").toString(), 'en', {\n          numeric: false\n        }));\n        return res;\n      }), catchError(this.handleError));\n    }\n    getSystems(regionId, locationId) {\n      let region = '&region=' + regionId;\n      let location = '&location=' + locationId;\n      return this.httpClient.get(`${this.systems}${region}${location}`).pipe(map(res => {\n        res.sort((a, b) => (a[\"name\"] || \"\").toString().localeCompare((b[\"name\"] || \"\").toString(), 'en', {\n          numeric: false\n        }));\n        return res;\n      }), catchError(this.handleError));\n    }\n    prepareLocationRegionHierachy(result) {\n      let regionsLocations = [];\n      let regionMap = {};\n      result.map(item => {\n        if (!regionMap.hasOwnProperty(item[0])) {\n          regionsLocations.push({\n            value: item[0],\n            parent: 'All'\n          });\n          regionMap[item[0]] = true;\n        }\n        regionsLocations.push({\n          value: item[1],\n          parent: item[0]\n        });\n      });\n      return regionsLocations;\n    }\n    // getLocation() {\n    //   return localStorage.getItem('location') ? localStorage.getItem('location') : 'All'\n    // }\n    // getRegion() {\n    //   return localStorage.getItem('region') ? localStorage.getItem('region') : 'All'\n    // }\n    handleError(error) {\n      return throwError(error);\n    }\n    getAlarmSubscriberInfo(id) {\n      return this.httpClient.get(`${this.baseURL}/analytics-engine/alarmSubscriberList?historyReport=false&alarmId=${id}`);\n    }\n    setCurrentIssuesFilterParams(params, isGeoMap = true, changeTab) {\n      this.currentIssuesFilterParams = params;\n      if (!changeTab) {\n        this.issuesFilterChanged$.next(isGeoMap);\n      }\n    }\n    getCurrentIssuesFilterParams() {\n      return this.currentIssuesFilterParams;\n    }\n    setgeoMapHomeFilterParams(params, isGeoMap = true, changeTab) {\n      this.geoMapHomeFilterParams = params;\n      if (!changeTab) {\n        this.issuesFilterChanged$.next(isGeoMap);\n      }\n    }\n    getgeoMapHomeFilterParams() {\n      return this.geoMapHomeFilterParams;\n    }\n    setGeoMapFilters(value) {\n      this.geoMapFilterChanged$.next(value);\n    }\n    callGotoHomeGeomap() {\n      this.homegeomapNavigation$.next();\n    }\n    fromMapNavigation(value) {\n      this.isIssueMap = value;\n    }\n    isMap() {\n      return this.isIssueMap;\n    }\n    setIssuesGeoMapFilters(params) {\n      this.issuesGeoMapFiltersParams = params;\n    }\n    getIssuesGeoMapFilters() {\n      return this.issuesGeoMapFiltersParams;\n    }\n    ngOnDestroy() {\n      if (this.issuesFilterChanged$) {\n        this.issuesFilterChanged$.unsubscribe();\n      }\n      if (this.geoMapFilterChanged$) {\n        this.geoMapFilterChanged$.unsubscribe();\n      }\n      if (this.homegeomapNavigation$) {\n        this.homegeomapNavigation$.unsubscribe();\n      }\n      this.selectedDate.unsubscribe();\n    }\n    generateResourceForUI(alarm, isExaAlarm) {\n      var _a, _b, _c, _d, _e, _f, _g, _h;\n      let region = '';\n      let location = '';\n      let deviceName = '';\n      if (alarm && alarm['subject']) {\n        if (alarm['subject']['region']) {\n          region += `${alarm['subject']['region']}`;\n        }\n        if (alarm['subject']['location']) {\n          location += `${region ? '/' : ''}${alarm['subject']['location']}`;\n        }\n        if (alarm['subject']['deviceName']) {\n          deviceName += `${location ? '/' : ''}${alarm['subject']['deviceName']}`;\n        }\n      }\n      if (isExaAlarm) {\n        alarm['subject']['resourceForUI'] = `(${region} ${location} ${deviceName}) ${alarm['subject']['source']}`;\n        if (typeof ((_b = (_a = alarm['subject']) === null || _a === void 0 ? void 0 : _a.additionalAttributes) === null || _b === void 0 ? void 0 : _b['ring-name']) === 'object') {\n          alarm['subject']['resourceForUI'] += `(${(_d = (_c = alarm['subject']) === null || _c === void 0 ? void 0 : _c.additionalAttributes) === null || _d === void 0 ? void 0 : _d['ring-name'].value})`;\n        } else if ((_f = (_e = alarm['subject']) === null || _e === void 0 ? void 0 : _e.additionalAttributes) === null || _f === void 0 ? void 0 : _f['ring-name']) {\n          alarm['subject']['resourceForUI'] += `(${(_h = (_g = alarm['subject']) === null || _g === void 0 ? void 0 : _g.additionalAttributes) === null || _h === void 0 ? void 0 : _h['ring-name']})`;\n        }\n      } else if (this.transformedAlarms.indexOf(alarm['subject']['alarmEventName']) === -1) {\n        alarm['subject']['resourceForUI'] = `(${region} ${location} ${deviceName}) ${alarm['subject']['source']}`;\n      } else {\n        if (alarm['subject'] && alarm['subject']['alarmEventName'] === 'multiple-onts-down-network') {\n          alarm['subject']['resourceForUI'] = `(${region} ${location})`;\n        } else if (alarm['subject'] && alarm['subject']['alarmEventName'] === 'multiple-onts-down-pon') {\n          alarm['subject']['resourceForUI'] = `(${region} ${location} ${deviceName}) ${alarm['subject']['source']}`;\n        } else if (alarm['subject'] && alarm['subject']['alarmEventName'] === 'multiple-onts-down-olt') {\n          alarm['subject']['resourceForUI'] = `(${region} ${location} ${deviceName})`;\n        }\n      }\n      return alarm['subject']['resourceForUI'];\n    }\n    appendFqn(res) {\n      if (res === null || res === void 0 ? void 0 : res.length) {\n        res === null || res === void 0 ? void 0 : res.forEach(element => {\n          if (this.findObjectsCountByValue(res, element.name) > 1) {\n            let fqn = '';\n            if (element.fqn) {\n              let tmp = element['fqn'].split(',');\n              if (tmp.length) {\n                let deviceName = tmp[0];\n                if (deviceName) {\n                  let arr = deviceName.split('=');\n                  if (arr.length && arr[1]) {\n                    fqn = arr[1];\n                  }\n                }\n              }\n            }\n            element['tempName'] = `${element.name} ${fqn ? `(${fqn})` : ''}`;\n          } else {\n            element['tempName'] = element.name;\n          }\n        });\n        res.forEach(element => {\n          element['name'] = element.tempName;\n        });\n      }\n      return res;\n    }\n    findObjectsCountByValue(jsObjects, value) {\n      let count = 0;\n      if (jsObjects && jsObjects.length) {\n        for (var i = 0; i < jsObjects.length; i++) {\n          if (typeof jsObjects[i]['isDeleted'] !== 'undefined' && !jsObjects[i]['isDeleted'] && jsObjects[i]['name'].toLowerCase() == value.toLowerCase()) {\n            count++;\n          }\n        }\n      }\n      return count;\n    }\n  }\n  IssueService.ɵfac = function IssueService_Factory(t) {\n    return new (t || IssueService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.SsoAuthService), i0.ɵɵinject(i3.FormBuilder));\n  };\n  IssueService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: IssueService,\n    factory: IssueService.ɵfac,\n    providedIn: 'root'\n  });\n  return IssueService;\n})();","map":null,"metadata":{},"sourceType":"module"}