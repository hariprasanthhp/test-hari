{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app-services/translate.service\";\nimport * as i2 from \"../.../../../shared/services/sso-auth.service\";\nimport * as i3 from \"./support-realtime.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"../data.service\";\nimport * as i6 from \"../shared/component/subscriber-menu/subscriber-menu.component\";\nimport * as i7 from \"@angular/common\";\nfunction SupportTrafficReportsComponent_li_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 17);\n    i0.ɵɵelementStart(1, \"a\", 18);\n    i0.ɵɵlistener(\"Click\", function SupportTrafficReportsComponent_li_5_Template_a_Click_1_listener($event) {\n      return $event.preventDefault();\n    });\n    i0.ɵɵelementStart(2, \"span\", 19);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.language.Data);\n  }\n}\nfunction SupportTrafficReportsComponent_li_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 20);\n    i0.ɵɵelementStart(1, \"a\", 21);\n    i0.ɵɵelementStart(2, \"span\", 19);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r1.language.Video);\n  }\n}\nfunction SupportTrafficReportsComponent_li_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 22);\n    i0.ɵɵelementStart(1, \"a\", 23);\n    i0.ɵɵelementStart(2, \"span\", 19);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.language.Voice);\n  }\n}\nfunction SupportTrafficReportsComponent_li_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 24);\n    i0.ɵɵelementStart(1, \"a\", 25);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/\", ctx_r3.MODULE, \"/traffic-reports/common-reports\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.language.Reports, \"\");\n  }\n}\nexport let SupportTrafficReportsComponent = /*#__PURE__*/(() => {\n  class SupportTrafficReportsComponent {\n    constructor(translateService, sso, rtService, router, dataChartService) {\n      this.translateService = translateService;\n      this.sso = sso;\n      this.rtService = rtService;\n      this.router = router;\n      this.dataChartService = dataChartService;\n      this.loader1 = false;\n      this.loader2 = false;\n      this.showDataService = false;\n      this.showVoiceService = false;\n      this.showVideoService = false;\n      //showVoiceService1 = false;\n      //showVideoService1= false;\n      this.deviceInfo = {\n        'modelName': ''\n      };\n      this.thirdPartyDevice = false;\n      this.checkDeviceManfacturer = JSON.parse(sessionStorage.getItem(\"calix.deviceData\"));\n      this.MODULE = 'support';\n      this.metaData = {};\n      this.videoWan = true;\n      this.voiceWan = true;\n      let url = this.router.url;\n      if (url.indexOf('/support/') > -1) {\n        this.MODULE = 'support';\n      } else this.MODULE = 'cco';\n    }\n    ngOnInit() {\n      this.language = this.translateService.defualtLanguage;\n      this.languageSubject = this.translateService.selectedLanguage.subscribe(data => {\n        this.language = data;\n      });\n      if (this.sso.getSubscriberEndpointId()) {\n        this.getDataByNewToken();\n      } else {\n        this.sbcbrEpSubcribe = this.sso.subscriberEndPointId$.subscribe(id => {\n          console.log('subscribe', id);\n          if (id) {\n            this.getDataByNewToken();\n          }\n        });\n      }\n      this.thirdPartyDevice = this.checkDeviceManfacturer ? this.checkDeviceManfacturer.filter(obj => (obj === null || obj === void 0 ? void 0 : obj.manufacturer) !== 'Calix' && obj.manufacturer).length ? true : false : false;\n      //localStorage.removeItem(\"calix.videopermission\");\n      //localStorage.removeItem(\"calix.voicepermission\");\n      //this.router.navigate(['/support/service/data']);\n      this.orgId = this.sso.getOrgId();\n      let scopes = this.sso.getScopes();\n      this.getDevice();\n      if (environment.VALIDATE_SCOPE) {\n        //scopes['cloud.rbac.csc.services.data'] = scopes['cloud.rbac.csc.services.data'] ? scopes['cloud.rbac.csc.services.data'] : [];\n        scopes['cloud.rbac.csc.services.video'] = scopes['cloud.rbac.csc.services.video'] ? scopes['cloud.rbac.csc.services.video'] : [];\n        scopes['cloud.rbac.csc.services.voice'] = scopes['cloud.rbac.csc.services.voice'] ? scopes['cloud.rbac.csc.services.voice'] : [];\n        /*if (scopes && (scopes['cloud.rbac.csc.services.data'] && scopes['cloud.rbac.csc.services.data'].length)) {\r\n          this.showDataService = true;\r\n        }*/\n        let validScopes = Object.keys(scopes);\n        if (validScopes) {\n          for (let i = 0; i < validScopes.length; i++) {\n            if (validScopes[i].indexOf('cloud.rbac.csc.services.data') !== -1) {\n              this.showDataService = true;\n              break;\n            }\n          }\n        }\n        if (scopes && scopes['cloud.rbac.csc.services.video'] && scopes['cloud.rbac.csc.services.video'].length) {\n          this.showVideoService = true;\n        }\n        if (scopes && scopes['cloud.rbac.csc.services.voice'] && scopes['cloud.rbac.csc.services.voice'].length) {\n          this.showVoiceService = true;\n        }\n      } else {\n        this.showDataService = true;\n        this.showVoiceService = true;\n        this.showVideoService = true;\n      }\n      this.apiCallDone = true;\n    }\n    getDevice() {\n      var _a, _b, _c, _d;\n      this.deviceInfo = JSON.parse(sessionStorage.getItem(\"calix.deviceData\"));\n      this.deviceInfo = (_a = this.deviceInfo) === null || _a === void 0 ? void 0 : _a.filter(obj => obj.serialNumber).sort((a, b) => a.opMode != \"RG\" ? 1 : -1);\n      this.deviceInfo = (_b = this.deviceInfo) === null || _b === void 0 ? void 0 : _b.filter(obj => obj.opMode == \"RG\");\n      this.deviceInfo = ((_c = this.deviceInfo) === null || _c === void 0 ? void 0 : _c.length) ? this.deviceInfo[0] : {};\n      this.serialNumberSelected = (_d = this.deviceInfo) === null || _d === void 0 ? void 0 : _d.serialNumber;\n      this.metaData = this.dataChartService.getMetaData(this.serialNumberSelected);\n      if (this.metaData) {\n        this.checkWanStatus();\n      } else this.getMetaData();\n    }\n    getDataByNewToken() {\n      // if (this.sso.getSubscriberEndpointId() !== window.localStorage.getItem('calix.temp_endpoint_id')) {\n      //   if (this.source) {\n      //     this.source.close();\n      //   }\n      //   this.source = null;\n      // }\n      // window.localStorage.setItem('calix.temp_endpoint_id', this.sso.getSubscriberEndpointId());\n      // this.sso.getAuthTokenByRT().subscribe((json: any) => {\n      //   this.sso.setLoginInfo(json);\n      //   this.source = this.rtService.getData();\n      // }, (err: any) => {\n      // });\n    }\n    ngOnDestroy() {\n      this.languageSubject.unsubscribe();\n      if (this.source) {\n        this.source.close();\n      }\n      if (this.sbcbrEpSubcribe) {\n        this.sbcbrEpSubcribe.unsubscribe();\n      }\n      this.source = null;\n      this.rtService.clearData();\n      //this.rtService.closeEventSource();\n    }\n\n    ngAfterViewInit() {\n      let path = window.location.pathname;\n      if (path.indexOf(\"support/traffic-reports/\") !== -1) {\n        setTimeout(() => {\n          console.log(\"trigger css\");\n          $(\"#serviceDataTabHrefId\").addClass(\"active\");\n        }, 500);\n      }\n    }\n    objectExistence(obj) {\n      return Object.keys(obj || {}).length;\n    }\n    getMetaData() {\n      if (!this.serialNumberSelected) return;\n      this.loader1 = true;\n      this.dataChartService.fetchMetaData(this.orgId, this.serialNumberSelected).subscribe(res => {\n        this.loader1 = false;\n        this.metaData = res || {};\n        res.properties.forEach(obj => {\n          this.reStructureMeta(obj);\n        });\n        //console.log('343',this.metaData);\n        this.checkWanStatus();\n        this.dataChartService.setMetaData(this.serialNumberSelected, this.metaData);\n      }, err => {\n        this.loader1 = false;\n        //this.pageErrorHandle(err);\n      });\n    }\n\n    reStructureMeta(obj) {\n      this.metaData[obj.featureName.replace(/[.]/g, \"\")] = {};\n      if (obj.hasOwnProperty(\"fields\")) {\n        obj.fields.forEach(element => {\n          this.metaData[obj.featureName.replace(/[.]/g, \"\")][element.name.replace(/[.]/g, \"\")] = element;\n        });\n      } else if (obj.hasOwnProperty(\"configuration\")) {\n        this.metaData[obj.featureName.replace(/[.]/g, \"\")][\"config\"] = obj.configuration;\n      } else if (obj.hasOwnProperty(\"supported\")) {\n        this.metaData[obj.featureName.replace(/[.]/g, \"\")][\"supported\"] = obj.supported;\n      }\n    }\n    checkWanStatus() {\n      var _a;\n      if ((_a = this.metaData) === null || _a === void 0 ? void 0 : _a.WANInfo) {\n        let tabAllowed = [];\n        this.loader1 = true;\n        this.dataChartService.getWanInfo(this.orgId, this.serialNumberSelected).subscribe(res => {\n          this.loader1 = false;\n          if (res && res.length) {\n            res.filter(obj => {\n              if (obj.bIsVideo) tabAllowed.push('video');\n              if (obj.bIsVoice) tabAllowed.push('voice');\n            });\n          }\n          this.videoWan = tabAllowed.includes('video');\n          this.voiceWan = tabAllowed.includes('voice');\n        }, err => {\n          this.loader1 = false;\n          this.videoWan = false;\n          this.voiceWan = false;\n        });\n      } else {\n        this.videoWan = false;\n        this.voiceWan = false;\n      }\n    }\n  }\n  SupportTrafficReportsComponent.ɵfac = function SupportTrafficReportsComponent_Factory(t) {\n    return new (t || SupportTrafficReportsComponent)(i0.ɵɵdirectiveInject(i1.TranslateService), i0.ɵɵdirectiveInject(i2.SsoAuthService), i0.ɵɵdirectiveInject(i3.SupportRealtimeService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i5.DataServiceService));\n  };\n  SupportTrafficReportsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SupportTrafficReportsComponent,\n    selectors: [[\"app-support-traffic-reports\"]],\n    decls: 22,\n    vars: 6,\n    consts: [[1, \"mr-2\", \"mb-2\"], [1, \"row\"], [1, \"col-md-12\", \"ccl-tabs\"], [\"id\", \"tabs\", 1, \"nav\", \"nav-tabs\"], [\"class\", \"nav-item\", \"id\", \"serviceDataTabId\", 4, \"ngIf\"], [\"class\", \"nav-item\", \"id\", \"serviceVideoTabId\", 4, \"ngIf\"], [\"id\", \"serviceVoiceTabId\", \"class\", \"nav-item\", 4, \"ngIf\"], [1, \"m-2\"], [1, \"row\", \"mt-4\"], [1, \"col-md-12\", \"px-1\", \"ccl-tabs\"], [\"id\", \"data-realtime-tab\", 1, \"nav-item\"], [\"data-toggle\", \"tab\", \"routerLinkActive\", \"active\", 1, \"nav-link\", \"small\", 3, \"routerLink\", \"Click\"], [\"id\", \"data-reports-time\", \"class\", \"nav-item\", 4, \"ngIf\"], [\"id\", \"tabsContent\", 1, \"tab-content\"], [\"id\", \"issue\", 1, \"tab-pane\", \"fade\", \"active\", \"show\"], [1, \"row\", \"pb-2\"], [\"id\", \"topology\", 1, \"tab-pane\", \"fade\"], [\"id\", \"serviceDataTabId\", 1, \"nav-item\"], [\"routerLink\", \"/support/service/data\", \"data-toggle\", \"tab\", \"routerLinkActive\", \"active\", \"id\", \"serviceDataTabHrefId\", 1, \"nav-link\", \"small\", 3, \"Click\"], [1, \"big-text\"], [\"id\", \"serviceVideoTabId\", 1, \"nav-item\"], [\"routerLink\", \"/support/service/video\", \"data-toggle\", \"tab\", \"routerLinkActive\", \"active\", 1, \"big-text\", \"nav-link\", \"small\"], [\"id\", \"serviceVoiceTabId\", 1, \"nav-item\"], [\"routerLink\", \"/support/service/voice\", \"data-toggle\", \"tab\", \"routerLinkActive\", \"active\", 1, \"nav-link\", \"small\"], [\"id\", \"data-reports-time\", 1, \"nav-item\"], [\"data-toggle\", \"tab\", \"routerLinkActive\", \"active\", 1, \"nav-link\", \"small\", 3, \"routerLink\"]],\n    template: function SupportTrafficReportsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-subscriber-menu\");\n        i0.ɵɵelementStart(1, \"section\", 0);\n        i0.ɵɵelementStart(2, \"div\", 1);\n        i0.ɵɵelementStart(3, \"div\", 2);\n        i0.ɵɵelementStart(4, \"ul\", 3);\n        i0.ɵɵtemplate(5, SupportTrafficReportsComponent_li_5_Template, 4, 1, \"li\", 4);\n        i0.ɵɵtemplate(6, SupportTrafficReportsComponent_li_6_Template, 4, 1, \"li\", 5);\n        i0.ɵɵtemplate(7, SupportTrafficReportsComponent_li_7_Template, 4, 1, \"li\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"section\", 7);\n        i0.ɵɵelementStart(9, \"div\", 8);\n        i0.ɵɵelementStart(10, \"div\", 9);\n        i0.ɵɵelementStart(11, \"ul\", 3);\n        i0.ɵɵelementStart(12, \"li\", 10);\n        i0.ɵɵelementStart(13, \"a\", 11);\n        i0.ɵɵlistener(\"Click\", function SupportTrafficReportsComponent_Template_a_Click_13_listener($event) {\n          return $event.preventDefault();\n        });\n        i0.ɵɵtext(14);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(15, SupportTrafficReportsComponent_li_15_Template, 3, 2, \"li\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"div\", 13);\n        i0.ɵɵelementStart(17, \"div\", 14);\n        i0.ɵɵelement(18, \"div\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"div\", 16);\n        i0.ɵɵelement(20, \"div\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(21, \"router-outlet\");\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.showDataService);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showVideoService && (ctx.objectExistence(ctx.metaData == null ? null : ctx.metaData.VideoMulticastSystems) || ctx.videoWan));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.deviceInfo.modelName && ctx.deviceInfo.modelName.indexOf(\"GS202\") != 0 && ctx.showVoiceService && (ctx.objectExistence(ctx.metaData == null ? null : ctx.metaData.VoiceStatus) || ctx.voiceWan));\n        i0.ɵɵadvance(6);\n        i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/\", ctx.MODULE, \"/traffic-reports/realtime\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate(ctx.language.Real_time);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", true);\n      }\n    },\n    directives: [i6.SubscriberMenuComponent, i7.NgIf, i4.RouterLinkWithHref, i4.RouterLinkActive, i4.RouterOutlet],\n    styles: [\".nav-tabs[_ngcontent-%COMP%]   .nav-item.show[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%], .nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background-color:#fff;border-color:#dee2e6 #dee2e6 #fff;border:none;border-bottom:1px solid #2078fa}.nav-tabs[_ngcontent-%COMP%]{border-bottom:none}a[_ngcontent-%COMP%]{color:#333}.nav-link[_ngcontent-%COMP%]{font-size:18px;border-bottom:1px solid transparent;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:focus, .nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{border-color:#e9ecef #e9ecef #dee2e6;border:none;color:#4c4c4c;border-bottom:1px solid #9bc1f9}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#4c4c4c}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{margin-bottom:0}\"]\n  });\n  return SupportTrafficReportsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}